<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Word2Stitch â€” Cross-Stitch Pattern Generator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Anybody:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Cascade layer order â€” loaded first, controls specificity */
@layer tokens, layout, components, sheets, responsive;


@layer tokens {
  /* -- Reset -- */
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f5f0ea;
    --bg-deep: #ece5db;
    --panel: #faf8f5;
    --border: #e0d6c8;
    --border-light: #eae3d9;
    --text: #3d3229;
    --text-mid: #7a6e60;
    --text-muted: #a99e8f;
    --accent: #b83a2a;
    --accent-hover: #9c3023;
    --accent-soft: rgba(184, 58, 42, 0.08);
    --accent-glow: rgba(184, 58, 42, 0.15);
    --stitch-grid: #d8d0c5;
    --stitch-bold: #a09585;
    --radius: 10px;
    --radius-sm: 6px;
    --font-display: 'DM Serif Display', Georgia, serif;
    --font-body: 'Anybody', system-ui, sans-serif;
  }

  html, body { height: 100%; overflow: hidden; }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    height: 100vh;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
  }

  /* -- Linen noise texture -- */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    pointer-events: none;
    opacity: 0.3;
    background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 20h40M20 0v40' stroke='%23c8bfb0' stroke-width='0.3'/%3E%3C/svg%3E");
    background-size: 40px 40px;
    z-index: 0;
  }
}


@layer layout {
  /* -- Top Bar -- */
  .topbar {
    position: relative;
    z-index: 10;
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 10px 20px;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }

  .logo {
    display: flex;
    align-items: baseline;
    gap: 0;
    flex-shrink: 0;
    user-select: none;
  }
  .logo-x {
    font-size: 18px;
    color: var(--accent);
    font-weight: 700;
    line-height: 1;
    margin-right: 3px;
  }
  .logo-text {
    font-family: var(--font-display);
    font-size: 20px;
    color: var(--text);
    letter-spacing: -0.3px;
  }
  .logo-text em {
    color: var(--accent);
    font-style: italic;
  }

  .topbar-sep {
    width: 1px;
    height: 24px;
    background: var(--border);
    flex-shrink: 0;
  }

  /* -- Text Input (in topbar) -- */
  .text-input-area {
    flex: 1;
    min-width: 0;
    position: relative;
  }
  .text-input {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 8px 14px;
    font-family: var(--font-display);
    font-size: 22px;
    color: var(--text);
    background: #fff;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    resize: none;
    overflow: hidden;
    line-height: 1.3;
    field-sizing: content;
    min-height: 42px;
    max-height: 120px;
  }
  .text-input::placeholder {
    color: var(--text-muted);
    font-style: italic;
  }
  .text-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }

  /* Download button in topbar */
  .btn-download {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 9px 18px;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    white-space: nowrap;
  }
  .btn-download:hover {
    background: var(--accent-hover);
    box-shadow: 0 3px 12px rgba(184,58,42,0.25);
    transform: translateY(-1px);
  }
  .btn-download:active { transform: translateY(0); }
  .btn-download:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  .btn-download svg { width: 15px; height: 15px; }

  /* -- Main Layout -- */
  .main-layout {
    position: relative;
    z-index: 1;
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  /* -- Left Sidebar -- */
  .sidebar {
    width: 280px;
    flex-shrink: 0;
    background: var(--panel);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .sidebar-section {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border-light);
  }
  .sidebar-section:last-child { border-bottom: none; }

  .section-header {
    font-size: 10px;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .section-header svg {
    width: 12px;
    height: 12px;
    opacity: 0.5;
  }
}


@layer components {
  /* -- Font search input -- */
  .font-search {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 6px 10px;
    font-family: var(--font-body);
    font-size: 12px;
    color: var(--text);
    background: #fff;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .font-search::placeholder {
    color: var(--text-muted);
  }
  .font-search:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }

  /* -- Font Category Tabs -- */
  .font-tabs {
    display: flex;
    gap: 3px;
    overflow-x: auto;
    flex-wrap: nowrap;
    padding: 8px 0 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
    touch-action: pan-x;
  }
  .font-tabs::-webkit-scrollbar { height: 3px; }
  .font-tabs::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
  .font-tab {
    flex-shrink: 0;
    padding: 4px 8px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: transparent;
    cursor: pointer;
    font-family: var(--font-body);
    font-size: 10px;
    font-weight: 600;
    color: var(--text-mid);
    transition: background 0.12s, border-color 0.12s, color 0.12s;
    white-space: nowrap;
    line-height: 1.3;
  }
  .font-tab:hover {
    border-color: var(--accent);
    color: var(--accent);
  }
  .font-tab.active {
    border-color: var(--accent);
    background: var(--accent-soft);
    color: var(--accent);
  }
  .font-tab:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  /* -- Font List -- */
  .font-list {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    gap: 3px;
    padding: 0 14px 10px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
    touch-action: pan-y;
  }
  .font-list::-webkit-scrollbar { width: 5px; }
  .font-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .font-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border: 1.5px solid transparent;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.12s, border-color 0.12s;
    background: transparent;
    flex-shrink: 0;
  }
  .font-item:hover {
    background: var(--accent-soft);
    border-color: var(--border);
  }
  .font-item.selected {
    background: var(--accent-soft);
    border-color: var(--accent);
  }
  .font-item-info {
    min-width: 0;
    flex: 1;
  }
  .font-item-name {
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .font-item-meta {
    font-size: 10px;
    color: var(--text-muted);
  }
  .font-item-preview {
    width: 100%;
    height: 28px;
    image-rendering: pixelated;
    margin-top: 4px;
    border-radius: 3px;
    background: var(--bg);
  }
  .font-item-preview.loading {
    background: linear-gradient(90deg, var(--bg) 0%, var(--bg-deep) 50%, var(--bg) 100%);
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
  }

  /* -- Height Slider -- */
  .height-control {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .height-slider {
    flex: 1;
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    border-radius: 3px;
    background: var(--border);
    outline: none;
    transition: background 0.2s;
  }
  .height-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    transition: transform 0.1s;
  }
  .height-slider::-webkit-slider-thumb:hover {
    transform: scale(1.15);
  }
  .height-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .height-slider:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  .height-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-body);
    min-width: 32px;
    text-align: right;
    line-height: 1;
  }
  .height-unit {
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* -- Color Swatches -- */
  .color-row {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    align-items: center;
  }
  .color-dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: transform 0.12s, box-shadow 0.12s, border-color 0.12s;
    position: relative;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.08);
  }
  .color-dot:hover {
    transform: scale(1.2);
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }
  .color-dot.selected {
    border-color: var(--text);
    box-shadow: 0 0 0 2px #fff, 0 0 0 3.5px var(--text);
    transform: scale(1.1);
  }
  .color-dot .tip {
    position: absolute;
    bottom: calc(100% + 6px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--text);
    color: #fff;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 10px;
    font-weight: 500;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.12s;
    z-index: 20;
  }
  .color-dot .tip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 3px solid transparent;
    border-top-color: var(--text);
  }
  .color-dot:hover .tip { opacity: 1; }

  /* "All colors" button in sidebar */
  .color-all-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 1.5px dashed var(--text-muted);
    background: transparent;
    cursor: pointer;
    font-family: var(--font-body);
    font-size: 9px;
    font-weight: 700;
    color: var(--text-muted);
    transition: border-color 0.12s, color 0.12s, background 0.12s;
  }
  .color-all-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-soft);
  }

  /* -- Desktop Color Popover -- */
  .sidebar-color-section { position: relative; }
  .color-popover {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    background: var(--panel);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    z-index: 30;
    padding: 10px;
    flex-direction: column;
    gap: 8px;
    max-height: 320px;
  }
  .color-popover.open { display: flex; }
  .color-popover-header {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .color-popover-search {
    flex: 1;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 6px 10px;
    font-family: var(--font-body);
    font-size: 12px;
    color: var(--text);
    background: #fff;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .color-popover-search:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .color-popover-close {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 18px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.12s, color 0.12s;
    flex-shrink: 0;
  }
  .color-popover-close:hover {
    background: var(--accent-soft);
    color: var(--accent);
  }
  .color-popover-grid {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    overflow-y: auto;
    overscroll-behavior: contain;
    max-height: 240px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .color-popover-grid .color-dot {
    width: 24px;
    height: 24px;
  }
  .color-popover-grid .color-dot .tip { display: none; }
  .color-popover-grid .color-dot:hover .tip { display: block; }
}


@layer components {
  /* -- Aida selector -- */
  .aida-row {
    display: flex;
    gap: 5px;
  }
  .aida-chip {
    flex: 1;
    text-align: center;
    padding: 8px 0;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-family: var(--font-body);
    background: transparent;
    transition: border-color 0.12s, background 0.12s, color 0.12s;
  }
  .aida-chip:hover { border-color: var(--accent); }
  .aida-chip.selected {
    border-color: var(--accent);
    background: var(--accent-soft);
  }
  .aida-chip:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  .aida-chip-num {
    display: block;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.1;
  }
  .aida-chip.selected .aida-chip-num { color: var(--accent); }
  .aida-chip-label {
    font-size: 9px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
  }

  /* -- Custom stitch length -- */
  .custom-stitch-row {
    display: none;
    flex-direction: column;
    gap: 4px;
    margin-top: 8px;
    padding: 0;
  }
  .custom-stitch-row.visible { display: flex; }
  .custom-stitch-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .custom-stitch-header .stitch-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-mid);
  }
  .custom-stitch-header .stitch-value-display {
    display: flex;
    align-items: baseline;
    gap: 3px;
  }
  .custom-stitch-header .stitch-value-num {
    font-size: 15px;
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-body);
    line-height: 1;
  }
  .custom-stitch-header .stitch-value-unit {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-mid);
  }
  .custom-stitch-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--border);
    outline: none;
  }
  .custom-stitch-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .custom-stitch-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .custom-stitch-slider:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  .custom-stitch-equiv {
    font-size: 11px;
    color: var(--text-muted);
    text-align: center;
  }
  /* -- Alignment Buttons -- */
  .align-row, .mobile-align-row {
    display: flex;
    gap: 5px;
  }
  .align-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 0;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-family: var(--font-body);
    font-size: 11px;
    font-weight: 600;
    color: var(--text-mid);
    background: transparent;
    transition: border-color 0.12s, background 0.12s, color 0.12s;
  }
  .align-btn svg {
    width: 18px;
    height: 18px;
  }
  .align-btn:hover { border-color: var(--accent); color: var(--accent); }
  .align-btn.active {
    border-color: var(--accent);
    background: var(--accent-soft);
    color: var(--accent);
  }
  .align-btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  /* Desktop sidebar: icon-only alignment buttons */
  .sidebar .align-btn span { display: none; }

  /* -- Global Unit Toggle (topbar cm/in) -- */
  .unit-toggle {
    display: flex;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    flex-shrink: 0;
  }
  .unit-toggle-btn {
    padding: 10px 14px;
    border: none;
    background: transparent;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 700;
    color: var(--text-muted);
    cursor: pointer;
    transition: background 0.12s, color 0.12s;
    text-transform: lowercase;
    min-height: 40px;
    min-width: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .unit-toggle-btn.active {
    background: var(--accent);
    color: #fff;
  }
  .unit-toggle-btn:not(.active):hover {
    background: var(--accent-soft);
    color: var(--accent);
  }
  .unit-toggle-btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}


@layer components {
  /* -- Preview Area (right) -- */
  .preview-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-width: 0;
    overflow: hidden;
    padding: 20px;
    position: relative;
  }

  .preview-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: var(--text-muted);
    font-size: 15px;
    text-align: center;
  }
  .preview-empty svg {
    width: 48px;
    height: 48px;
    opacity: 0.25;
    margin-bottom: 4px;
  }
  .preview-empty span {
    font-family: var(--font-display);
    font-size: 16px;
    font-style: italic;
  }

  /* -- Loading overlay -- */
  .preview-loading {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(245, 240, 234, 0.85);
    z-index: 5;
    gap: 12px;
  }
  .preview-loading.hidden { display: none; }
  .loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text {
    font-family: var(--font-display);
    font-size: 15px;
    font-style: italic;
    color: var(--text-mid);
  }

  .preview-canvas-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    max-width: 100%;
    max-height: 100%;
  }

  #mainCanvas {
    image-rendering: pixelated;
    max-width: 100%;
    max-height: calc(100vh - 200px);
    object-fit: contain;
    border-radius: 2px;
  }

  /* -- Stats Bar (below canvas) -- */
  .stats-bar {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .stat-pill {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 11px;
    color: var(--text-mid);
    white-space: nowrap;
    transition: background 0.2s, color 0.2s;
  }
  .stat-pill strong {
    color: var(--text);
    font-weight: 700;
  }
  .stat-pill .unit {
    color: var(--text-muted);
    font-size: 10px;
  }

  .stat-pill.size-pill {
    background: var(--accent-soft);
    border-color: var(--accent);
  }
  .stat-pill.size-pill strong {
    color: var(--accent);
    font-size: 13px;
  }

  .stat-sep {
    color: var(--border);
    font-size: 11px;
    padding: 0 2px;
  }

  /* -- Ruler visualization -- */
  .ruler-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    width: 100%;
    max-width: 600px;
  }

  .ruler-line {
    display: flex;
    align-items: center;
    gap: 0;
  }
  .ruler-edge {
    width: 1px;
    height: 10px;
    background: var(--accent);
    flex-shrink: 0;
  }
  .ruler-bar {
    flex: 1;
    height: 1.5px;
    background: var(--accent);
    position: relative;
  }
  .ruler-label {
    position: absolute;
    top: -16px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    font-weight: 700;
    color: var(--accent);
    white-space: nowrap;
    font-family: var(--font-body);
  }

  /* -- Vertical Ruler (left of canvas) -- */
  .ruler-vertical {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    flex-shrink: 0;
    position: relative;
    min-width: 20px;
    margin-right: 2px;
  }
  .ruler-v-edge {
    height: 1px;
    width: 7px;
    background: var(--accent);
    flex-shrink: 0;
  }
  .ruler-v-bar {
    flex: 1;
    width: 1.5px;
    background: var(--accent);
    position: relative;
    min-height: 10px;
  }
  .ruler-v-label {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) rotate(-90deg);
    font-size: 11px;
    font-weight: 700;
    color: var(--accent);
    white-space: nowrap;
    font-family: var(--font-body);
    background: var(--bg-main, #faf8f5);
    padding: 2px 4px;
    line-height: 1;
  }

  /* Desktop: flex row so vertical ruler + canvas sit side by side */
  .canvas-rulers-wrap {
    display: flex;
    align-items: flex-start;
    gap: 0;
    justify-content: center;
  }
}


@layer sheets {
  /* ============================================= */
  /* -- Sheet Backdrop -- */
  /* ============================================= */
  .sheet-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    -webkit-backdrop-filter: blur(2px);
    backdrop-filter: blur(2px);
    z-index: 55;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .sheet-backdrop.visible {
    display: block;
    opacity: 1;
  }

  /* ============================================= */
  /* -- Bottom Sheets (generic) -- */
  /* ============================================= */
  .bottom-sheet {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--panel);
    border-radius: 16px 16px 0 0;
    z-index: 60;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
    box-shadow: 0 -4px 20px rgba(0,0,0,0.12);
    overflow: hidden;
    max-height: 85vh;
    max-height: 85dvh;
    padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
  }
  @media (max-width: 640px) {
    .bottom-sheet { display: block; }
  }
  .bottom-sheet.open {
    transform: translateY(0);
  }
  .sheet-handle {
    display: flex;
    justify-content: center;
    padding: 10px 0 6px;
    cursor: grab;
    -webkit-tap-highlight-color: transparent;
  }
  .sheet-handle::after {
    content: '';
    width: 40px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
  }
  .sheet-title {
    font-family: var(--font-display);
    font-size: 18px;
    color: var(--text);
    padding: 0 16px 12px;
    border-bottom: 1px solid var(--border-light);
    text-wrap: balance;
  }
  .sheet-body {
    overflow-y: auto;
    overscroll-behavior: contain;
  }

  /* -- Font Sheet -- */
  .sheet-font { height: 70vh; height: 70dvh; }
  .sheet-font .sheet-body { flex: 1; overflow: hidden; display: flex; flex-direction: column; height: calc(70vh - 40px - 46px); height: calc(70dvh - 40px - 46px); }
  .sheet-font-search {
    position: sticky;
    top: 0;
    z-index: 2;
    padding: 8px 16px;
    background: var(--panel);
  }
  .sheet-font-search input {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 12px;
    font-family: var(--font-body);
    font-size: 16px;
    color: var(--text);
    background: #fff;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .sheet-font-search input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .sheet-font-tabs {
    display: flex;
    gap: 4px;
    padding: 4px 16px 8px;
    overflow-x: auto;
    flex-shrink: 0;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .sheet-font-tabs::-webkit-scrollbar { display: none; }
  .sheet-font-tabs .font-tab {
    min-height: 36px;
    padding: 6px 12px;
    font-size: 12px;
  }
  .sheet-font-list-wrap {
    flex: 1;
    overflow-y: auto;
    overscroll-behavior: contain;
    position: relative;
    min-height: 0;
  }
  .sheet-font-list-viewport {
    position: relative;
  }
  .sheet-font-item {
    display: flex;
    align-items: center;
    height: 80px;
    padding: 0 16px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    transition: background 0.12s;
    border-left: 3px solid transparent;
  }
  .sheet-font-item:active {
    background: var(--accent-soft);
  }
  .sheet-font-item.selected {
    background: var(--accent-soft);
    border-left-color: var(--accent);
  }
  .sheet-font-item-info {
    flex: 1;
    min-width: 0;
  }
  .sheet-font-item-name {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .sheet-font-item-meta {
    font-size: 12px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .sheet-font-item-check {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    color: var(--accent);
    display: none;
  }
  .sheet-font-item.selected .sheet-font-item-check {
    display: block;
  }
  .sheet-font-item-preview {
    width: 100%;
    height: 36px;
    image-rendering: pixelated;
    margin-top: 4px;
    border-radius: 3px;
    background: var(--bg);
  }
  .sheet-font-item-preview.loading {
    background: linear-gradient(90deg, var(--bg) 0%, var(--bg-deep) 50%, var(--bg) 100%);
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
  }
  @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

  /* -- Color Sheet -- */
  .sheet-color .sheet-body { padding: 16px; }
  .sheet-color-current {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--bg);
    border-radius: var(--radius);
    margin-bottom: 16px;
  }
  .sheet-color-swatch {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    flex-shrink: 0;
  }
  .sheet-color-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
  }
  .sheet-color-code {
    font-size: 12px;
    color: var(--text-muted);
  }
  .sheet-color-search {
    position: sticky;
    top: 0;
    z-index: 2;
    padding: 0 0 12px;
    background: var(--panel);
  }
  .sheet-color-search input {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 12px;
    font-family: var(--font-body);
    font-size: 16px;
    color: var(--text);
    background: #fff;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .sheet-color-search input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .sheet-color-grid {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-start;
    max-height: 50vh;
    overflow-y: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .sheet-color-grid .color-dot {
    width: 44px;
    height: 44px;
  }

  /* -- Settings Sheet -- */
  .sheet-settings .sheet-body { padding: 16px; }
  .sheet-settings-group {
    margin-bottom: 20px;
  }
  .sheet-settings-group:last-child { margin-bottom: 0; }
  .sheet-settings-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .sheet-settings .height-control { margin-bottom: 0; }
  .sheet-settings .aida-row { flex-wrap: wrap; gap: 8px; }
  .sheet-settings .aida-chip { min-height: 52px; padding: 12px 8px; flex: 0 0 calc(33.33% - 6px); }
  .sheet-settings .aida-chip-num { font-size: 22px; }
  .sheet-settings .custom-stitch-row { margin-top: 12px; }
  .sheet-settings .custom-count-input { min-height: 44px; font-size: 16px; }

  /* -- Info Sheet -- */
  .sheet-info .sheet-body { padding: 16px; }
  .sheet-info-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 16px;
  }
  .sheet-info-card {
    background: var(--bg);
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    padding: 12px;
    text-align: center;
  }
  .sheet-info-card-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--accent);
    line-height: 1.2;
  }
  .sheet-info-card-label {
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  .sheet-info-card.full-width {
    grid-column: 1 / -1;
  }
  .sheet-info-ruler {
    margin: 16px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
  }
  .sheet-info-ruler .ruler-line {
    width: 100%;
    max-width: 300px;
  }
  .sheet-info-lang {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .sheet-info-lang label {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-mid);
  }
  .sheet-info-lang select {
    flex: 1;
    padding: 8px 12px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: #fff;
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text);
    outline: none;
    -webkit-appearance: none;
    appearance: none;
  }

  /* -- Body scroll lock -- */
  body.sheet-open {
    overflow: hidden !important;
    touch-action: none;
  }
}


@layer responsive {
  /* ============================================= */
  /* -- Responsive: Mobile (<=640px) -- */
  /* Canvas First: topbar -> canvas -> toolbar     */
  /* ============================================= */
  @media (max-width: 640px) {
    html, body { height: 100vh; height: 100dvh; overflow: hidden; }
    body { height: 100vh; height: 100dvh; }

    .topbar {
      padding: calc(6px + env(safe-area-inset-top, 0px)) 12px 6px;
      gap: 8px;
      height: 48px;
      min-height: 48px;
    }
    .topbar-sep, .logo { display: none; }
    .lang-select {
      font-size: 12px;
      padding: 2px 16px 2px 4px;
      border: none;
      background-color: transparent;
      background-position: right 4px center;
      opacity: 0.7;
    }
    .unit-toggle { border-radius: var(--radius-sm); }
    .unit-toggle-btn { padding: 6px 12px; min-height: 36px; min-width: 36px; font-size: 12px; }

    .text-input-area { display: none; }
    .text-input { font-size: 16px; min-height: 36px; padding: 6px 12px; }
    .btn-download { padding: 8px; min-height: 36px; min-width: 36px; }
    .btn-download .dl-label { display: none; }

    .main-layout {
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
      flex: 1;
      padding-bottom: calc(228px + env(safe-area-inset-bottom, 0px));
    }

    .sidebar { display: none !important; }

    .preview-area {
      flex: 1;
      padding: 14px 16px 14px 40px; /* extra left for vertical ruler label */
      min-height: 0;
      max-height: none;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #mainCanvas {
      /* 48px header + 126px toolbar + safe-area + 100px stats(2rows)/rulers/gaps + 28px padding */
      max-height: calc(100vh - 48px - 228px - env(safe-area-inset-bottom, 0px) - 128px);
      max-height: calc(100dvh - 48px - 228px - env(safe-area-inset-bottom, 0px) - 128px);
    }

    /* Stats: responsive wrap on mobile */
    .stats-bar {
      gap: 4px 6px;
      padding: 0 4px;
      flex-wrap: wrap;
      justify-content: center;
      overflow: visible;
    }
    .stat-pill { padding: 2px 8px; font-size: 9px; }
    .stat-pill strong { font-size: 10px; }
    .stat-pill.size-pill strong { font-size: 11px; }
    .stat-sep { display: none; }

    /* Preview wrap: generous spacing between canvas, rulers, stats */
    .preview-canvas-wrap { gap: 14px; }

    /* Ruler: compact but readable */
    .ruler-info { gap: 2px; max-width: 100%; margin-top: 2px; }
    .ruler-label { font-size: 11px; top: -16px; }
    .ruler-edge { height: 8px; }

    /* Vertical ruler: visible on mobile */
    .ruler-vertical { display: flex; margin-right: 6px; }

    /* Canvas with rulers layout */
    .canvas-rulers-wrap {
      display: flex;
      align-items: flex-start;
      gap: 0;
      max-width: 100%;
      min-height: 0;
      justify-content: center;
    }
  }

  /* ============================================= */
  /* -- Mobile Toolbar (Slider + 3 Buttons) -- */
  /* ============================================= */
  .mobile-toolbar {
    display: none;
  }
  @media (max-width: 640px) {
    .mobile-toolbar {
      display: flex;
      flex-direction: column;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding-bottom: env(safe-area-inset-bottom, 0px);
      background: var(--panel);
      border-top: 1px solid var(--border);
      z-index: 50;
      box-shadow: 0 -4px 16px rgba(0,0,0,0.08);
    }
  }

  /* Row 1: Height slider â€” generous touch area */
  .mobile-slider-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 16px 8px;
    flex-shrink: 0;
  }
  .mobile-slider-row .height-slider {
    flex: 1;
    -webkit-appearance: none;
    appearance: none;
    height: 8px;
    border-radius: 4px;
    background: var(--border);
    outline: none;
  }
  .mobile-slider-row .height-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .mobile-slider-row .height-slider::-moz-range-thumb {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .mobile-slider-label {
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 700;
    color: var(--text-mid);
    white-space: nowrap;
    letter-spacing: 0.3px;
    text-transform: uppercase;
  }
  .mobile-slider-value {
    font-family: var(--font-body);
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
    min-width: 28px;
    text-align: right;
    line-height: 1;
  }
  .mobile-slider-unit {
    font-size: 11px;
    color: var(--text-mid);
    font-weight: 600;
  }

  /* Row 2: 3 action buttons â€” big touch targets */
  .mobile-buttons-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px 14px;
    flex-shrink: 0;
  }

  /* Shared toolbar button style â€” 52px height for easy thumb taps */
  .mobile-tb-btn {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    border-radius: 14px;
    padding: 0 14px;
    height: 52px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 600;
    min-width: 0;
    transition: background 0.12s, border-color 0.12s;
  }
  .mobile-tb-btn:active {
    background: var(--accent-soft);
    border-color: var(--accent);
  }
  .mobile-tb-btn svg {
    width: 20px;
    height: 20px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    flex-shrink: 0;
  }
  .mobile-tb-btn .tb-label {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    min-width: 0;
  }
  .mobile-tb-btn .tb-chevron {
    width: 12px;
    height: 12px;
    margin-left: auto;
    flex-shrink: 0;
    opacity: 0.4;
  }

  /* Mobile alignment row */
  .mobile-align-row {
    padding: 4px 12px 6px;
    gap: 8px;
  }
  .mobile-align-row .align-btn {
    min-height: 40px;
    border-radius: 10px;
  }

  /* Color button swatch */
  .mobile-color-swatch {
    width: 26px;
    height: 26px;
    min-width: 26px;
    border-radius: 50%;
    border: 2.5px solid var(--border);
    flex-shrink: 0;
  }

  /* -- Mobile Input Bar (above toolbar) -- */
  .mobile-input-bar {
    display: none;
  }
  @media (max-width: 640px) {
    .mobile-input-bar {
      display: flex;
      position: fixed;
      bottom: calc(176px + env(safe-area-inset-bottom, 0px));
      left: 0;
      right: 0;
      padding: 8px 12px;
      background: var(--panel);
      border-top: 1px solid var(--border);
      z-index: 49;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.04);
    }
    .mobile-text-input {
      width: 100%;
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 10px 14px;
      font-family: var(--font-display);
      font-size: 18px;
      color: var(--text);
      background: #fff;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      touch-action: manipulation;
      min-height: 44px;
      max-height: 100px;
      resize: none;
      overflow-y: auto;
      line-height: 1.3;
      field-sizing: content;
    }
    .mobile-text-input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }
    .mobile-text-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    /* Hint: tapping canvas focuses the input */
    .preview-area { cursor: text; }
  }

  /* -- Keyboard Open Mode: hide toolbar, maximize canvas space -- */
  @media (max-width: 640px) {
    body.keyboard-open .mobile-toolbar {
      transform: translateY(100%);
      pointer-events: none;
      opacity: 0;
      transition: transform 0.2s ease, opacity 0.15s ease;
    }
    body.keyboard-open .mobile-input-bar {
      bottom: env(safe-area-inset-bottom, 0px);
    }
    body.keyboard-open .main-layout {
      padding-bottom: calc(52px + env(safe-area-inset-bottom, 0px));
    }
    body.keyboard-open #mainCanvas {
      max-height: calc(100vh - 48px - 52px - env(safe-area-inset-bottom, 0px) - 80px);
      max-height: calc(100dvh - 48px - 52px - env(safe-area-inset-bottom, 0px) - 80px);
    }
    body.keyboard-open .stats-bar { display: none; }
    body.keyboard-open .ruler-info { display: none; }
  }

  /* -- Desktop: cursor hint for canvas tap-to-focus -- */
  @media (min-width: 641px) {
    .preview-area { cursor: text; }
  }

  /* ============================================= */
  /* -- Responsive: Small phones (<=380px) -- */
  /* ============================================= */
  @media (max-width: 380px) {
    .text-input { font-size: 16px; padding: 8px 10px; }
    .btn-download { padding: 8px 12px; }
    .preview-area { padding: 8px; min-height: 200px; }
    .color-dot { width: 36px; height: 36px; }
  }

  /* ============================================= */
  /* -- Responsive: Tablet (641-1024px) -- */
  /* ============================================= */
  @media (min-width: 641px) and (max-width: 1024px) {
    .sidebar { width: 250px; }
    .text-input { font-size: 18px; }
  }

  /* ============================================= */
  /* -- Responsive: Desktop (>1024px) -- */
  /* ============================================= */
  @media (min-width: 1025px) {
    .sidebar { width: 300px; }
  }

  /* -- Language selector -- */
  .lang-select {
    flex-shrink: 0;
    padding: 4px 6px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: #fff;
    font-family: var(--font-body);
    font-size: 11px;
    font-weight: 600;
    color: var(--text-mid);
    cursor: pointer;
    outline: none;
    transition: border-color 0.15s;
    -webkit-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23a99e8f'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 6px center;
    padding-right: 20px;
  }
  .lang-select:hover, .lang-select:focus { border-color: var(--accent); }
  .lang-select:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  /* -- Scrollbar global -- */
  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
}


/* Auth (optional) + Payment modal styles */
@layer components {

  /* Sign-in button in topbar (optional) */
  .btn-signin {
    padding: 0.35rem 0.75rem;
    margin-left: 0.5rem;
    border: 1px solid var(--border, #3a3a4a);
    border-radius: 6px;
    background: transparent;
    color: var(--text-primary, #e8e8e8);
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    white-space: nowrap;
    flex-shrink: 0;
    transition: background 0.2s, border-color 0.2s;
  }

  .btn-signin:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--accent, #c0392b);
  }

  /* Hide sign-in when authenticated */
  body.authenticated .btn-signin { display: none !important; }

  /* User button in topbar */
  #clerk-user-button {
    display: flex;
    align-items: center;
    margin-left: 0.5rem;
    flex-shrink: 0;
  }

  /* â”€â”€ Payment Modal â”€â”€ */

  #pay-modal {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s ease;
  }

  #pay-modal.pay-hidden {
    display: none;
  }

  .pay-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .pay-dialog {
    position: relative;
    background: #faf8f5;
    border-radius: 16px;
    padding: 2rem;
    max-width: 480px;
    width: 90vw;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    text-align: center;
  }

  .pay-close {
    position: absolute;
    top: 12px;
    right: 14px;
    background: none;
    border: none;
    font-size: 1.4rem;
    color: #a99e8f;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    transition: background 0.15s, color 0.15s;
  }

  .pay-close:hover {
    background: rgba(184, 58, 42, 0.08);
    color: #b83a2a;
  }

  .pay-title {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 1.4rem;
    color: #3d3229;
    margin-bottom: 0.3rem;
  }

  .pay-subtitle {
    font-size: 0.85rem;
    color: #7a6e60;
    margin-bottom: 1.5rem;
  }

  .pay-options {
    display: flex;
    gap: 1rem;
  }

  .pay-option {
    flex: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    padding: 1.5rem 1rem;
    border: 2px solid #e0d6c8;
    border-radius: 12px;
    background: #fff;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.15s;
    font-family: 'Anybody', system-ui, sans-serif;
  }

  .pay-option:hover {
    border-color: #b83a2a;
    transform: translateY(-2px);
  }

  .pay-option-featured {
    border-color: #c0392b;
    background: linear-gradient(180deg, #fff7f5, #fff);
  }

  .pay-option-badge {
    position: absolute;
    top: -10px;
    background: linear-gradient(135deg, #c0392b, #e74c3c);
    color: #fff;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 2px 10px;
    border-radius: 10px;
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  .pay-option-price {
    font-size: 1.6rem;
    font-weight: 700;
    color: #3d3229;
  }

  .pay-option-price small {
    font-size: 0.7rem;
    font-weight: 500;
    color: #7a6e60;
  }

  .pay-option-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #3d3229;
  }

  .pay-option-desc {
    font-size: 0.7rem;
    color: #a99e8f;
    line-height: 1.3;
  }

  /* Mobile: stack vertically */
  @media (max-width: 480px) {
    .pay-options { flex-direction: column; }
    .pay-dialog { padding: 1.5rem; }
  }
}

</style>
</head>
<body>

<!-- -- Top Bar -- -->
<header class="topbar">
  <div class="logo">
    <span class="logo-x">&#10006;</span>
    <span class="logo-text">Word<em>2</em>Stitch</span>
  </div>

  <div class="topbar-sep"></div>

  <div class="text-input-area">
    <textarea
      class="text-input"
      id="textInput"
      aria-label="Text to render"
      placeholder="Type your text hereâ€¦"
      data-i18n-placeholder="placeholder_text"
      maxlength="200"
      autocomplete="off"
      spellcheck="false"
      rows="1"
    >Welcome</textarea>
  </div>

  <select class="lang-select" id="langSelect" aria-label="Language">
    <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
    <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
    <option value="fr">ðŸ‡«ðŸ‡· FR</option>
    <option value="de">ðŸ‡©ðŸ‡ª DE</option>
    <option value="it">ðŸ‡®ðŸ‡¹ IT</option>
    <option value="pt">ðŸ‡§ðŸ‡· PT</option>
    <option value="nl">ðŸ‡³ðŸ‡± NL</option>
    <option value="ja">ðŸ‡¯ðŸ‡µ JA</option>
    <option value="ko">ðŸ‡°ðŸ‡· KO</option>
    <option value="zh">ðŸ‡¨ðŸ‡³ ZH</option>
    <option value="ru">ðŸ‡·ðŸ‡º RU</option>
    <option value="pl">ðŸ‡µðŸ‡± PL</option>
    <option value="sv">ðŸ‡¸ðŸ‡ª SV</option>
    <option value="da">ðŸ‡©ðŸ‡° DA</option>
    <option value="fi">ðŸ‡«ðŸ‡® FI</option>
    <option value="uk">ðŸ‡ºðŸ‡¦ UK</option>
    <option value="hu">ðŸ‡­ðŸ‡º HU</option>
  </select>

  <div class="unit-toggle" id="unitToggle">
    <button class="unit-toggle-btn active" data-unit="metric" aria-pressed="true" aria-label="Centimeters">cm</button>
    <button class="unit-toggle-btn" data-unit="imperial" aria-pressed="false" aria-label="Inches">in</button>
  </div>

  <button class="btn-download" id="btnDownload" aria-label="Download PDF">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    <span class="dl-label">PDF</span>
  </button>

  <button class="btn-signin" id="btn-signin" aria-label="Sign In" onclick="window.Clerk && window.Clerk.openSignIn()">Sign In</button>
  <div id="clerk-user-button"></div>
</header>

<!-- -- Main Split Layout -- -->
<main class="main-layout">

  <!-- -- Left Sidebar: Controls -- -->
  <aside class="sidebar">

    <!-- Font Search + Header -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg>
        <span data-i18n="section_font">Font</span>
      </div>
      <input
        type="text"
        class="font-search"
        id="fontSearch"
        aria-label="Search fonts"
        placeholder="Search fontsâ€¦"
        data-i18n-placeholder="search_fonts"
        autocomplete="off"
        spellcheck="false"
      />
      <div class="font-tabs" id="fontCategoryTabs">
        <button class="font-tab active" data-category="all">All</button>
      </div>
    </div>

    <!-- Font List (scrollable) -->
    <div class="font-list" id="fontList"></div>

    <!-- Height Control -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h4M18 12h4M7 7l2 2M15 15l2 2M7 17l2-2M15 7l2-2"/></svg>
        <span data-i18n="section_height">Stitch Height</span>
      </div>
      <div class="height-control">
        <input type="range" class="height-slider" id="heightSlider" min="8" max="30" value="16" step="1" aria-label="Stitch height" />
        <div>
          <span class="height-value" id="heightValue">16</span>
          <span class="height-unit" data-i18n="unit_px">st</span>
        </div>
      </div>
    </div>

    <!-- Text Alignment -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        <span data-i18n="section_align">Alignment</span>
      </div>
      <div class="align-row" id="alignRow">
        <button class="align-btn" data-align="left" aria-label="Align left">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
          <span data-i18n="align_left">Left</span>
        </button>
        <button class="align-btn active" data-align="center" aria-label="Align center">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
          <span data-i18n="align_center">Center</span>
        </button>
        <button class="align-btn" data-align="right" aria-label="Align right">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/></svg>
          <span data-i18n="align_right">Right</span>
        </button>
      </div>
    </div>

    <!-- Color Picker -->
    <div class="sidebar-section sidebar-color-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
        <span data-i18n="section_color">Thread Color</span>
      </div>
      <div class="color-row" id="colorRow"></div>
      <!-- Desktop color popover (all 449 DMC colors with search) -->
      <div class="color-popover" id="colorPopover">
        <div class="color-popover-header">
          <input type="text" class="color-popover-search" id="colorPopoverSearch" placeholder="Search DMC colorsâ€¦" autocomplete="off" spellcheck="false" />
          <button class="color-popover-close" id="colorPopoverClose" aria-label="Close">&times;</button>
        </div>
        <div class="color-popover-grid" id="colorPopoverGrid"></div>
      </div>
    </div>

    <!-- Aida Count -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/></svg>
        <span data-i18n="section_fabric">Fabric</span>
      </div>
      <div class="aida-row" id="aidaRow">
        <button class="aida-chip" data-count="11">
          <span class="aida-chip-num">11</span>
          <span class="aida-chip-label" data-i18n="label_aida">Aida</span>
        </button>
        <button class="aida-chip selected" data-count="14">
          <span class="aida-chip-num">14</span>
          <span class="aida-chip-label" data-i18n="label_aida">Aida</span>
        </button>
        <button class="aida-chip" data-count="16">
          <span class="aida-chip-num">16</span>
          <span class="aida-chip-label" data-i18n="label_aida">Aida</span>
        </button>
        <button class="aida-chip" data-count="18">
          <span class="aida-chip-num">18</span>
          <span class="aida-chip-label" data-i18n="label_aida">Aida</span>
        </button>
        <button class="aida-chip" data-count="custom" id="aidaCustomChip">
          <span class="aida-chip-num">âœŽ</span>
          <span class="aida-chip-label" data-i18n="label_custom">Custom</span>
        </button>
      </div>
      <div class="custom-stitch-row" id="customStitchRow">
        <div class="custom-stitch-header">
          <span class="stitch-label" data-i18n="label_stitch_length">Stitch length</span>
          <div class="stitch-value-display">
            <span class="stitch-value-num" id="customStitchValue">3.0</span>
            <span class="stitch-value-unit" id="customStitchUnit">mm</span>
          </div>
        </div>
        <input type="range" class="custom-stitch-slider" id="customStitchSlider" min="1" max="10" value="3" step="0.1" aria-label="Custom stitch length" />
        <div class="custom-stitch-equiv" id="customStitchEquiv"></div>
      </div>
    </div>

  </aside>

  <!-- -- Right: Preview -- -->
  <div class="preview-area" id="previewArea">

    <!-- Loading overlay -->
    <div class="preview-loading hidden" id="previewLoading">
      <div class="loading-spinner"></div>
      <div class="loading-text" data-i18n="loading_text">Rasterizingâ€¦</div>
    </div>

    <div class="preview-empty" id="previewEmpty">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <line x1="3" y1="9" x2="21" y2="9"/>
        <line x1="3" y1="15" x2="21" y2="15"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
        <line x1="15" y1="3" x2="15" y2="21"/>
      </svg>
      <span data-i18n="empty_state">Type something to see your pattern</span>
    </div>

    <div class="preview-canvas-wrap" id="previewWrap" style="display:none;">
      <!-- Canvas + vertical ruler wrapper -->
      <div class="canvas-rulers-wrap">
        <!-- Vertical ruler (left of canvas, mobile only) -->
        <div class="ruler-vertical" id="rulerVertical">
          <div class="ruler-v-edge"></div>
          <div class="ruler-v-bar">
            <div class="ruler-v-label" id="rulerHeight">--</div>
          </div>
          <div class="ruler-v-edge"></div>
        </div>
        <canvas id="mainCanvas"></canvas>
      </div>

      <!-- Ruler showing width in cm -->
      <div class="ruler-info" id="rulerInfo">
        <div class="ruler-line">
          <div class="ruler-edge"></div>
          <div class="ruler-bar">
            <div class="ruler-label" id="rulerWidth">--</div>
          </div>
          <div class="ruler-edge"></div>
        </div>
      </div>

      <!-- Stats pills -->
      <div class="stats-bar" id="statsBar">
        <div class="stat-pill size-pill">
          <strong id="statSizeCm">--</strong>
          <span class="unit" id="statSizeUnit">cm</span>
        </div>
        <div class="stat-sep">.</div>
        <div class="stat-pill">
          <strong id="statStitchesW">--</strong>x<strong id="statStitchesH">--</strong>
          <span class="unit" data-i18n="unit_stitches">stitches</span>
        </div>
        <div class="stat-sep">.</div>
        <div class="stat-pill">
          <strong id="statTotal">--</strong>
          <span class="unit" data-i18n="unit_crosses">crosses</span>
        </div>
        <div class="stat-sep">.</div>
        <div class="stat-pill">
          DMC <strong id="statDmc">--</strong>
          <span class="unit" id="statThread">--</span>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- -- Mobile Input Bar -- -->
<div class="mobile-input-bar" id="mobileInputBar">
  <textarea
    class="mobile-text-input"
    id="mobileTextInput"
    aria-label="Text to render"
    placeholder="Type your text hereâ€¦"
    data-i18n-placeholder="placeholder_text"
    maxlength="200"
    autocomplete="off"
    spellcheck="false"
    rows="2"
  >Welcome</textarea>
</div>

<!-- -- Mobile Toolbar (Slider + 3 Buttons) -- -->
<div class="mobile-toolbar" id="mobileToolbar">
  <!-- Row 1: Height slider -->
  <div class="mobile-slider-row">
    <span class="mobile-slider-label">H</span>
    <input type="range" class="height-slider" id="mobileHeightSlider" min="8" max="30" value="16" step="1" />
    <span class="mobile-slider-value" id="mobileHeightValue">16</span>
    <span class="mobile-slider-unit">st</span>
  </div>
  <!-- Row 2: Text alignment -->
  <div class="mobile-align-row" id="mobileAlignRow">
    <button class="align-btn" data-align="left" aria-label="Align left">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
    </button>
    <button class="align-btn active" data-align="center" aria-label="Align center">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
    </button>
    <button class="align-btn" data-align="right" aria-label="Align right">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/></svg>
    </button>
  </div>
  <!-- Row 3: Aida + Font + Color buttons -->
  <div class="mobile-buttons-row">
    <button class="mobile-tb-btn" id="mobileAidaBtn" aria-label="Fabric settings">
      <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/></svg>
      <span class="tb-label" id="mobileAidaValue">14 ct</span>
      <svg class="tb-chevron" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
    </button>
    <button class="mobile-tb-btn" id="mobileFontBtn" aria-label="Select font">
      <svg viewBox="0 0 24 24"><path d="M4 7V4h16v3"/><path d="M9 20h6"/><path d="M12 4v16"/></svg>
      <span class="tb-label" id="mobileFontName">Font</span>
      <svg class="tb-chevron" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
    </button>
    <button class="mobile-tb-btn" id="mobileColorBtn" aria-label="Thread color">
      <div class="mobile-color-swatch" id="mobileColorSwatch"></div>
      <span class="tb-label" id="mobileColorName">Black</span>
      <svg class="tb-chevron" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
    </button>
  </div>
</div>

<!-- -- Sheet Backdrop -- -->
<div class="sheet-backdrop" id="sheetBackdrop"></div>

<!-- -- Font Bottom Sheet -- -->
<div class="bottom-sheet sheet-font" id="sheetFont" role="dialog" aria-modal="true" aria-label="Font selector">
  <div class="sheet-handle" id="sheetFontHandle"></div>
  <div class="sheet-title" data-i18n="section_font">Font</div>
  <div class="sheet-body">
    <div class="sheet-font-search">
      <input type="text" id="sheetFontSearch" aria-label="Search fonts" placeholder="Search fontsâ€¦" data-i18n-placeholder="search_fonts" autocomplete="off" spellcheck="false" />
    </div>
    <div class="sheet-font-tabs" id="sheetFontTabs"></div>
    <div class="sheet-font-list-wrap" id="sheetFontListWrap" role="listbox" aria-label="Font list">
      <div class="sheet-font-list-viewport" id="sheetFontListViewport"></div>
    </div>
  </div>
</div>

<!-- -- Color Bottom Sheet -- -->
<div class="bottom-sheet sheet-color" id="sheetColor" role="dialog" aria-modal="true" aria-label="Color selector">
  <div class="sheet-handle" id="sheetColorHandle"></div>
  <div class="sheet-title" data-i18n="section_color">Thread Color</div>
  <div class="sheet-body">
    <div class="sheet-color-current" id="sheetColorCurrent">
      <div class="sheet-color-swatch" id="sheetColorSwatch"></div>
      <div>
        <div class="sheet-color-name" id="sheetColorName">--</div>
        <div class="sheet-color-code" id="sheetColorCode">DMC --</div>
      </div>
    </div>
    <div class="sheet-color-search">
      <input type="text" id="sheetColorSearch" placeholder="Search DMC colorsâ€¦" autocomplete="off" spellcheck="false" />
    </div>
    <div class="sheet-color-grid" id="sheetColorGrid"></div>
  </div>
</div>

<!-- -- Settings Bottom Sheet -- -->
<div class="bottom-sheet sheet-settings" id="sheetSettings" role="dialog" aria-modal="true" aria-label="Fabric & Stitch">
  <div class="sheet-handle" id="sheetSettingsHandle"></div>
  <div class="sheet-title" data-i18n="sheet_fabric">Fabric &amp; Stitch</div>
  <div class="sheet-body">
    <div class="sheet-settings-group">
      <div class="sheet-settings-label">
        <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h4M18 12h4M7 7l2 2M15 15l2 2M7 17l2-2M15 7l2-2"/></svg>
        <span data-i18n="section_height">Stitch Height</span>
      </div>
      <div class="height-control">
        <input type="range" class="height-slider" id="sheetHeightSlider" min="8" max="30" value="16" step="1" aria-label="Stitch height" />
        <div>
          <span class="height-value" id="sheetHeightValue">16</span>
          <span class="height-unit" data-i18n="unit_px">st</span>
        </div>
      </div>
    </div>
    <div class="sheet-settings-group">
      <div class="sheet-settings-label">
        <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/></svg>
        <span data-i18n="section_fabric">Fabric</span>
      </div>
      <div class="aida-row" id="sheetAidaRow">
        <button class="aida-chip" data-count="11"><span class="aida-chip-num">11</span><span class="aida-chip-label" data-i18n="label_aida">Aida</span></button>
        <button class="aida-chip selected" data-count="14"><span class="aida-chip-num">14</span><span class="aida-chip-label" data-i18n="label_aida">Aida</span></button>
        <button class="aida-chip" data-count="16"><span class="aida-chip-num">16</span><span class="aida-chip-label" data-i18n="label_aida">Aida</span></button>
        <button class="aida-chip" data-count="18"><span class="aida-chip-num">18</span><span class="aida-chip-label" data-i18n="label_aida">Aida</span></button>
        <button class="aida-chip" data-count="custom"><span class="aida-chip-num">&#9998;</span><span class="aida-chip-label" data-i18n="label_custom">Custom</span></button>
      </div>
      <div class="custom-stitch-row" id="sheetCustomStitchRow">
        <div class="custom-stitch-header">
          <span class="stitch-label" data-i18n="label_stitch_length">Stitch length</span>
          <div class="stitch-value-display">
            <span class="stitch-value-num" id="sheetCustomStitchValue">3.0</span>
            <span class="stitch-value-unit" id="sheetCustomStitchUnit">mm</span>
          </div>
        </div>
        <input type="range" class="custom-stitch-slider" id="sheetCustomStitchSlider" min="1" max="10" value="3" step="0.1" aria-label="Custom stitch length" />
        <div class="custom-stitch-equiv" id="sheetCustomStitchEquiv"></div>
      </div>
    </div>
  </div>
</div>

<!-- -- Info Bottom Sheet -- -->
<div class="bottom-sheet sheet-info" id="sheetInfo" role="dialog" aria-modal="true" aria-label="Pattern info">
  <div class="sheet-handle" id="sheetInfoHandle"></div>
  <div class="sheet-title" data-i18n="sheet_info">Pattern Info</div>
  <div class="sheet-body">
    <div class="sheet-info-cards">
      <div class="sheet-info-card full-width">
        <div class="sheet-info-card-value" id="infoSize">-- x --</div>
        <div class="sheet-info-card-label" id="infoSizeUnit">cm</div>
      </div>
      <div class="sheet-info-card">
        <div class="sheet-info-card-value" id="infoStitches">--x--</div>
        <div class="sheet-info-card-label" data-i18n="unit_stitches">stitches</div>
      </div>
      <div class="sheet-info-card">
        <div class="sheet-info-card-value" id="infoCrosses">--</div>
        <div class="sheet-info-card-label" data-i18n="unit_crosses">crosses</div>
      </div>
      <div class="sheet-info-card">
        <div class="sheet-info-card-value" id="infoDmc">--</div>
        <div class="sheet-info-card-label" data-i18n="label_dmc">DMC</div>
      </div>
      <div class="sheet-info-card">
        <div class="sheet-info-card-value" id="infoThread">--</div>
        <div class="sheet-info-card-label" data-i18n="label_thread">Thread</div>
      </div>
    </div>
    <div class="sheet-info-ruler" id="infoRuler">
      <div class="ruler-line">
        <div class="ruler-edge"></div>
        <div class="ruler-bar"><div class="ruler-label" id="infoRulerWidth">--</div></div>
        <div class="ruler-edge"></div>
      </div>
    </div>
    <div class="sheet-info-lang">
      <label data-i18n="label_language">Language</label>
      <select id="sheetLangSelect">
        <option value="en">EN English</option>
        <option value="es">ES EspaÃ±ol</option>
        <option value="fr">FR FranÃ§ais</option>
        <option value="de">DE Deutsch</option>
        <option value="it">IT Italiano</option>
        <option value="pt">PT PortuguÃªs</option>
        <option value="nl">NL Nederlands</option>
        <option value="ja">JA Japanese</option>
        <option value="ko">KO Korean</option>
        <option value="zh">ZH Chinese</option>
        <option value="ru">RU Russian</option>
        <option value="pl">PL Polish</option>
        <option value="sv">SV Swedish</option>
        <option value="da">DA Danish</option>
        <option value="fi">FI Finnish</option>
        <option value="uk">UK Ukrainian</option>
        <option value="hu">HU Hungarian</option>
      </select>
    </div>
  </div>
</div>

<!-- -- Payment Modal -- -->
<div id="pay-modal" class="pay-hidden">
  <div class="pay-backdrop" id="pay-backdrop"></div>
  <div class="pay-dialog">
    <button class="pay-close" id="pay-close">&times;</button>
    <div class="pay-title">Download Your Pattern</div>
    <div class="pay-subtitle">Choose how you'd like to get your cross-stitch PDF</div>
    <div class="pay-options">
      <button class="pay-option" id="pay-onetime">
        <span class="pay-option-price">$1.99</span>
        <span class="pay-option-label">This PDF</span>
        <span class="pay-option-desc">One-time download, no account needed</span>
      </button>
      <button class="pay-option pay-option-featured" id="pay-subscribe">
        <span class="pay-option-badge">Best Value</span>
        <span class="pay-option-price">$4.99<small>/mo</small></span>
        <span class="pay-option-label">Unlimited</span>
        <span class="pay-option-desc">All PDFs, cancel anytime</span>
      </button>
    </div>
  </div>
</div>

<!-- JS loaded via assemble.js from ui-modules/ -->


<!-- â•â•â• Clerk Auth SDK â•â•â• -->
<script
  async
  crossorigin="anonymous"
  data-clerk-publishable-key="pk_test_bWFpbi13b21iYXQtNzIuY2xlcmsuYWNjb3VudHMuZGV2JA"
  src="https://main-wombat-72.clerk.accounts.dev/npm/@clerk/clerk-js@5/dist/clerk.browser.js"
  type="text/javascript"
></script>

<!-- â•â•â• jsPDF CDN â•â•â• -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha384-JcnsjUPPylna1s1fvi1u12X5qjY5OL56iySh75FdtrwhO/SWXgMjoVqcKyIIWOLk" crossorigin="anonymous"></script>

<!-- â•â•â• Embedded Font & Color Data â•â•â• -->
<script>
// DMC thread color data for word2stitch (449 colors)
const DMC_COLORS = [
  {"code":"blanc","name":"White","hex":"#FFFFFF"},
  {"code":"ecru","name":"Ecru","hex":"#F0EADA"},
  {"code":"150","name":"Dusty Rose Ultra Very Dark","hex":"#AB0249"},
  {"code":"151","name":"Dusty Rose Very Light","hex":"#F0D6D7"},
  {"code":"152","name":"Shell Pink Medium Light","hex":"#E0A0A7"},
  {"code":"153","name":"Violet Very Light","hex":"#E6CCD9"},
  {"code":"154","name":"Grape Very Dark","hex":"#572333"},
  {"code":"155","name":"Blue Violet Medium Dark","hex":"#8098C0"},
  {"code":"156","name":"Blue Violet Medium Light","hex":"#A3B8D2"},
  {"code":"157","name":"Cornflower Blue Very Light","hex":"#BBCBDA"},
  {"code":"158","name":"Cornflower Blue Medium Very Dark","hex":"#4C5872"},
  {"code":"159","name":"Blue Gray Light","hex":"#C7CAD7"},
  {"code":"160","name":"Blue Gray Medium","hex":"#999FB7"},
  {"code":"161","name":"Blue Gray","hex":"#7880A0"},
  {"code":"162","name":"Blue Ultra Very Light","hex":"#DBEBF3"},
  {"code":"163","name":"Celadon Green Medium","hex":"#536E54"},
  {"code":"164","name":"Forest Green Light","hex":"#C8D8B8"},
  {"code":"165","name":"Moss Green Very Light","hex":"#EFF4A8"},
  {"code":"166","name":"Moss Green Medium Light","hex":"#C0C840"},
  {"code":"167","name":"Yellow Beige Very Dark","hex":"#A08050"},
  {"code":"168","name":"Pewter Very Light","hex":"#D1D1D1"},
  {"code":"169","name":"Pewter Light","hex":"#848484"},
  {"code":"208","name":"Lavender Very Dark","hex":"#835B8B"},
  {"code":"209","name":"Lavender Dark","hex":"#A37BA7"},
  {"code":"210","name":"Lavender Medium","hex":"#C39FC3"},
  {"code":"211","name":"Lavender Light","hex":"#E3CBE3"},
  {"code":"221","name":"Shell Pink Very Dark","hex":"#883848"},
  {"code":"223","name":"Shell Pink Light","hex":"#CC8888"},
  {"code":"224","name":"Shell Pink Very Light","hex":"#E8C0C0"},
  {"code":"225","name":"Shell Pink Ultra Very Light","hex":"#FFDFDF"},
  {"code":"300","name":"Mahogany Very Dark","hex":"#6F2F00"},
  {"code":"301","name":"Mahogany Medium","hex":"#B35F2B"},
  {"code":"304","name":"Christmas Red Medium","hex":"#B3272F"},
  {"code":"307","name":"Lemon","hex":"#FDED54"},
  {"code":"309","name":"Rose Dark","hex":"#B83858"},
  {"code":"310","name":"Black","hex":"#000000"},
  {"code":"311","name":"Navy Blue Medium","hex":"#4E6583"},
  {"code":"312","name":"Navy Blue Light","hex":"#35536B"},
  {"code":"315","name":"Antique Mauve Medium Very Dark","hex":"#814952"},
  {"code":"316","name":"Antique Mauve Medium","hex":"#B7777F"},
  {"code":"317","name":"Pewter Gray","hex":"#6C6C6C"},
  {"code":"318","name":"Steel Gray Light","hex":"#ABABAB"},
  {"code":"319","name":"Pistachio Green Very Dark","hex":"#205F47"},
  {"code":"320","name":"Pistachio Green Medium","hex":"#698867"},
  {"code":"321","name":"Christmas Red","hex":"#C72C2C"},
  {"code":"322","name":"Navy Blue Very Light","hex":"#5A7692"},
  {"code":"326","name":"Rose Very Dark","hex":"#A73757"},
  {"code":"327","name":"Violet Dark","hex":"#633666"},
  {"code":"333","name":"Blue Violet Very Dark","hex":"#5C5478"},
  {"code":"334","name":"Baby Blue Medium","hex":"#85ABCA"},
  {"code":"335","name":"Rose","hex":"#EE546E"},
  {"code":"336","name":"Navy Blue","hex":"#253B73"},
  {"code":"340","name":"Blue Violet Medium","hex":"#ADA7C7"},
  {"code":"341","name":"Blue Violet Light","hex":"#B7BFDD"},
  {"code":"347","name":"Salmon Very Dark","hex":"#BF2D2D"},
  {"code":"349","name":"Coral Dark","hex":"#D21035"},
  {"code":"350","name":"Coral Medium","hex":"#E33044"},
  {"code":"351","name":"Coral","hex":"#E96A67"},
  {"code":"352","name":"Coral Light","hex":"#FD9C97"},
  {"code":"353","name":"Peach","hex":"#FED7CC"},
  {"code":"355","name":"Terra Cotta Dark","hex":"#983F33"},
  {"code":"356","name":"Terra Cotta Medium","hex":"#E7917B"},
  {"code":"367","name":"Pistachio Green Dark","hex":"#617A60"},
  {"code":"368","name":"Pistachio Green Light","hex":"#A6C298"},
  {"code":"369","name":"Pistachio Green Very Light","hex":"#D7EDCC"},
  {"code":"370","name":"Mustard Medium","hex":"#B88A00"},
  {"code":"371","name":"Mustard","hex":"#BF9B5F"},
  {"code":"372","name":"Mustard Light","hex":"#CCB784"},
  {"code":"400","name":"Mahogany Dark","hex":"#8F4108"},
  {"code":"402","name":"Mahogany Very Light","hex":"#F7A777"},
  {"code":"407","name":"Desert Sand Dark","hex":"#BB8B77"},
  {"code":"413","name":"Pewter Gray Dark","hex":"#565656"},
  {"code":"414","name":"Steel Gray Dark","hex":"#8C8C8C"},
  {"code":"415","name":"Pearl Gray","hex":"#D3D3D6"},
  {"code":"420","name":"Hazelnut Brown Dark","hex":"#A07042"},
  {"code":"422","name":"Hazelnut Brown Light","hex":"#C69F7B"},
  {"code":"433","name":"Brown Medium","hex":"#7A451F"},
  {"code":"434","name":"Brown Light","hex":"#985E33"},
  {"code":"435","name":"Brown Very Light","hex":"#B87748"},
  {"code":"436","name":"Tan","hex":"#CB9051"},
  {"code":"437","name":"Tan Light","hex":"#E4BB8E"},
  {"code":"444","name":"Lemon Dark","hex":"#FFD600"},
  {"code":"445","name":"Lemon Light","hex":"#FFEB84"},
  {"code":"451","name":"Shell Gray Dark","hex":"#917B73"},
  {"code":"452","name":"Shell Gray Medium","hex":"#C0B3AC"},
  {"code":"453","name":"Shell Gray Light","hex":"#D7CECB"},
  {"code":"469","name":"Avocado Green","hex":"#72843C"},
  {"code":"470","name":"Avocado Green Light","hex":"#94B257"},
  {"code":"471","name":"Avocado Green Very Light","hex":"#AEBF79"},
  {"code":"472","name":"Avocado Green Ultra Light","hex":"#D8E498"},
  {"code":"498","name":"Christmas Red Dark","hex":"#A7132B"},
  {"code":"500","name":"Blue Green Very Dark","hex":"#005441"},
  {"code":"501","name":"Blue Green Dark","hex":"#3A6A5B"},
  {"code":"502","name":"Blue Green","hex":"#869E8B"},
  {"code":"503","name":"Blue Green Medium","hex":"#A4BDAF"},
  {"code":"504","name":"Blue Green Very Light","hex":"#C4D9CC"},
  {"code":"517","name":"Wedgewood Dark","hex":"#3B768F"},
  {"code":"518","name":"Wedgewood Light","hex":"#4F8DA5"},
  {"code":"519","name":"Sky Blue","hex":"#88B4C8"},
  {"code":"520","name":"Fern Green Dark","hex":"#666D56"},
  {"code":"522","name":"Fern Green","hex":"#96967F"},
  {"code":"523","name":"Fern Green Light","hex":"#ACB7A5"},
  {"code":"524","name":"Fern Green Very Light","hex":"#C4CDC1"},
  {"code":"535","name":"Ash Gray Very Light","hex":"#63645C"},
  {"code":"543","name":"Beige Brown Ultra Very Light","hex":"#F2E3CE"},
  {"code":"550","name":"Violet Very Dark","hex":"#501A55"},
  {"code":"552","name":"Violet Medium","hex":"#804E7D"},
  {"code":"553","name":"Violet","hex":"#9B6E94"},
  {"code":"554","name":"Violet Light","hex":"#DBB3CB"},
  {"code":"561","name":"Jade Very Dark","hex":"#2A5649"},
  {"code":"562","name":"Jade Medium","hex":"#457D64"},
  {"code":"563","name":"Jade Light","hex":"#82B39E"},
  {"code":"564","name":"Jade Very Light","hex":"#AFCBBC"},
  {"code":"580","name":"Moss Green Dark","hex":"#808300"},
  {"code":"581","name":"Moss Green","hex":"#A7A757"},
  {"code":"597","name":"Turquoise","hex":"#539590"},
  {"code":"598","name":"Turquoise Light","hex":"#86ADAB"},
  {"code":"600","name":"Cranberry Very Dark","hex":"#D32159"},
  {"code":"601","name":"Cranberry Dark","hex":"#D63962"},
  {"code":"602","name":"Cranberry Medium","hex":"#E55F83"},
  {"code":"603","name":"Cranberry","hex":"#FFA4BE"},
  {"code":"604","name":"Cranberry Light","hex":"#FFBDCA"},
  {"code":"605","name":"Cranberry Very Light","hex":"#FFCFD6"},
  {"code":"606","name":"Bright Orange Red","hex":"#FA2700"},
  {"code":"608","name":"Bright Orange","hex":"#FD5D00"},
  {"code":"610","name":"Drab Brown Dark","hex":"#755D43"},
  {"code":"611","name":"Drab Brown","hex":"#987758"},
  {"code":"612","name":"Drab Brown Light","hex":"#BC9777"},
  {"code":"613","name":"Drab Brown Very Light","hex":"#DCC2AA"},
  {"code":"632","name":"Desert Sand Ultra Very Dark","hex":"#875C4F"},
  {"code":"640","name":"Beige Gray Very Dark","hex":"#8A7567"},
  {"code":"642","name":"Beige Gray Dark","hex":"#A49483"},
  {"code":"644","name":"Beige Gray Medium","hex":"#DDD8CB"},
  {"code":"645","name":"Beaver Gray Very Dark","hex":"#6E6E6E"},
  {"code":"646","name":"Beaver Gray Dark","hex":"#878787"},
  {"code":"647","name":"Beaver Gray Medium","hex":"#B0B0B0"},
  {"code":"648","name":"Beaver Gray Light","hex":"#BCBCBC"},
  {"code":"666","name":"Bright Red","hex":"#E31D42"},
  {"code":"676","name":"Old Gold Light","hex":"#E5BE84"},
  {"code":"677","name":"Old Gold Very Light","hex":"#F5E2BC"},
  {"code":"680","name":"Old Gold Dark","hex":"#BC8D0E"},
  {"code":"699","name":"Christmas Green","hex":"#056533"},
  {"code":"700","name":"Christmas Green Bright","hex":"#10753D"},
  {"code":"701","name":"Christmas Green Light","hex":"#4F8958"},
  {"code":"702","name":"Kelly Green","hex":"#5CA462"},
  {"code":"703","name":"Chartreuse","hex":"#7BB661"},
  {"code":"704","name":"Chartreuse Bright","hex":"#9CCB65"},
  {"code":"718","name":"Plum","hex":"#893456"},
  {"code":"720","name":"Orange Spice Dark","hex":"#E55B00"},
  {"code":"721","name":"Orange Spice Medium","hex":"#F27D22"},
  {"code":"722","name":"Orange Spice Light","hex":"#F68D39"},
  {"code":"725","name":"Topaz","hex":"#FFC700"},
  {"code":"726","name":"Topaz Light","hex":"#FDD758"},
  {"code":"727","name":"Topaz Very Light","hex":"#FFEBA8"},
  {"code":"729","name":"Old Gold Medium","hex":"#D08900"},
  {"code":"730","name":"Olive Green Very Dark","hex":"#856F00"},
  {"code":"731","name":"Olive Green Dark","hex":"#957B00"},
  {"code":"732","name":"Olive Green","hex":"#9C8643"},
  {"code":"733","name":"Olive Green Medium","hex":"#BCA76B"},
  {"code":"734","name":"Olive Green Light","hex":"#C8BA88"},
  {"code":"738","name":"Tan Very Light","hex":"#ECCC9E"},
  {"code":"739","name":"Tan Ultra Very Light","hex":"#F8E4C8"},
  {"code":"740","name":"Tangerine","hex":"#FF8B00"},
  {"code":"741","name":"Tangerine Medium","hex":"#FFA300"},
  {"code":"742","name":"Tangerine Light","hex":"#FFB755"},
  {"code":"743","name":"Yellow Medium","hex":"#FED376"},
  {"code":"744","name":"Yellow Pale","hex":"#FFE793"},
  {"code":"745","name":"Yellow Light Pale","hex":"#FFEEAD"},
  {"code":"746","name":"Off White","hex":"#FCFCF6"},
  {"code":"747","name":"Sky Blue Very Light","hex":"#E1F5FF"},
  {"code":"754","name":"Peach Light","hex":"#FAD3C3"},
  {"code":"758","name":"Terra Cotta Very Light","hex":"#EEC3B5"},
  {"code":"760","name":"Salmon","hex":"#F59B95"},
  {"code":"761","name":"Salmon Light","hex":"#FFC9C9"},
  {"code":"762","name":"Pearl Gray Very Light","hex":"#ECECEC"},
  {"code":"772","name":"Pine Green Light","hex":"#D9EAD3"},
  {"code":"775","name":"Baby Blue Very Light","hex":"#D9ECF2"},
  {"code":"776","name":"Pink Medium","hex":"#FAAAB4"},
  {"code":"777","name":"Raspberry Very Dark","hex":"#912048"},
  {"code":"778","name":"Antique Mauve Very Light","hex":"#DFB6BD"},
  {"code":"779","name":"Cocoa Dark","hex":"#634B44"},
  {"code":"780","name":"Topaz Ultra Very Dark","hex":"#955A00"},
  {"code":"781","name":"Topaz Very Dark","hex":"#A26700"},
  {"code":"782","name":"Topaz Dark","hex":"#AE7700"},
  {"code":"783","name":"Christmas Gold","hex":"#CC8F00"},
  {"code":"791","name":"Cornflower Blue Very Dark","hex":"#49486A"},
  {"code":"792","name":"Cornflower Blue Dark","hex":"#6F6C8E"},
  {"code":"793","name":"Cornflower Blue Medium","hex":"#938BA4"},
  {"code":"794","name":"Cornflower Blue Light","hex":"#9FB7CF"},
  {"code":"796","name":"Royal Blue Dark","hex":"#13395F"},
  {"code":"797","name":"Royal Blue","hex":"#194C7A"},
  {"code":"798","name":"Delft Blue Dark","hex":"#46698A"},
  {"code":"799","name":"Delft Blue Medium","hex":"#749BC1"},
  {"code":"800","name":"Delft Blue Pale","hex":"#C0DAEB"},
  {"code":"801","name":"Coffee Brown Dark","hex":"#65442A"},
  {"code":"803","name":"Baby Blue Ultra Very Dark","hex":"#35668C"},
  {"code":"806","name":"Peacock Blue Dark","hex":"#3C8A96"},
  {"code":"807","name":"Peacock Blue","hex":"#649BA3"},
  {"code":"809","name":"Delft Blue","hex":"#94BACB"},
  {"code":"813","name":"Blue Light","hex":"#A2C2D6"},
  {"code":"814","name":"Garnet Dark","hex":"#A1002C"},
  {"code":"815","name":"Garnet Medium","hex":"#B00032"},
  {"code":"816","name":"Garnet","hex":"#B33B4B"},
  {"code":"817","name":"Coral Red Very Dark","hex":"#BB3B4A"},
  {"code":"818","name":"Baby Pink","hex":"#FFDFE5"},
  {"code":"819","name":"Baby Pink Light","hex":"#FFEFEF"},
  {"code":"820","name":"Royal Blue Very Dark","hex":"#0D2952"},
  {"code":"822","name":"Beige Gray Light","hex":"#E7E2D3"},
  {"code":"823","name":"Navy Blue Dark","hex":"#000049"},
  {"code":"824","name":"Blue Very Dark","hex":"#3B6482"},
  {"code":"825","name":"Blue Dark","hex":"#537C9D"},
  {"code":"826","name":"Blue Medium","hex":"#739EBD"},
  {"code":"827","name":"Blue Very Light","hex":"#BDDDED"},
  {"code":"828","name":"Blue Ultra Very Light","hex":"#D3ECF1"},
  {"code":"829","name":"Golden Olive Very Dark","hex":"#7F6B00"},
  {"code":"830","name":"Golden Olive Dark","hex":"#8D7500"},
  {"code":"831","name":"Golden Olive Medium","hex":"#9C8200"},
  {"code":"832","name":"Golden Olive","hex":"#B48F12"},
  {"code":"833","name":"Golden Olive Light","hex":"#C6A46F"},
  {"code":"834","name":"Golden Olive Very Light","hex":"#D4B684"},
  {"code":"838","name":"Beige Brown Very Dark","hex":"#594937"},
  {"code":"839","name":"Beige Brown Dark","hex":"#695845"},
  {"code":"840","name":"Beige Brown Medium","hex":"#9A7C5C"},
  {"code":"841","name":"Beige Brown Light","hex":"#B69B7E"},
  {"code":"842","name":"Beige Brown Very Light","hex":"#D1BAA1"},
  {"code":"844","name":"Beaver Gray Ultra Dark","hex":"#484848"},
  {"code":"869","name":"Hazelnut Brown Very Dark","hex":"#83593C"},
  {"code":"890","name":"Pistachio Green Ultra Dark","hex":"#174F42"},
  {"code":"891","name":"Carnation Dark","hex":"#FF5A73"},
  {"code":"892","name":"Carnation Medium","hex":"#FF8495"},
  {"code":"893","name":"Carnation Light","hex":"#FFB7C1"},
  {"code":"894","name":"Carnation Very Light","hex":"#FFD6DC"},
  {"code":"895","name":"Hunter Green Very Dark","hex":"#20563B"},
  {"code":"898","name":"Coffee Brown Very Dark","hex":"#493219"},
  {"code":"899","name":"Rose Medium","hex":"#F3748E"},
  {"code":"900","name":"Burnt Orange Dark","hex":"#D15600"},
  {"code":"902","name":"Garnet Very Dark","hex":"#852032"},
  {"code":"904","name":"Parrot Green Very Dark","hex":"#637700"},
  {"code":"905","name":"Parrot Green Dark","hex":"#758E00"},
  {"code":"906","name":"Parrot Green Medium","hex":"#8EA800"},
  {"code":"907","name":"Parrot Green Light","hex":"#CDD96D"},
  {"code":"909","name":"Emerald Green Very Dark","hex":"#12563C"},
  {"code":"910","name":"Emerald Green Dark","hex":"#196848"},
  {"code":"911","name":"Emerald Green Medium","hex":"#1E7F55"},
  {"code":"912","name":"Emerald Green Light","hex":"#1A9560"},
  {"code":"913","name":"Nile Green Medium","hex":"#99BC95"},
  {"code":"915","name":"Plum Dark","hex":"#A31855"},
  {"code":"917","name":"Plum Medium","hex":"#AC1B5A"},
  {"code":"918","name":"Red Copper Dark","hex":"#834438"},
  {"code":"919","name":"Red Copper","hex":"#B15942"},
  {"code":"920","name":"Copper Medium","hex":"#C56D54"},
  {"code":"921","name":"Copper","hex":"#CB7A5B"},
  {"code":"922","name":"Copper Light","hex":"#E29268"},
  {"code":"924","name":"Gray Green Very Dark","hex":"#486359"},
  {"code":"926","name":"Gray Green Medium","hex":"#7C9A8C"},
  {"code":"927","name":"Gray Green Light","hex":"#AABDB3"},
  {"code":"928","name":"Gray Green Very Light","hex":"#CFDAD4"},
  {"code":"930","name":"Antique Blue Dark","hex":"#466375"},
  {"code":"931","name":"Antique Blue Medium","hex":"#688694"},
  {"code":"932","name":"Antique Blue Light","hex":"#99B3BF"},
  {"code":"934","name":"Avocado Green Black","hex":"#2A3322"},
  {"code":"935","name":"Avocado Green Dark","hex":"#445031"},
  {"code":"936","name":"Avocado Green Very Dark","hex":"#4E5E2F"},
  {"code":"937","name":"Avocado Green Medium","hex":"#617840"},
  {"code":"938","name":"Coffee Brown Ultra Dark","hex":"#361F00"},
  {"code":"939","name":"Navy Blue Very Dark","hex":"#002050"},
  {"code":"943","name":"Aquamarine Medium","hex":"#00AF9B"},
  {"code":"945","name":"Tawny","hex":"#FBDABB"},
  {"code":"946","name":"Burnt Orange Medium","hex":"#F26A24"},
  {"code":"947","name":"Burnt Orange","hex":"#FF7B4D"},
  {"code":"948","name":"Peach Very Light","hex":"#FFE7D9"},
  {"code":"950","name":"Desert Sand Light","hex":"#EED6D2"},
  {"code":"951","name":"Tawny Light","hex":"#FFE7CE"},
  {"code":"954","name":"Nile Green","hex":"#86B7A0"},
  {"code":"955","name":"Nile Green Light","hex":"#ACD0BC"},
  {"code":"956","name":"Geranium","hex":"#FF6D73"},
  {"code":"957","name":"Geranium Pale","hex":"#FDADAD"},
  {"code":"958","name":"Sea Green Dark","hex":"#009E89"},
  {"code":"959","name":"Sea Green Medium","hex":"#66B7A4"},
  {"code":"961","name":"Dusty Rose Dark","hex":"#C7637D"},
  {"code":"962","name":"Dusty Rose Medium","hex":"#E68FA3"},
  {"code":"963","name":"Dusty Rose Ultra Very Light","hex":"#FFCDD2"},
  {"code":"964","name":"Sea Green Light","hex":"#9DCEC3"},
  {"code":"966","name":"Baby Green Medium","hex":"#B2C297"},
  {"code":"970","name":"Pumpkin Light","hex":"#F78B13"},
  {"code":"971","name":"Pumpkin","hex":"#F78B13"},
  {"code":"972","name":"Canary Deep","hex":"#FFB515"},
  {"code":"973","name":"Canary Bright","hex":"#FFE300"},
  {"code":"975","name":"Golden Brown Dark","hex":"#8B5300"},
  {"code":"976","name":"Golden Brown Medium","hex":"#F68D39"},
  {"code":"977","name":"Golden Brown Light","hex":"#FFB066"},
  {"code":"986","name":"Forest Green Very Dark","hex":"#3D5C49"},
  {"code":"987","name":"Forest Green Dark","hex":"#597560"},
  {"code":"988","name":"Forest Green Medium","hex":"#839882"},
  {"code":"989","name":"Forest Green","hex":"#869E77"},
  {"code":"991","name":"Aquamarine Dark","hex":"#007C6D"},
  {"code":"992","name":"Aquamarine","hex":"#6DB0A1"},
  {"code":"993","name":"Aquamarine Light","hex":"#8EC2B4"},
  {"code":"995","name":"Electric Blue Dark","hex":"#007BA7"},
  {"code":"996","name":"Electric Blue Medium","hex":"#00A3DA"},
  {"code":"3011","name":"Khaki Green Dark","hex":"#77684E"},
  {"code":"3012","name":"Khaki Green Medium","hex":"#A69776"},
  {"code":"3013","name":"Khaki Green Light","hex":"#B9AE85"},
  {"code":"3021","name":"Brown Gray Very Dark","hex":"#4F443A"},
  {"code":"3022","name":"Brown Gray Medium","hex":"#8E8470"},
  {"code":"3023","name":"Brown Gray Light","hex":"#B5AE9A"},
  {"code":"3024","name":"Brown Gray Very Light","hex":"#D3D0CD"},
  {"code":"3031","name":"Mocha Brown Very Dark","hex":"#483C32"},
  {"code":"3032","name":"Mocha Brown Medium","hex":"#BC9C78"},
  {"code":"3033","name":"Mocha Brown Very Light","hex":"#EFDDBE"},
  {"code":"3041","name":"Antique Violet Medium","hex":"#B79BA7"},
  {"code":"3042","name":"Antique Violet Light","hex":"#E1CDC8"},
  {"code":"3045","name":"Yellow Beige Dark","hex":"#BA9167"},
  {"code":"3046","name":"Yellow Beige Medium","hex":"#E5C18B"},
  {"code":"3047","name":"Yellow Beige Light","hex":"#FFECD3"},
  {"code":"3051","name":"Green Gray Dark","hex":"#595F4B"},
  {"code":"3052","name":"Green Gray Medium","hex":"#889277"},
  {"code":"3053","name":"Green Gray","hex":"#9CA48F"},
  {"code":"3064","name":"Desert Sand","hex":"#BF917C"},
  {"code":"3072","name":"Beaver Gray Very Light","hex":"#E6E8E8"},
  {"code":"3078","name":"Golden Yellow Very Light","hex":"#FFFCE1"},
  {"code":"3325","name":"Baby Blue Light","hex":"#B3D1E4"},
  {"code":"3326","name":"Rose Light","hex":"#FF9D96"},
  {"code":"3328","name":"Salmon Dark","hex":"#BC4055"},
  {"code":"3340","name":"Apricot Medium","hex":"#FF7B67"},
  {"code":"3341","name":"Apricot","hex":"#FFACA2"},
  {"code":"3345","name":"Hunter Green Dark","hex":"#365647"},
  {"code":"3346","name":"Hunter Green","hex":"#53705A"},
  {"code":"3347","name":"Yellow Green Medium","hex":"#708E6B"},
  {"code":"3348","name":"Yellow Green Light","hex":"#E1F9BE"},
  {"code":"3350","name":"Dusty Rose Ultra Dark","hex":"#B84F64"},
  {"code":"3354","name":"Dusty Rose Light","hex":"#FFD6D1"},
  {"code":"3362","name":"Pine Green Dark","hex":"#61735C"},
  {"code":"3363","name":"Pine Green Medium","hex":"#73866B"},
  {"code":"3364","name":"Pine Green","hex":"#869977"},
  {"code":"3371","name":"Black Brown","hex":"#271C13"},
  {"code":"3607","name":"Plum Light","hex":"#E74F86"},
  {"code":"3608","name":"Plum Very Light","hex":"#F798B6"},
  {"code":"3609","name":"Plum Ultra Light","hex":"#FFC5D5"},
  {"code":"3685","name":"Mauve Very Dark","hex":"#7F335D"},
  {"code":"3687","name":"Mauve","hex":"#C15481"},
  {"code":"3688","name":"Mauve Medium","hex":"#E689AF"},
  {"code":"3689","name":"Mauve Light","hex":"#FFBACD"},
  {"code":"3705","name":"Melon Dark","hex":"#FF555B"},
  {"code":"3706","name":"Melon Medium","hex":"#FF8C8A"},
  {"code":"3708","name":"Melon Light","hex":"#FED4DB"},
  {"code":"3712","name":"Salmon Medium","hex":"#E26D76"},
  {"code":"3713","name":"Salmon Very Light","hex":"#FDE5D9"},
  {"code":"3716","name":"Dusty Rose Very Light","hex":"#FFBDC1"},
  {"code":"3721","name":"Shell Pink Dark","hex":"#A9555F"},
  {"code":"3722","name":"Shell Pink Medium","hex":"#AB6F73"},
  {"code":"3726","name":"Antique Mauve Dark","hex":"#91636B"},
  {"code":"3727","name":"Antique Mauve Light","hex":"#FFBDBF"},
  {"code":"3731","name":"Dusty Rose Very Dark","hex":"#DC677F"},
  {"code":"3733","name":"Dusty Rose","hex":"#FF9DAE"},
  {"code":"3740","name":"Antique Violet Dark","hex":"#9C7D85"},
  {"code":"3743","name":"Antique Violet Very Light","hex":"#EBEBE7"},
  {"code":"3746","name":"Blue Violet Dark","hex":"#776B98"},
  {"code":"3747","name":"Blue Violet Very Light","hex":"#E6ECE8"},
  {"code":"3750","name":"Antique Blue Very Dark","hex":"#355868"},
  {"code":"3752","name":"Antique Blue Very Light","hex":"#C7D8DC"},
  {"code":"3753","name":"Antique Blue Ultra Very Light","hex":"#ECF4F4"},
  {"code":"3755","name":"Baby Blue","hex":"#799EC0"},
  {"code":"3756","name":"Baby Blue Ultra Very Light","hex":"#F2FAFF"},
  {"code":"3760","name":"Wedgewood Medium","hex":"#638FA3"},
  {"code":"3761","name":"Sky Blue Light","hex":"#D3F2F3"},
  {"code":"3765","name":"Peacock Blue Very Dark","hex":"#007D87"},
  {"code":"3766","name":"Peacock Blue Light","hex":"#409AA4"},
  {"code":"3768","name":"Gray Green Dark","hex":"#5C6E6C"},
  {"code":"3770","name":"Tawny Very Light","hex":"#FFFAE0"},
  {"code":"3771","name":"Terra Cotta Ultra Very Light","hex":"#F7DACB"},
  {"code":"3772","name":"Desert Sand Very Dark","hex":"#A07465"},
  {"code":"3773","name":"Desert Sand Medium","hex":"#C49782"},
  {"code":"3774","name":"Desert Sand Very Light","hex":"#F3E1D7"},
  {"code":"3776","name":"Mahogany Light","hex":"#DD9059"},
  {"code":"3777","name":"Terra Cotta Very Dark","hex":"#863022"},
  {"code":"3778","name":"Terra Cotta Light","hex":"#D98C73"},
  {"code":"3779","name":"Terra Cotta Ultra Very Light","hex":"#F8CBBB"},
  {"code":"3781","name":"Mocha Brown Dark","hex":"#6B5749"},
  {"code":"3782","name":"Mocha Brown Light","hex":"#CFAB8F"},
  {"code":"3787","name":"Brown Gray Dark","hex":"#6F675E"},
  {"code":"3790","name":"Beige Gray Ultra Dark","hex":"#8C756D"},
  {"code":"3799","name":"Pewter Gray Very Dark","hex":"#424242"},
  {"code":"3801","name":"Christmas Red Very Dark","hex":"#E50033"},
  {"code":"3802","name":"Antique Mauve Very Dark","hex":"#714149"},
  {"code":"3803","name":"Mauve Dark","hex":"#A93C6F"},
  {"code":"3804","name":"Cyclamen Pink Dark","hex":"#E02876"},
  {"code":"3805","name":"Cyclamen Pink","hex":"#F3478B"},
  {"code":"3806","name":"Cyclamen Pink Light","hex":"#FF8CAE"},
  {"code":"3807","name":"Cornflower Blue","hex":"#667798"},
  {"code":"3808","name":"Turquoise Ultra Very Dark","hex":"#366970"},
  {"code":"3809","name":"Turquoise Very Dark","hex":"#3F7C85"},
  {"code":"3810","name":"Turquoise Dark","hex":"#488E9A"},
  {"code":"3811","name":"Turquoise Very Light","hex":"#BCE3E6"},
  {"code":"3812","name":"Sea Green Very Dark","hex":"#2F8C84"},
  {"code":"3813","name":"Blue Green Light","hex":"#B2D4BD"},
  {"code":"3814","name":"Aquamarine","hex":"#508B7D"},
  {"code":"3815","name":"Celadon Green Dark","hex":"#477759"},
  {"code":"3816","name":"Celadon Green","hex":"#65A57D"},
  {"code":"3817","name":"Celadon Green Light","hex":"#99C3AA"},
  {"code":"3818","name":"Emerald Green Ultra Very Dark","hex":"#115A3B"},
  {"code":"3819","name":"Moss Green Light","hex":"#E0E868"},
  {"code":"3820","name":"Straw Dark","hex":"#DFB65F"},
  {"code":"3821","name":"Straw","hex":"#F3CE75"},
  {"code":"3822","name":"Straw Light","hex":"#F6DC98"},
  {"code":"3823","name":"Yellow Ultra Pale","hex":"#FFFDE3"},
  {"code":"3824","name":"Apricot Light","hex":"#FECDC2"},
  {"code":"3825","name":"Pumpkin Pale","hex":"#FDBD96"},
  {"code":"3826","name":"Golden Brown","hex":"#AD7239"},
  {"code":"3827","name":"Golden Brown Pale","hex":"#F7BB77"},
  {"code":"3828","name":"Hazelnut Brown","hex":"#B78B61"},
  {"code":"3829","name":"Old Gold Very Dark","hex":"#A98204"},
  {"code":"3830","name":"Terra Cotta","hex":"#B9644F"},
  {"code":"3831","name":"Raspberry Dark","hex":"#B32F48"},
  {"code":"3832","name":"Raspberry Medium","hex":"#DB556E"},
  {"code":"3833","name":"Raspberry Light","hex":"#EA8699"},
  {"code":"3834","name":"Grape Dark","hex":"#72375D"},
  {"code":"3835","name":"Grape Medium","hex":"#946083"},
  {"code":"3836","name":"Grape Light","hex":"#BA91AA"},
  {"code":"3837","name":"Lavender Ultra Dark","hex":"#6C3A6E"},
  {"code":"3838","name":"Lavender Blue Dark","hex":"#5C7294"},
  {"code":"3839","name":"Lavender Blue Medium","hex":"#7B8EAB"},
  {"code":"3840","name":"Lavender Blue Light","hex":"#B0C0DA"},
  {"code":"3841","name":"Baby Blue Pale","hex":"#CDDFED"},
  {"code":"3842","name":"Wedgewood Very Dark","hex":"#32667C"},
  {"code":"3843","name":"Electric Blue","hex":"#14AAD0"},
  {"code":"3844","name":"Bright Turquoise Dark","hex":"#12AEBA"},
  {"code":"3845","name":"Bright Turquoise Medium","hex":"#04C4CA"},
  {"code":"3846","name":"Bright Turquoise Light","hex":"#06E3E6"},
  {"code":"3847","name":"Teal Green Dark","hex":"#347D75"},
  {"code":"3848","name":"Teal Green Medium","hex":"#559392"},
  {"code":"3849","name":"Teal Green Light","hex":"#52B3A4"},
  {"code":"3850","name":"Bright Green Dark","hex":"#378477"},
  {"code":"3851","name":"Bright Green Light","hex":"#49B3A1"},
  {"code":"3852","name":"Straw Very Dark","hex":"#CD9D37"},
  {"code":"3853","name":"Autumn Gold Dark","hex":"#F29746"},
  {"code":"3854","name":"Autumn Gold Medium","hex":"#F2AF6D"},
  {"code":"3855","name":"Autumn Gold Light","hex":"#FAD396"},
  {"code":"3856","name":"Mahogany Ultra Very Light","hex":"#FFD3B5"},
  {"code":"3857","name":"Rosewood Dark","hex":"#682424"},
  {"code":"3858","name":"Rosewood Medium","hex":"#964A3F"},
  {"code":"3859","name":"Rosewood Light","hex":"#BA9189"},
  {"code":"3860","name":"Cocoa","hex":"#7D5D57"},
  {"code":"3861","name":"Cocoa Light","hex":"#A68881"},
  {"code":"3862","name":"Mocha Beige Dark","hex":"#8A6E4E"},
  {"code":"3863","name":"Mocha Beige Medium","hex":"#A4835C"},
  {"code":"3864","name":"Mocha Beige Light","hex":"#CBB69C"},
  {"code":"3865","name":"Winter White","hex":"#F9F7F1"},
  {"code":"3866","name":"Mocha Brown Ultra Very Light","hex":"#FAF6F0"}
];

// Top 20 popular DMC colors (quick-access in sidebar)
const POPULAR_DMC_CODES = [
  "310", "321", "blanc", "498", "666", "336", "796", "699", "702", "553",
  "550", "720", "741", "307", "444", "3846", "3801", "3607", "738", "414"
];

// Add RGB values to DMC colors (PDF engine needs r,g,b)
DMC_COLORS.forEach(function(c) {
  if (c.hex && !c.r) {
    c.r = parseInt(c.hex.slice(1, 3), 16);
    c.g = parseInt(c.hex.slice(3, 5), 16);
    c.b = parseInt(c.hex.slice(5, 7), 16);
  }
});
</script>

<!-- â•â•â• Shared Bitmap Utilities â•â•â• -->
<script>
// shared.js â€” Unified bitmap utilities used by both UI and PDF engine
// Loaded before pdf-modules and ui-modules by assemble.js

/**
 * Trim trailing empty rows from a glyph bitmap.
 * Returns only the rows up to and including the last row containing a '1'.
 *
 * @param {object} glyph - Glyph object with .bitmap (array of strings)
 * @returns {string[]} Trimmed bitmap rows
 */
function getEffectiveBitmap(glyph) {
  if (!glyph || !glyph.bitmap || !glyph.bitmap.length) return [];
  var bitmap = glyph.bitmap;
  var lastFilledRow = -1;
  for (var r = bitmap.length - 1; r >= 0; r--) {
    if (bitmap[r].indexOf('1') !== -1) { lastFilledRow = r; break; }
  }
  if (lastFilledRow === -1) return [];
  return bitmap.slice(0, lastFilledRow + 1);
}

/**
 * Render a single line of text to a 2D bitmap.
 * This is the core single-line logic extracted from getTextBitmap.
 *
 * @param {string} lineText - Single line of text (no newlines)
 * @param {object} fontData - Font object with glyphs, height, letterSpacing, spaceWidth
 * @param {object} [options] - Rendering options (align, format)
 * @returns {{ bitmap: Array[], width: number, height: number }}
 */
function getLineBitmap(lineText, fontData, options) {
  options = options || {};
  var align = options.align || 'bottom';
  var format = options.format || 'boolean';

  if (!lineText || !fontData || !fontData.glyphs) return { bitmap: [], width: 0, height: 0 };

  var glyphs = fontData.glyphs;
  var height = fontData.height || 9;
  var letterSpacing = (fontData.letterSpacing != null) ? fontData.letterSpacing : 1;
  var spaceWidth = fontData.spaceWidth || 3;
  var columns = [];

  var falseVal = (format === 'string') ? '0' : false;
  var trueVal = (format === 'string') ? '1' : true;

  for (var ci = 0; ci < lineText.length; ci++) {
    var ch = lineText[ci];

    // Letter spacing between characters (not before the first)
    if (ci > 0 && letterSpacing > 0) {
      for (var s = 0; s < letterSpacing; s++) columns.push(newEmptyCol(height, falseVal));
    }

    // Space or missing/empty glyph: insert empty columns
    if (ch === ' ' || !glyphs[ch] || !glyphs[ch].bitmap || !glyphs[ch].bitmap.length) {
      for (var sw = 0; sw < spaceWidth; sw++) columns.push(newEmptyCol(height, falseVal));
      continue;
    }

    var glyph = glyphs[ch];
    var bmp = glyph.bitmap;
    var glyphWidth = glyph.width || (bmp[0] ? bmp[0].length : 0);
    var glyphHeight = bmp.length;

    // 'top' alignment: push glyph down so empty space is at the top of the cell
    // 'bottom' (default): glyph starts at row 0, empty space at bottom
    var yOffset = (align === 'top') ? (height - glyphHeight) : 0;

    for (var x = 0; x < glyphWidth; x++) {
      var col = newEmptyCol(height, falseVal);
      for (var row = 0; row < glyphHeight; row++) {
        if (row < bmp.length && x < bmp[row].length && bmp[row][x] === '1') {
          col[yOffset + row] = trueVal;
        }
      }
      columns.push(col);
    }
  }

  if (!columns.length) return { bitmap: [], width: 0, height: 0 };

  // Transpose columns to rows
  var width = columns.length;
  var bitmap = [];
  for (var y = 0; y < height; y++) {
    var row = [];
    for (var x2 = 0; x2 < width; x2++) row.push(columns[x2][y]);
    bitmap.push(row);
  }
  return { bitmap: bitmap, width: width, height: height };
}

/**
 * Convert a text string to a 2D bitmap using bitmap font glyph data.
 * Supports multi-line text (split by \n) with horizontal alignment.
 * Supports both UI (top-aligned, boolean) and PDF (bottom-aligned, boolean) use cases.
 *
 * @param {string} text - The text to render (may contain \n for multi-line)
 * @param {object} fontData - Font object with glyphs, height, letterSpacing, spaceWidth
 * @param {object} [options] - Rendering options
 * @param {string} [options.align='bottom'] - Vertical glyph alignment:
 *   'bottom' (default): glyph rows start at top of cell, empty space at bottom
 *   'top': glyph rows pushed to bottom of cell, empty space at top
 * @param {string} [options.format='boolean'] - Cell value format:
 *   'boolean' (default): cells are true/false
 *   'string': cells are '1'/'0'
 * @param {string} [options.textAlign='left'] - Horizontal text alignment:
 *   'left' (default), 'center', 'right'
 * @returns {{ bitmap: Array[], width: number, height: number }}
 */
function getTextBitmap(text, fontData, options) {
  options = options || {};
  var textAlign = options.textAlign || 'left';
  var format = options.format || 'boolean';

  if (!text || !fontData || !fontData.glyphs) return { bitmap: [], width: 0, height: 0 };

  var height = fontData.height || 9;
  var falseVal = (format === 'string') ? '0' : false;

  var lines = text.split('\n');
  var lineBitmaps = [];
  var maxWidth = 0;

  for (var i = 0; i < lines.length; i++) {
    if (!lines[i].trim()) {
      // Empty line: push empty bitmap with just the font height
      lineBitmaps.push({ bitmap: [], width: 0, height: height });
      continue;
    }
    var lb = getLineBitmap(lines[i], fontData, options);
    lineBitmaps.push(lb);
    if (lb.width > maxWidth) maxWidth = lb.width;
  }

  if (maxWidth === 0) return { bitmap: [], width: 0, height: 0 };

  var lineGap = Math.max(2, Math.round(height * 0.15));
  var totalHeight = 0;
  var finalBitmap = [];

  for (var i = 0; i < lineBitmaps.length; i++) {
    var lb = lineBitmaps[i];
    var padLeft = 0;

    if (textAlign === 'center') {
      padLeft = Math.floor((maxWidth - lb.width) / 2);
    } else if (textAlign === 'right') {
      padLeft = maxWidth - lb.width;
    }
    var padRight = maxWidth - lb.width - padLeft;

    // If line has actual bitmap rows, pad them
    if (lb.bitmap.length > 0) {
      for (var y = 0; y < lb.bitmap.length; y++) {
        var row = [];
        for (var p = 0; p < padLeft; p++) row.push(falseVal);
        for (var x = 0; x < lb.bitmap[y].length; x++) row.push(lb.bitmap[y][x]);
        for (var p2 = 0; p2 < padRight; p2++) row.push(falseVal);
        finalBitmap.push(row);
      }
      totalHeight += lb.bitmap.length;
    } else {
      // Empty line: add empty rows for the font height
      for (var y = 0; y < height; y++) {
        var emptyRow = [];
        for (var x = 0; x < maxWidth; x++) emptyRow.push(falseVal);
        finalBitmap.push(emptyRow);
      }
      totalHeight += height;
    }

    // Line gap (not after last line)
    if (i < lineBitmaps.length - 1) {
      for (var g = 0; g < lineGap; g++) {
        var gapRow = [];
        for (var x = 0; x < maxWidth; x++) gapRow.push(falseVal);
        finalBitmap.push(gapRow);
      }
      totalHeight += lineGap;
    }
  }

  return { bitmap: finalBitmap, width: maxWidth, height: totalHeight };
}

function newEmptyCol(height, fillValue) {
  var col = new Array(height);
  for (var i = 0; i < height; i++) col[i] = fillValue;
  return col;
}

</script>

<!-- â•â•â• PDF Generation Engine â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Word2Stitch â€” PDF Helpers
//  Utility functions shared across PDF modules
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Get translated string for PDF. Falls back to English default if t() unavailable.
 */
function pt(key, fallback) {
  if (typeof window.t === 'function') {
    var val = window.t(key);
    if (val && val !== key) return val;
  }
  return fallback;
}

function getLuminance(color) {
  return (0.299 * color.r + 0.587 * color.g + 0.114 * color.b) / 255;
}

/**
 * Truncate a string to maxLen characters, adding ellipsis if needed.
 */
function truncate(str, maxLen) {
  if (!str) return '';
  if (str.length <= maxLen) return str;
  return str.substring(0, maxLen - 1) + '\u2026';
}


// pdf-modules/pdf-bitmap.js â€” Thin wrapper over shared getTextBitmap()

function getTextBitmapForPDF(text, fontData) {
  return getTextBitmap(text, fontData, { align: 'top' }).bitmap;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Word2Stitch â€” PDF Legend
//  Legend/materials page: thread table, pattern info, size boxes.
//  Depends on pdf-helpers (pt, getLuminance).
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Draw the thread table section of the legend page.
 *
 * @param {jsPDF} pdf - jsPDF instance
 * @param {object} opts - Legend options
 * @param {number} y - Current Y position
 * @returns {number} Updated Y position after drawing
 */
function drawThreadTable(pdf, opts, y) {
  var color = opts.color;
  var stitchCount = opts.stitchCount;
  var aidaCount = opts.aidaCount;
  var margin = opts.margin;
  var pageW = opts.pageW;

  // Thread calculation: ~0.013m per full cross stitch at Aida 14
  // (4 diagonal passes x stitch_size x sqrt(2) + 20% waste), scaled by fabric count
  const metersPerStitch = 0.013 * (14 / aidaCount);
  const meters = stitchCount * metersPerStitch;
  const skeins = Math.ceil(meters / 8);
  const preferImperial = (typeof window.getDisplayUnit === 'function' && window.getDisplayUnit() === 'imperial');

  // Table width adapts to page
  const contentW = pageW - margin * 2;
  const tW = Math.min(contentW, 220);
  const colPcts = [0, 0.10, 0.19, 0.31, 0.52, 0.68, 0.84];
  const colX = colPcts.map(function(p) { return margin + p * tW; });
  const colLabels = [pt('pdf_col_symbol','Symbol'), pt('pdf_col_swatch','Swatch'), pt('pdf_col_dmc_code','DMC Code'), pt('pdf_col_color_name','Color Name'), pt('pdf_col_stitches','Stitches'), pt('pdf_col_thread','Thread'), pt('pdf_col_skeins','Skeins')];

  // Table header
  pdf.setFillColor(245, 240, 235);
  pdf.rect(margin, y - 3, tW, 8, 'F');
  pdf.setFontSize(8);
  pdf.setTextColor(80, 80, 80);
  pdf.setFont('helvetica', 'bold');
  for (let i = 0; i < colLabels.length; i++) {
    pdf.text(colLabels[i], colX[i] + 1, y + 2);
  }
  y += 10;

  // Header line
  pdf.setDrawColor(200, 190, 175);
  pdf.setLineWidth(0.3);
  pdf.line(margin, y - 2, margin + tW, y - 2);

  // Data row
  const luminance = getLuminance(color);

  // Symbol cell
  pdf.setFillColor(color.r, color.g, color.b);
  pdf.rect(colX[0] + 1, y - 2, 10, 7, 'F');
  pdf.setTextColor(luminance < 0.5 ? 255 : 0, luminance < 0.5 ? 255 : 0, luminance < 0.5 ? 255 : 0);
  pdf.setFontSize(11);
  pdf.setFont('helvetica', 'bold');
  pdf.text('\u00D7', colX[0] + 6, y + 3, { align: 'center' });

  // Color swatch
  pdf.setFillColor(color.r, color.g, color.b);
  pdf.rect(colX[1] + 1, y - 2, 14, 7, 'F');
  pdf.setDrawColor(180, 170, 160);
  pdf.setLineWidth(0.15);
  pdf.rect(colX[1] + 1, y - 2, 14, 7, 'S');

  // Text values
  pdf.setTextColor(60, 60, 60);
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(9);
  pdf.text('DMC ' + color.code, colX[2] + 1, y + 2.5);
  pdf.text(color.name || '', colX[3] + 1, y + 2.5);
  pdf.text(String(stitchCount), colX[4] + 1, y + 2.5);
  var threadText = preferImperial ? (meters * 1.09361).toFixed(2) + ' yd' : meters.toFixed(2) + ' m';
  pdf.text(threadText, colX[5] + 1, y + 2.5);
  pdf.text(String(skeins), colX[6] + 1, y + 2.5);
  y += 12;

  // Bottom line
  pdf.setDrawColor(200, 190, 175);
  pdf.setLineWidth(0.2);
  pdf.line(margin, y - 3, margin + tW, y - 3);
  y += 8;

  return { y: y, meters: meters, skeins: skeins, preferImperial: preferImperial };
}

/**
 * Draw the pattern information section of the legend page.
 *
 * @param {jsPDF} pdf - jsPDF instance
 * @param {object} opts - Legend options
 * @param {number} y - Current Y position
 * @param {object} threadInfo - { meters, skeins, preferImperial } from drawThreadTable
 * @returns {number} Updated Y position after drawing
 */
function drawPatternInfo(pdf, opts, y, threadInfo) {
  var stitchCount = opts.stitchCount;
  var aidaCount = opts.aidaCount;
  var width = opts.width;
  var height = opts.height;
  var margin = opts.margin;
  var meters = threadInfo.meters;
  var skeins = threadInfo.skeins;
  var preferImperial = threadInfo.preferImperial;

  pdf.setFontSize(13);
  pdf.setTextColor(184, 58, 42);
  pdf.setFont('helvetica', 'bold');
  pdf.text(pt('pdf_pattern_info', 'Pattern Information'), margin, y);
  y += 9;

  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(9);
  pdf.setTextColor(70, 70, 70);

  const stitchMm = (25.4 / aidaCount).toFixed(2);
  const inchesW = (width / aidaCount).toFixed(2);
  const inchesH = (height / aidaCount).toFixed(2);
  const cmW = (width / aidaCount * 2.54).toFixed(1);
  const cmH = (height / aidaCount * 2.54).toFixed(1);

  var yards = (meters * 1.09361).toFixed(2);
  var finishedSizeNote = preferImperial
    ? pt('pdf_info_finished_size', 'Finished size') + ': ' + inchesW + ' \u00D7 ' + inchesH + '" (' + cmW + ' \u00D7 ' + cmH + ' cm)'
    : pt('pdf_info_finished_size', 'Finished size') + ': ' + cmW + ' \u00D7 ' + cmH + ' cm (' + inchesW + ' \u00D7 ' + inchesH + '")';
  var threadNote = preferImperial
    ? pt('pdf_info_thread_required', 'Thread required') + ': ' + yards + ' yd (' + skeins + ' ' + (skeins !== 1 ? pt('pdf_unit_skeins', 'skeins') : pt('pdf_unit_skein', 'skein')) + ')'
    : pt('pdf_info_thread_required', 'Thread required') + ': ' + meters.toFixed(2) + ' m (' + skeins + ' ' + (skeins !== 1 ? pt('pdf_unit_skeins', 'skeins') : pt('pdf_unit_skein', 'skein')) + ')';

  const notes = [
    pt('pdf_note_strands', 'Use 2 strands of DMC thread for cross stitches'),
    pt('pdf_note_center', 'Start from the center of the fabric for best results'),
    pt('pdf_info_fabric_aida', 'Fabric: Aida') + ' ' + aidaCount.toFixed(1) + ' ct \u2014 ' + pt('pdf_info_each_stitch', 'Each stitch') + ' = ' + stitchMm + ' mm',
    pt('pdf_info_pattern_size', 'Pattern size') + ': ' + width + ' \u00D7 ' + height + ' ' + pt('pdf_unit_stitches', 'stitches'),
    finishedSizeNote,
    pt('pdf_info_total_crosses', 'Total crosses') + ': ' + stitchCount,
    threadNote,
    pt('pdf_note_print', '\u26a0 Print at 100% scale (no fit-to-page) for 1:1 stitch size'),
  ];

  for (const note of notes) {
    pdf.text('\u2022  ' + note, margin + 2, y);
    y += 5.8;
  }
  y += 6;

  return { y: y, inchesW: inchesW, inchesH: inchesH, cmW: cmW, cmH: cmH };
}

/**
 * Draw the finished size and cut fabric boxes on the legend page.
 *
 * @param {jsPDF} pdf - jsPDF instance
 * @param {object} opts - Legend options
 * @param {number} y - Current Y position
 * @param {object} sizeInfo - { inchesW, inchesH, cmW, cmH } from drawPatternInfo
 * @param {boolean} preferImperial - Whether to show imperial units first
 */
function drawSizeBoxes(pdf, opts, y, sizeInfo, preferImperial) {
  var margin = opts.margin;
  var pageW = opts.pageW;
  var contentW = pageW - margin * 2;
  var tW = Math.min(contentW, 220);

  var inchesW = sizeInfo.inchesW;
  var inchesH = sizeInfo.inchesH;
  var cmW = sizeInfo.cmW;
  var cmH = sizeInfo.cmH;

  pdf.setDrawColor(184, 58, 42);
  pdf.setLineWidth(0.4);
  pdf.setFillColor(253, 248, 244);
  const boxW = Math.min(tW / 2 - 4, 90);

  // Finished Size box
  pdf.rect(margin, y, boxW, 22, 'FD');
  pdf.setFontSize(9);
  pdf.setFont('helvetica', 'bold');
  pdf.setTextColor(184, 58, 42);
  pdf.text(pt('pdf_finished_size', 'Finished Size'), margin + 4, y + 6);
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(11);
  pdf.setTextColor(60, 60, 60);
  if (preferImperial) {
    pdf.text(inchesW + ' \u00D7 ' + inchesH + '"', margin + 4, y + 13);
    pdf.setFontSize(8);
    pdf.setTextColor(140, 130, 120);
    pdf.text('(' + cmW + ' \u00D7 ' + cmH + ' cm)', margin + 4, y + 18);
  } else {
    pdf.text(cmW + ' \u00D7 ' + cmH + ' cm', margin + 4, y + 13);
    pdf.setFontSize(8);
    pdf.setTextColor(140, 130, 120);
    pdf.text('(' + inchesW + ' \u00D7 ' + inchesH + '")', margin + 4, y + 18);
  }

  // Cut Fabric box (add 3" margin each side)
  const cutX = margin + boxW + 8;
  pdf.setDrawColor(184, 58, 42);
  pdf.setFillColor(253, 248, 244);
  pdf.rect(cutX, y, boxW, 22, 'FD');
  const cutInW = (parseFloat(inchesW) + 6).toFixed(1);
  const cutInH = (parseFloat(inchesH) + 6).toFixed(1);
  const cutCmW = (cutInW * 2.54).toFixed(1);
  const cutCmH = (cutInH * 2.54).toFixed(1);
  pdf.setFontSize(9);
  pdf.setFont('helvetica', 'bold');
  pdf.setTextColor(184, 58, 42);
  pdf.text(pt('pdf_cut_fabric', 'Cut Fabric'), cutX + 4, y + 6);
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(11);
  pdf.setTextColor(60, 60, 60);
  if (preferImperial) {
    pdf.text(cutInW + ' \u00D7 ' + cutInH + '"', cutX + 4, y + 13);
    pdf.setFontSize(8);
    pdf.setTextColor(140, 130, 120);
    pdf.text(pt('pdf_cut_margin_imperial', '(+3" margin each side)'), cutX + 4, y + 18);
  } else {
    pdf.text(cutCmW + ' \u00D7 ' + cutCmH + ' cm', cutX + 4, y + 13);
    pdf.setFontSize(8);
    pdf.setTextColor(140, 130, 120);
    pdf.text(pt('pdf_cut_margin_metric', '(+7.6 cm margin each side)'), cutX + 4, y + 18);
  }
}

/**
 * Draw the legend/materials page.
 *
 * @param {jsPDF} pdf - jsPDF instance
 * @param {object} opts - Legend options
 * @param {object} opts.color - { code, name, hex, r, g, b }
 * @param {number} opts.stitchCount - Total filled stitches
 * @param {number} opts.aidaCount - Fabric count (11, 14, 16, 18)
 * @param {number} opts.width - Pattern width in stitches
 * @param {number} opts.height - Pattern height in stitches
 * @param {string} opts.fontName - Name of the font used
 * @param {string} opts.text - Pattern text
 * @param {number} opts.pageNum - Current page number
 * @param {number} opts.totalPages - Total page count
 * @param {number} opts.pageW - Page width in mm
 * @param {number} opts.pageH - Page height in mm
 */
function drawLegend(pdf, opts) {
  var color = opts.color;
  var stitchCount = opts.stitchCount;
  var aidaCount = opts.aidaCount;
  var width = opts.width;
  var height = opts.height;
  var fontName = opts.fontName;
  var text = opts.text;
  var pageNum = opts.pageNum;
  var totalPages = opts.totalPages;
  var pageW = opts.pageW || 210;
  var pageH = opts.pageH || 297;
  const margin = 15;

  // Branded header + footer
  drawBrandedHeader(pdf, text || '', fontName, width, height, pageNum, totalPages, margin, pageW);
  drawBrandedFooter(pdf, margin, pageW, pageH);

  let y = margin + 18; // after branded header bar

  // Title
  pdf.setFontSize(16);
  pdf.setTextColor(184, 58, 42); // accent color
  pdf.setFont('helvetica', 'bold');
  pdf.text(pt('pdf_thread_legend', 'Thread Legend'), margin, y);
  y += 10;

  var legendOpts = { color: color, stitchCount: stitchCount, aidaCount: aidaCount, width: width, height: height, margin: margin, pageW: pageW };

  // Thread table
  var threadResult = drawThreadTable(pdf, legendOpts, y);
  y = threadResult.y;

  // Pattern information
  var patternResult = drawPatternInfo(pdf, legendOpts, y, threadResult);
  y = patternResult.y;

  // Size boxes
  drawSizeBoxes(pdf, legendOpts, y, patternResult, threadResult.preferImperial);
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Word2Stitch â€” PDF Renderer
//  Layout calculation, grid drawing, legend, headers/footers, and
//  PDF document assembly. Depends on pdf-helpers and pdf-bitmap.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Calculate multi-page layout for the pattern grid.
 *
 * @param {number} width - Total bitmap width in cells
 * @param {number} height - Total bitmap height in cells
 * @param {number} cellSize - Cell size in mm
 * @param {number} pageW - Usable page width in mm
 * @param {number} pageH - Usable page height in mm
 * @returns {object} Layout info: colsPerPage, rowsPerPage, pagesX, pagesY, totalPages
 */
function calculatePDFLayout(width, height, cellSize, pageW, pageH) {
  // Reserve space for coordinate labels on left (~5mm, vertical text) and top (~6mm)
  const labelMarginLeft = 5;
  const labelMarginTop = 6;

  const availableW = pageW - labelMarginLeft;
  const availableH = pageH - labelMarginTop;

  const colsPerPage = Math.max(1, Math.floor(availableW / cellSize));
  const rowsPerPage = Math.max(1, Math.floor(availableH / cellSize));

  const pagesX = Math.max(1, Math.ceil(width / colsPerPage));
  const pagesY = Math.max(1, Math.ceil(height / rowsPerPage));

  return {
    colsPerPage,
    rowsPerPage,
    pagesX,
    pagesY,
    totalPages: pagesX * pagesY,
    labelMarginLeft,
    labelMarginTop,
  };
}

/**
 * Draw one page section of the pattern grid.
 *
 * @param {jsPDF} pdf - jsPDF instance
 * @param {object} opts - Grid page options
 * @param {boolean[][]} opts.bitmap - Full 2D bitmap
 * @param {object} opts.color - { r, g, b } thread color
 * @param {number} opts.startCol - First column index for this page
 * @param {number} opts.startRow - First row index for this page
 * @param {number} opts.colsPerPage - Max columns that fit on one page
 * @param {number} opts.rowsPerPage - Max rows that fit on one page
 * @param {number} opts.cellSize - Cell size in mm
 * @param {object} opts.margins - { left, top } in mm
 * @param {object} opts.layout - Layout info from calculatePDFLayout
 */
function drawGridPage(pdf, opts) {
  var bitmap = opts.bitmap;
  var color = opts.color;
  var startCol = opts.startCol;
  var startRow = opts.startRow;
  var colsPerPage = opts.colsPerPage;
  var rowsPerPage = opts.rowsPerPage;
  var cellSize = opts.cellSize;
  var margins = opts.margins;
  var layout = opts.layout;

  const totalWidth = bitmap[0] ? bitmap[0].length : 0;
  const totalHeight = bitmap.length;

  // How many cells to actually draw on this page
  const endCol = Math.min(startCol + colsPerPage, totalWidth);
  const endRow = Math.min(startRow + rowsPerPage, totalHeight);
  const drawCols = endCol - startCol;
  const drawRows = endRow - startRow;

  const offsetX = margins.left + layout.labelMarginLeft;
  const offsetY = margins.top + layout.labelMarginTop;

  // Determine symbol color based on luminance
  const luminance = getLuminance(color);
  const symbolIsWhite = luminance < 0.5;

  // 1. Draw filled cells
  for (let row = startRow; row < endRow; row++) {
    for (let col = startCol; col < endCol; col++) {
      if (bitmap[row] && bitmap[row][col]) {
        const x = offsetX + (col - startCol) * cellSize;
        const y = offsetY + (row - startRow) * cellSize;

        // Fill cell with thread color
        pdf.setFillColor(color.r, color.g, color.b);
        pdf.rect(x, y, cellSize, cellSize, 'F');

        // Draw cross symbol centered in cell (only if cell is large enough to be readable)
        if (cellSize >= 1.5) {
          if (symbolIsWhite) {
            pdf.setTextColor(255, 255, 255);
          } else {
            pdf.setTextColor(0, 0, 0);
          }
          pdf.setFontSize(Math.max(4, cellSize * 2.2));
          pdf.text(
            '\u00D7',
            x + cellSize / 2,
            y + cellSize / 2 + cellSize * 0.12,
            { align: 'center' }
          );
        }
      }
    }
  }

  // 2. Draw grid lines

  // Thin grid lines (every cell)
  pdf.setDrawColor(204, 204, 204); // #ccc
  pdf.setLineWidth(0.1);

  for (let col = 0; col <= drawCols; col++) {
    const x = offsetX + col * cellSize;
    pdf.line(x, offsetY, x, offsetY + drawRows * cellSize);
  }
  for (let row = 0; row <= drawRows; row++) {
    const y = offsetY + row * cellSize;
    pdf.line(offsetX, y, offsetX + drawCols * cellSize, y);
  }

  // Bold grid lines (every 10 cells)
  pdf.setDrawColor(51, 51, 51); // #333
  pdf.setLineWidth(0.3);

  for (let col = 0; col <= drawCols; col++) {
    const absCol = startCol + col;
    if (absCol % 10 === 0) {
      const x = offsetX + col * cellSize;
      pdf.line(x, offsetY, x, offsetY + drawRows * cellSize);
    }
  }
  for (let row = 0; row <= drawRows; row++) {
    const absRow = startRow + row;
    if (absRow % 10 === 0) {
      const y = offsetY + row * cellSize;
      pdf.line(offsetX, y, offsetX + drawCols * cellSize, y);
    }
  }

  // Bold border around the grid area
  pdf.setDrawColor(51, 51, 51);
  pdf.setLineWidth(0.3);
  pdf.rect(offsetX, offsetY, drawCols * cellSize, drawRows * cellSize, 'S');

  // 3. Coordinate labels every 10 cells

  pdf.setFontSize(5);
  pdf.setTextColor(120, 120, 120);

  // Top edge labels
  for (let col = 0; col <= drawCols; col++) {
    const absCol = startCol + col;
    if (absCol % 10 === 0 && absCol > 0) {
      const x = offsetX + col * cellSize;
      pdf.text(String(absCol), x, offsetY - 1, { align: 'center' });
    }
  }

  // Left edge labels (rotated 90 for compact width)
  for (let row = 0; row <= drawRows; row++) {
    const absRow = startRow + row;
    if (absRow % 10 === 0 && absRow > 0) {
      const y = offsetY + row * cellSize;
      pdf.text(String(absRow), offsetX - 1.5, y, { align: 'center', angle: 90 });
    }
  }

  // 4. Verification scale bar (1:1 print check)
  // Draw a 10mm bar at bottom-right so users can verify print scale with a ruler
  const gridBottom = offsetY + drawRows * cellSize;
  const gridRight = offsetX + drawCols * cellSize;
  const barLen = 10; // exactly 10mm
  const barY = gridBottom + 5;
  const barX = gridRight - barLen;

  // Bar line
  pdf.setDrawColor(184, 58, 42);
  pdf.setLineWidth(0.4);
  pdf.line(barX, barY, barX + barLen, barY);
  // End ticks
  pdf.line(barX, barY - 1.5, barX, barY + 1.5);
  pdf.line(barX + barLen, barY - 1.5, barX + barLen, barY + 1.5);
  // Label
  pdf.setFontSize(5.5);
  pdf.setFont('helvetica', 'bold');
  pdf.setTextColor(184, 58, 42);
  pdf.text('\u2190 10 mm \u2192', barX + barLen / 2, barY - 2.5, { align: 'center' });
  pdf.setFontSize(4.5);
  pdf.setFont('helvetica', 'normal');
  pdf.setTextColor(140, 130, 120);
  pdf.text(pt('pdf_scale_verify', 'Verify: measure this bar with a ruler. Must be exactly 10 mm.'), barX + barLen / 2, barY + 3.5, { align: 'center' });
}

/**
 * Draw branded header bar on a PDF page.
 * Crimson accent bar + logo text + pattern info + page number.
 */
function drawBrandedHeader(pdf, text, fontName, patternWidth, patternHeight, pageNum, totalPages, margin, pageW) {
  const barY = margin - 2;
  const barH = 12;

  // Accent bar background
  pdf.setFillColor(184, 58, 42); // var(--accent) #b83a2a
  pdf.rect(margin, barY, pageW - margin * 2, barH, 'F');

  // Logo: X Word2Stitch
  pdf.setFont('helvetica', 'bold');
  pdf.setFontSize(9);
  pdf.setTextColor(255, 255, 255);
  pdf.text('\u2715 Word2Stitch', margin + 3, barY + 5);

  // Pattern description
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(7);
  pdf.setTextColor(255, 230, 225);
  const desc = '"' + truncate(text, 25) + '" \u00B7 ' + fontName + ' \u00B7 ' +
    patternWidth + '\u00D7' + patternHeight;
  pdf.text(desc, margin + 3, barY + 9.5);

  // Page number (right-aligned)
  pdf.setFont('helvetica', 'bold');
  pdf.setFontSize(8);
  pdf.setTextColor(255, 255, 255);
  pdf.text(pageNum + ' / ' + totalPages, pageW - margin - 3, barY + 7, { align: 'right' });
}

/**
 * Draw branded footer on a PDF page.
 * Thin accent line + branding text + date.
 */
function drawBrandedFooter(pdf, margin, pageW, pageH) {
  const footerY = pageH - margin + 2;

  // Accent line
  pdf.setDrawColor(184, 58, 42);
  pdf.setLineWidth(0.5);
  pdf.line(margin, footerY, pageW - margin, footerY);

  // Left: branding
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(7);
  pdf.setTextColor(184, 58, 42);
  pdf.text('\u2715 Word2Stitch \u2014 ' + pt('pdf_footer_tagline', 'Cross-Stitch Pattern Generator'), margin, footerY + 4);

  // Right: date
  pdf.setTextColor(160, 150, 140);
  var now = new Date();
  var dateStr = now.getFullYear() + '-' +
    String(now.getMonth() + 1).padStart(2, '0') + '-' +
    String(now.getDate()).padStart(2, '0');
  pdf.text(dateStr, pageW - margin, footerY + 4, { align: 'right' });
}

/**
 * Build the PDF document with given orientation.
 * Returns { pdf, filename } without saving.
 */
function buildPDF(text, fontData, dmcColor, aidaCount, orientation) {
  const bitmap = getTextBitmapForPDF(text, fontData);
  if (bitmap.length === 0 || !bitmap[0] || bitmap[0].length === 0) {
    return null;
  }

  const patternWidth = bitmap[0].length;
  const patternHeight = bitmap.length;

  let stitchCount = 0;
  for (let row = 0; row < patternHeight; row++) {
    for (let col = 0; col < patternWidth; col++) {
      if (bitmap[row][col]) stitchCount++;
    }
  }

  const isLandscape = orientation === 'landscape';
  const pageW = isLandscape ? 297 : 210;
  const pageH = isLandscape ? 210 : 297;
  const margin = 15;
  const headerHeight = 14;
  // 1:1 scale: cellSize = real stitch size in mm = 25.4 / aidaCount
  const cellSize = 25.4 / aidaCount;

  const usableW = pageW - margin * 2;
  const usableH = pageH - margin * 2 - headerHeight;

  const layout = calculatePDFLayout(patternWidth, patternHeight, cellSize, usableW, usableH);

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({
    orientation: isLandscape ? 'landscape' : 'portrait',
    unit: 'mm',
    format: 'a4',
  });

  const totalGridPages = layout.totalPages;
  const totalPagesWithLegend = totalGridPages + 1;
  const fontName = fontData.name || fontData.id || 'Unknown';

  let pageNum = 0;
  for (let pageY = 0; pageY < layout.pagesY; pageY++) {
    for (let pageX = 0; pageX < layout.pagesX; pageX++) {
      if (pageNum > 0) {
        pdf.addPage();
      }
      pageNum++;

      const startCol = pageX * layout.colsPerPage;
      const startRow = pageY * layout.rowsPerPage;

      drawBrandedHeader(pdf, text, fontName, patternWidth, patternHeight, pageNum, totalPagesWithLegend, margin, pageW);
      drawBrandedFooter(pdf, margin, pageW, pageH);

      drawGridPage(pdf, {
        bitmap: bitmap,
        color: { r: dmcColor.r, g: dmcColor.g, b: dmcColor.b },
        startCol: startCol,
        startRow: startRow,
        colsPerPage: layout.colsPerPage,
        rowsPerPage: layout.rowsPerPage,
        cellSize: cellSize,
        margins: { left: margin, top: margin + headerHeight },
        layout: layout,
      });
    }
  }

  pdf.addPage();
  drawLegend(pdf, {
    color: dmcColor,
    stitchCount: stitchCount,
    aidaCount: aidaCount,
    width: patternWidth,
    height: patternHeight,
    fontName: fontName,
    text: text,
    pageNum: totalPagesWithLegend,
    totalPages: totalPagesWithLegend,
    pageW: pageW,
    pageH: pageH,
  });

  const safeText = text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '').substring(0, 40);
  const safeId = (fontData.id || 'font').replace(/[^a-z0-9-]/g, '');
  const filename = 'word2stitch-' + (safeText || 'pattern') + '-' + safeId + '.pdf';

  return { pdf, filename, pages: totalPagesWithLegend, stitches: stitchCount, patternWidth, patternHeight };
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Word2Stitch â€” PDF Modal
//  Print preview modal UI and PDF generation entry point
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Create and show the print preview modal.
 */
function _createPrintModal() {
  if (document.getElementById('printModal')) return;

  var modal = document.createElement('div');
  modal.id = 'printModal';
  modal.innerHTML = [
    '<div class="pm-backdrop"></div>',
    '<div class="pm-dialog">',
    '  <div class="pm-header">',
    '    <span class="pm-title">\u2715 Print Preview</span>',
    '    <button class="pm-close" id="pmClose">\u2715</button>',
    '  </div>',
    '  <div class="pm-orient-row">',
    '    <button class="pm-orient-btn pm-active" data-orient="portrait">',
    '      <svg viewBox="0 0 24 32" width="20" height="26"><rect x="1" y="1" width="22" height="30" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><line x1="5" y1="8" x2="19" y2="8" stroke="currentColor" stroke-width="1.5"/></svg>',
    '      Portrait',
    '    </button>',
    '    <button class="pm-orient-btn" data-orient="landscape">',
    '      <svg viewBox="0 0 32 24" width="26" height="20"><rect x="1" y="1" width="30" height="22" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><line x1="5" y1="6" x2="27" y2="6" stroke="currentColor" stroke-width="1.5"/></svg>',
    '      Landscape',
    '    </button>',
    '  </div>',
    '  <div class="pm-preview">',
    '    <iframe id="pmIframe" class="pm-iframe"></iframe>',
    '  </div>',
    '  <div class="pm-info" id="pmInfo"></div>',
    '  <div class="pm-actions">',
    '    <button class="pm-btn pm-btn-secondary" id="pmDownload">',
    '      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',
    '      Download PDF',
    '    </button>',
    '    <button class="pm-btn pm-btn-primary" id="pmPrint">',
    '      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>',
    '      Print',
    '    </button>',
    '  </div>',
    '</div>',
  ].join('\n');

  var style = document.createElement('style');
  style.textContent = [
    '#printModal { position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center; }',
    '#printModal.pm-hidden { display:none; }',
    '.pm-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.5); }',
    '.pm-dialog { position:relative; background:#faf8f5; border-radius:14px; width:90vw; max-width:680px; max-height:90vh; display:flex; flex-direction:column; box-shadow:0 20px 60px rgba(0,0,0,0.3); overflow:hidden; }',
    '.pm-header { display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid #e0d6c8; }',
    '.pm-title { font-family:"DM Serif Display",Georgia,serif; font-size:18px; color:#3d3229; }',
    '.pm-close { background:none; border:none; font-size:18px; color:#a99e8f; cursor:pointer; padding:4px 8px; border-radius:6px; transition:background 0.15s, color 0.15s; }',
    '.pm-close:hover { background:rgba(184,58,42,0.08); color:#b83a2a; }',
    '.pm-orient-row { display:flex; gap:8px; padding:12px 18px; justify-content:center; }',
    '.pm-orient-btn { display:flex; align-items:center; gap:8px; padding:10px 20px; border:2px solid #e0d6c8; border-radius:10px; background:#fff; cursor:pointer; font-family:"Anybody",system-ui,sans-serif; font-size:13px; font-weight:600; color:#7a6e60; transition:border-color 0.15s, background 0.15s, color 0.15s; min-height:48px; }',
    '.pm-orient-btn:hover { border-color:#b83a2a; color:#b83a2a; }',
    '.pm-orient-btn.pm-active { border-color:#b83a2a; background:rgba(184,58,42,0.08); color:#b83a2a; }',
    '.pm-preview { flex:1; min-height:0; padding:0 18px; overflow:hidden; }',
    '.pm-iframe { width:100%; height:350px; border:1px solid #e0d6c8; border-radius:8px; background:#fff; }',
    '.pm-info { padding:8px 18px; font-size:12px; color:#7a6e60; text-align:center; }',
    '.pm-actions { display:flex; gap:10px; padding:14px 18px; border-top:1px solid #e0d6c8; justify-content:flex-end; }',
    '.pm-btn { display:flex; align-items:center; gap:6px; padding:10px 20px; border-radius:10px; font-family:"Anybody",system-ui,sans-serif; font-size:14px; font-weight:600; cursor:pointer; border:none; transition:background 0.15s, color 0.15s, box-shadow 0.15s; min-height:48px; }',
    '.pm-btn-secondary { background:#fff; color:#3d3229; border:2px solid #e0d6c8; }',
    '.pm-btn-secondary:hover { border-color:#b83a2a; color:#b83a2a; }',
    '.pm-btn-primary { background:#b83a2a; color:#fff; }',
    '.pm-btn-primary:hover { background:#9c3023; box-shadow:0 3px 12px rgba(184,58,42,0.25); }',
    '@media(max-width:640px) { .pm-dialog { width:96vw; max-height:95vh; border-radius:10px; } .pm-preview { display:none; } .pm-orient-btn { padding:8px 14px; font-size:12px; } .pm-actions { flex-direction:column; } .pm-btn { justify-content:center; } }',
  ].join('\n');

  document.head.appendChild(style);
  document.body.appendChild(modal);

  // Apply i18n to modal UI strings
  modal.querySelector('.pm-title').textContent = '\u2715 ' + pt('pdf_print_preview', 'Print Preview');
  modal.querySelector('[data-orient="portrait"]').lastChild.textContent = ' ' + pt('pdf_orient_portrait', 'Portrait');
  modal.querySelector('[data-orient="landscape"]').lastChild.textContent = ' ' + pt('pdf_orient_landscape', 'Landscape');
  document.getElementById('pmDownload').lastChild.textContent = ' ' + pt('pdf_btn_download', 'Download PDF');
  document.getElementById('pmPrint').lastChild.textContent = ' ' + pt('pdf_btn_print', 'Print');
}

/**
 * Show the print preview modal.
 * Generates PDF in chosen orientation and displays in iframe.
 */
function generatePDF(text, fontData, dmcColor, aidaCount) {
  if (!text || !text.trim()) { alert(pt('pdf_alert_no_text', 'Please enter some text.')); return; }
  if (!fontData || !fontData.glyphs) { alert(pt('pdf_alert_no_font', 'No font selected.')); return; }
  if (!dmcColor) { alert(pt('pdf_alert_no_color', 'No color selected.')); return; }

  _createPrintModal();

  var modal = document.getElementById('printModal');
  var iframe = document.getElementById('pmIframe');
  var info = document.getElementById('pmInfo');
  var currentOrientation = 'portrait';
  var currentBlobUrl = null;

  function buildAndShow(orient) {
    var result = buildPDF(text, fontData, dmcColor, aidaCount, orient);
    if (!result) { alert(pt('pdf_alert_no_render', 'Could not render pattern.')); return; }

    if (currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
    var blob = result.pdf.output('blob');
    currentBlobUrl = URL.createObjectURL(blob);

    iframe.src = currentBlobUrl;

    var cmW = (result.patternWidth / aidaCount * 2.54).toFixed(1);
    var cmH = (result.patternHeight / aidaCount * 2.54).toFixed(1);
    var inW = (result.patternWidth / aidaCount).toFixed(1);
    var inH = (result.patternHeight / aidaCount).toFixed(1);
    var isImperial = (typeof window.getDisplayUnit === 'function' && window.getDisplayUnit() === 'imperial');
    var sizeStr = isImperial ? (inW + ' \u00d7 ' + inH + '"') : (cmW + ' \u00d7 ' + cmH + ' cm');
    info.textContent = result.patternWidth + '\u00d7' + result.patternHeight +
      ' ' + pt('pdf_unit_stitches', 'stitches') + ' \u00b7 ' + sizeStr + ' \u00b7 ' +
      result.pages + ' ' + pt('pdf_unit_pages', 'pages') + ' \u00b7 ' + result.stitches + ' ' + pt('pdf_unit_crosses', 'crosses');

    // Store for download/print
    modal._pdfResult = result;
    modal._blobUrl = currentBlobUrl;
  }

  // Show modal
  modal.classList.remove('pm-hidden');
  buildAndShow(currentOrientation);

  // Orientation buttons
  var orientBtns = modal.querySelectorAll('.pm-orient-btn');
  function handleOrient(e) {
    var btn = e.target.closest('.pm-orient-btn');
    if (!btn) return;
    var orient = btn.dataset.orient;
    if (orient === currentOrientation) return;
    currentOrientation = orient;
    orientBtns.forEach(function(b) { b.classList.toggle('pm-active', b.dataset.orient === orient); });
    buildAndShow(orient);
  }
  orientBtns.forEach(function(b) {
    b.removeEventListener('click', handleOrient);
    b.addEventListener('click', handleOrient);
  });

  // Close
  function closeModal() {
    modal.classList.add('pm-hidden');
    iframe.src = 'about:blank';
    if (currentBlobUrl) { URL.revokeObjectURL(currentBlobUrl); currentBlobUrl = null; }
  }
  modal.querySelector('.pm-backdrop').onclick = closeModal;
  document.getElementById('pmClose').onclick = closeModal;

  // Download
  document.getElementById('pmDownload').onclick = function() {
    if (modal._pdfResult) {
      modal._pdfResult.pdf.save(modal._pdfResult.filename);
    }
  };

  // Print
  document.getElementById('pmPrint').onclick = function() {
    if (modal._blobUrl) {
      var printWin = window.open(modal._blobUrl, '_blank');
      if (printWin) {
        printWin.addEventListener('load', function() {
          setTimeout(function() { printWin.print(); }, 500);
        });
      }
    }
  };
}

</script>

<!-- â•â•â• I18N Translations â•â•â• -->
<script>
// I18N translation dictionary for Word2Stitch
// Extracted from ui-shell.html for modularity
// This file is injected by assemble.js into the final index.html

  var I18N = {
    en: {
      placeholder_text: "Type your text hereâ€¦",
      section_font: "Font",
      search_fonts: "Search fontsâ€¦",
      tab_all: "All",
      section_height: "Stitch Height",
      unit_px: "st",
      section_color: "Thread Color",
      section_fabric: "Fabric",
      label_aida: "Aida",
      empty_state: "Type something to see your pattern",
      loading_text: "Rasterizingâ€¦",
      unit_cm: "cm",
      unit_stitches: "stitches",
      unit_crosses: "crosses",
      toggle_controls: "Toggle controls",
      no_fonts: "No fonts available",
      no_matching: "No matching fonts",
      server_error: "Failed to load fonts. Is the server running?",
      alert_no_text: "Type some text and select a font first.",
      alert_no_pdf: "PDF engine not loaded. Please reload the page.",
      alert_no_jspdf: "jsPDF library not loaded. Check your internet connection and reload.",
      alert_pdf_fail: "PDF generation failed: ",
      pdf_alert_no_text: "Please enter some text.",
      pdf_alert_no_font: "No font selected.",
      pdf_alert_no_color: "No color selected.",
      pdf_alert_no_render: "Could not render pattern.",
      label_custom: 'Custom',
      label_stitch_length: 'Stitch length',
      sheet_fabric: 'Fabric & Stitch',
      sheet_info: 'Pattern Info',
      label_dmc: 'DMC',
      label_thread: 'Thread',
      label_language: 'Language',
      pdf_thread_legend: "Thread Legend",
      pdf_pattern_info: "Pattern Information",
      pdf_col_symbol: "Symbol",
      pdf_col_swatch: "Swatch",
      pdf_col_dmc_code: "DMC Code",
      pdf_col_color_name: "Color Name",
      pdf_col_stitches: "Stitches",
      pdf_col_thread: "Thread",
      pdf_col_skeins: "Skeins",
      pdf_note_strands: "Use 2 strands of DMC thread for cross stitches",
      pdf_note_center: "Start from the center of the fabric for best results",
      pdf_note_print: "\u26a0 Print at 100% scale (no fit-to-page) for 1:1 stitch size",
      pdf_finished_size: "Finished Size",
      pdf_cut_fabric: "Cut Fabric",
      pdf_cut_margin_imperial: "(+3\" margin each side)",
      pdf_cut_margin_metric: "(+7.6 cm margin each side)",
      pdf_orient_portrait: "Portrait",
      pdf_orient_landscape: "Landscape",
      pdf_btn_download: "Download PDF",
      pdf_btn_print: "Print",
      pdf_print_preview: "Print Preview",
      pdf_scale_verify: "Verify: measure this bar with a ruler. Must be exactly 10 mm.",
      pdf_info_finished_size: "Finished size",
      pdf_info_thread_required: "Thread required",
      pdf_info_fabric_aida: "Fabric: Aida",
      pdf_info_each_stitch: "Each stitch",
      pdf_info_pattern_size: "Pattern size",
      pdf_info_total_crosses: "Total crosses",
      pdf_footer_tagline: "Cross-Stitch Pattern Generator",
      pdf_unit_stitches: "stitches",
      pdf_unit_pages: "pages",
      pdf_unit_crosses: "crosses",
      pdf_unit_skein: "skein",
      pdf_unit_skeins: "skeins"
    },
    es: {
      placeholder_text: "Escribe tu texto aquÃ­â€¦",
      section_font: "Fuente",
      search_fonts: "Buscar fuentesâ€¦",
      tab_all: "Todas",
      section_height: "Altura de Puntada",
      unit_px: "st",
      section_color: "Color de Hilo",
      section_fabric: "Tela",
      label_aida: "Aida",
      empty_state: "Escribe algo para ver tu patrÃ³n",
      loading_text: "Rasterizandoâ€¦",
      unit_cm: "cm",
      unit_stitches: "puntadas",
      unit_crosses: "cruces",
      toggle_controls: "Mostrar controles",
      no_fonts: "No hay fuentes disponibles",
      no_matching: "No se encontraron fuentes",
      server_error: "Error al cargar fuentes. Â¿EstÃ¡ el servidor activo?",
      alert_no_text: "Escribe un texto y selecciona una fuente primero.",
      alert_no_pdf: "Motor PDF no cargado. Recarga la pÃ¡gina.",
      alert_no_jspdf: "Biblioteca jsPDF no cargada. Verifica tu conexiÃ³n y recarga.",
      alert_pdf_fail: "Error al generar PDF: ",
      pdf_alert_no_text: "Por favor, ingresa un texto.",
      pdf_alert_no_font: "No se seleccionÃ³ ninguna fuente.",
      pdf_alert_no_color: "No se seleccionÃ³ ningÃºn color.",
      pdf_alert_no_render: "No se pudo generar el patrÃ³n.",
      label_custom: 'Personalizado',
      label_stitch_length: 'Largo de puntada',
      sheet_fabric: 'Tela y Puntada',
      sheet_info: 'Info del PatrÃ³n',
      label_dmc: 'DMC',
      label_thread: 'Hilo',
      label_language: 'Idioma',
      pdf_thread_legend: "Leyenda de Hilos",
      pdf_pattern_info: "InformaciÃ³n del PatrÃ³n",
      pdf_col_symbol: "SÃ­mbolo",
      pdf_col_swatch: "Muestra",
      pdf_col_dmc_code: "CÃ³digo DMC",
      pdf_col_color_name: "Color",
      pdf_col_stitches: "Puntadas",
      pdf_col_thread: "Hilo",
      pdf_col_skeins: "Madejas",
      pdf_note_strands: "Usar 2 hebras de hilo DMC para punto de cruz",
      pdf_note_center: "Comenzar desde el centro de la tela para mejores resultados",
      pdf_note_print: "\u26a0 Imprimir al 100% (sin ajustar a pÃ¡gina) para tamaÃ±o 1:1",
      pdf_finished_size: "TamaÃ±o Final",
      pdf_cut_fabric: "Cortar Tela",
      pdf_cut_margin_imperial: '(+3" de margen por lado)',
      pdf_cut_margin_metric: "(+7.6 cm de margen por lado)",
      pdf_orient_portrait: "Vertical",
      pdf_orient_landscape: "Horizontal",
      pdf_btn_download: "Descargar PDF",
      pdf_btn_print: "Imprimir",
      pdf_print_preview: "Vista Previa",
      pdf_scale_verify: "Verificar: medir esta barra con una regla. Debe ser exactamente 10 mm.",
      pdf_info_finished_size: "TamaÃ±o final",
      pdf_info_thread_required: "Hilo requerido",
      pdf_info_fabric_aida: "Tela: Aida",
      pdf_info_each_stitch: "Cada puntada",
      pdf_info_pattern_size: "TamaÃ±o del patrÃ³n",
      pdf_info_total_crosses: "Total de cruces",
      pdf_footer_tagline: "Generador de Patrones de Punto de Cruz",
      pdf_unit_stitches: "puntadas",
      pdf_unit_pages: "pÃ¡ginas",
      pdf_unit_crosses: "cruces",
      pdf_unit_skein: "madeja",
      pdf_unit_skeins: "madejas"
    },
    fr: {
      placeholder_text: "Tapez votre texte iciâ€¦",
      section_font: "Police",
      search_fonts: "Rechercher des policesâ€¦",
      tab_all: "Toutes",
      section_height: "Hauteur de Point",
      unit_px: "st",
      section_color: "Couleur du Fil",
      section_fabric: "Tissu",
      label_aida: "Aida",
      empty_state: "Tapez quelque chose pour voir votre motif",
      loading_text: "RastÃ©risationâ€¦",
      unit_cm: "cm",
      unit_stitches: "points",
      unit_crosses: "croix",
      toggle_controls: "Afficher les contrÃ´les",
      no_fonts: "Aucune police disponible",
      no_matching: "Aucune police trouvÃ©e",
      server_error: "Ã‰chec du chargement des polices. Le serveur est-il lancÃ© ?",
      alert_no_text: "Tapez du texte et sÃ©lectionnez une police d'abord.",
      alert_no_pdf: "Moteur PDF non chargÃ©. Rechargez la page.",
      alert_no_jspdf: "BibliothÃ¨que jsPDF non chargÃ©e. VÃ©rifiez votre connexion et rechargez.",
      alert_pdf_fail: "Ã‰chec de la gÃ©nÃ©ration du PDF : ",
      pdf_alert_no_text: "Veuillez saisir du texte.",
      pdf_alert_no_font: "Aucune police sÃ©lectionnÃ©e.",
      pdf_alert_no_color: "Aucune couleur sÃ©lectionnÃ©e.",
      pdf_alert_no_render: "Impossible de gÃ©nÃ©rer le motif.",
      label_custom: "PersonnalisÃ©",
      label_stitch_length: "Longueur de point",
      sheet_fabric: "Tissu et Point",
      sheet_info: "Info du Patron",
      label_dmc: "DMC",
      label_thread: "Fil",
      label_language: "Langue",
      pdf_thread_legend: "LÃ©gende des Fils",
      pdf_pattern_info: "Informations du ModÃ¨le",
      pdf_col_symbol: "Symbole",
      pdf_col_swatch: "Ã‰chantillon",
      pdf_col_dmc_code: "Code DMC",
      pdf_col_color_name: "Couleur",
      pdf_col_stitches: "Points",
      pdf_col_thread: "Fil",
      pdf_col_skeins: "Ã‰chevettes",
      pdf_note_strands: "Utiliser 2 brins de fil DMC pour les points de croix",
      pdf_note_center: "Commencer par le centre du tissu pour de meilleurs rÃ©sultats",
      pdf_note_print: "\u26a0 Imprimer Ã  100% (sans ajuster Ã  la page) pour une taille 1:1",
      pdf_finished_size: "Taille Finie",
      pdf_cut_fabric: "Couper le Tissu",
      pdf_cut_margin_imperial: '(+3" de marge de chaque cÃ´tÃ©)',
      pdf_cut_margin_metric: "(+7,6 cm de marge de chaque cÃ´tÃ©)",
      pdf_orient_portrait: "Portrait",
      pdf_orient_landscape: "Paysage",
      pdf_btn_download: "TÃ©lÃ©charger PDF",
      pdf_btn_print: "Imprimer",
      pdf_print_preview: "AperÃ§u",
      pdf_scale_verify: "VÃ©rifier : mesurer cette barre avec une rÃ¨gle. Doit faire exactement 10 mm.",
      pdf_info_finished_size: "Taille finie",
      pdf_info_thread_required: "Fil requis",
      pdf_info_fabric_aida: "Tissu : Aida",
      pdf_info_each_stitch: "Chaque point",
      pdf_info_pattern_size: "Taille du motif",
      pdf_info_total_crosses: "Total de croix",
      pdf_footer_tagline: "GÃ©nÃ©rateur de ModÃ¨les Point de Croix",
      pdf_unit_stitches: "points",
      pdf_unit_pages: "pages",
      pdf_unit_crosses: "croix",
      pdf_unit_skein: "Ã©chevette",
      pdf_unit_skeins: "Ã©chevettes"
    },
    de: {
      placeholder_text: "Gib deinen Text einâ€¦",
      section_font: "Schriftart",
      search_fonts: "Schriftarten suchenâ€¦",
      tab_all: "Alle",
      section_height: "StichhÃ¶he",
      unit_px: "st",
      section_color: "Garnfarbe",
      section_fabric: "Stoff",
      label_aida: "Aida",
      empty_state: "Tippe etwas, um dein Muster zu sehen",
      loading_text: "Wird gerastertâ€¦",
      unit_cm: "cm",
      unit_stitches: "Stiche",
      unit_crosses: "Kreuze",
      toggle_controls: "Steuerung anzeigen",
      no_fonts: "Keine Schriftarten verfÃ¼gbar",
      no_matching: "Keine passenden Schriftarten",
      server_error: "Schriftarten konnten nicht geladen werden. LÃ¤uft der Server?",
      alert_no_text: "Gib einen Text ein und wÃ¤hle eine Schriftart.",
      alert_no_pdf: "PDF-Engine nicht geladen. Seite neu laden.",
      alert_no_jspdf: "jsPDF nicht geladen. PrÃ¼fe deine Internetverbindung und lade neu.",
      alert_pdf_fail: "PDF-Erzeugung fehlgeschlagen: ",
      pdf_alert_no_text: "Bitte geben Sie einen Text ein.",
      pdf_alert_no_font: "Keine Schriftart ausgewÃ¤hlt.",
      pdf_alert_no_color: "Keine Farbe ausgewÃ¤hlt.",
      pdf_alert_no_render: "Muster konnte nicht erstellt werden.",
      label_custom: "Benutzerdefiniert",
      label_stitch_length: "StichlÃ¤nge",
      sheet_fabric: "Stoff und Stich",
      sheet_info: "Musterinfo",
      label_dmc: "DMC",
      label_thread: "Faden",
      label_language: "Sprache",
      pdf_thread_legend: "Garnlegende",
      pdf_pattern_info: "Musterinformationen",
      pdf_col_symbol: "Symbol",
      pdf_col_swatch: "Farbfeld",
      pdf_col_dmc_code: "DMC-Code",
      pdf_col_color_name: "Farbe",
      pdf_col_stitches: "Stiche",
      pdf_col_thread: "Faden",
      pdf_col_skeins: "StrÃ¤nge",
      pdf_note_strands: "2 FÃ¤den DMC-Garn fÃ¼r Kreuzstiche verwenden",
      pdf_note_center: "Von der Mitte des Stoffes beginnen fÃ¼r beste Ergebnisse",
      pdf_note_print: "\u26a0 Mit 100% drucken (nicht an Seite anpassen) fÃ¼r 1:1 StichgrÃ¶ÃŸe",
      pdf_finished_size: "Fertige GrÃ¶ÃŸe",
      pdf_cut_fabric: "Stoff Zuschneiden",
      pdf_cut_margin_imperial: '(+3" Rand auf jeder Seite)',
      pdf_cut_margin_metric: "(+7,6 cm Rand auf jeder Seite)",
      pdf_orient_portrait: "Hochformat",
      pdf_orient_landscape: "Querformat",
      pdf_btn_download: "PDF Herunterladen",
      pdf_btn_print: "Drucken",
      pdf_print_preview: "Druckvorschau",
      pdf_scale_verify: "PrÃ¼fen: Diese Leiste mit einem Lineal messen. Muss genau 10 mm sein.",
      pdf_info_finished_size: "Fertige GrÃ¶ÃŸe",
      pdf_info_thread_required: "Faden benÃ¶tigt",
      pdf_info_fabric_aida: "Stoff: Aida",
      pdf_info_each_stitch: "Jeder Stich",
      pdf_info_pattern_size: "MustergrÃ¶ÃŸe",
      pdf_info_total_crosses: "Kreuzstiche gesamt",
      pdf_footer_tagline: "Kreuzstich-Mustergenerator",
      pdf_unit_stitches: "Stiche",
      pdf_unit_pages: "Seiten",
      pdf_unit_crosses: "Kreuze",
      pdf_unit_skein: "Strang",
      pdf_unit_skeins: "StrÃ¤nge"
    },
    it: {
      placeholder_text: "Scrivi il tuo testo quiâ€¦",
      section_font: "Font",
      search_fonts: "Cerca fontâ€¦",
      tab_all: "Tutti",
      section_height: "Altezza Punto",
      unit_px: "st",
      section_color: "Colore Filo",
      section_fabric: "Tessuto",
      label_aida: "Aida",
      empty_state: "Scrivi qualcosa per vedere il tuo schema",
      loading_text: "Rasterizzazioneâ€¦",
      unit_cm: "cm",
      unit_stitches: "punti",
      unit_crosses: "croci",
      toggle_controls: "Mostra controlli",
      no_fonts: "Nessun font disponibile",
      no_matching: "Nessun font trovato",
      server_error: "Caricamento font fallito. Il server Ã¨ attivo?",
      alert_no_text: "Scrivi un testo e seleziona un font prima.",
      alert_no_pdf: "Motore PDF non caricato. Ricarica la pagina.",
      alert_no_jspdf: "Libreria jsPDF non caricata. Controlla la connessione e ricarica.",
      alert_pdf_fail: "Generazione PDF fallita: ",
      pdf_alert_no_text: "Inserisci del testo.",
      pdf_alert_no_font: "Nessun font selezionato.",
      pdf_alert_no_color: "Nessun colore selezionato.",
      pdf_alert_no_render: "Impossibile generare il modello.",
      label_custom: "Personalizzato",
      label_stitch_length: "Lunghezza punto",
      sheet_fabric: "Tessuto e Punto",
      sheet_info: "Info Modello",
      label_dmc: "DMC",
      label_thread: "Filo",
      label_language: "Lingua",
      pdf_thread_legend: "Legenda Fili",
      pdf_pattern_info: "Informazioni Modello",
      pdf_col_symbol: "Simbolo",
      pdf_col_swatch: "Campione",
      pdf_col_dmc_code: "Codice DMC",
      pdf_col_color_name: "Colore",
      pdf_col_stitches: "Punti",
      pdf_col_thread: "Filo",
      pdf_col_skeins: "Matasse",
      pdf_note_strands: "Usare 2 fili di cotone DMC per i punti croce",
      pdf_note_center: "Iniziare dal centro del tessuto per risultati migliori",
      pdf_note_print: "\u26a0 Stampare al 100% (non adattare alla pagina) per dimensione 1:1",
      pdf_finished_size: "Dimensione Finita",
      pdf_cut_fabric: "Tagliare Tessuto",
      pdf_cut_margin_imperial: '(+3" di margine per lato)',
      pdf_cut_margin_metric: "(+7,6 cm di margine per lato)",
      pdf_orient_portrait: "Verticale",
      pdf_orient_landscape: "Orizzontale",
      pdf_btn_download: "Scarica PDF",
      pdf_btn_print: "Stampa",
      pdf_print_preview: "Anteprima",
      pdf_scale_verify: "Verificare: misurare questa barra con un righello. Deve essere esattamente 10 mm.",
      pdf_info_finished_size: "Dimensione finita",
      pdf_info_thread_required: "Filo necessario",
      pdf_info_fabric_aida: "Tessuto: Aida",
      pdf_info_each_stitch: "Ogni punto",
      pdf_info_pattern_size: "Dimensione modello",
      pdf_info_total_crosses: "Punti croce totali",
      pdf_footer_tagline: "Generatore di Schemi Punto Croce",
      pdf_unit_stitches: "punti",
      pdf_unit_pages: "pagine",
      pdf_unit_crosses: "croci",
      pdf_unit_skein: "matassa",
      pdf_unit_skeins: "matasse"
    },
    pt: {
      placeholder_text: "Digite seu texto aquiâ€¦",
      section_font: "Fonte",
      search_fonts: "Buscar fontesâ€¦",
      tab_all: "Todas",
      section_height: "Altura do Ponto",
      unit_px: "st",
      section_color: "Cor da Linha",
      section_fabric: "Tecido",
      label_aida: "Aida",
      empty_state: "Digite algo para ver seu padrÃ£o",
      loading_text: "Rasterizandoâ€¦",
      unit_cm: "cm",
      unit_stitches: "pontos",
      unit_crosses: "cruzes",
      toggle_controls: "Mostrar controles",
      no_fonts: "Nenhuma fonte disponÃ­vel",
      no_matching: "Nenhuma fonte encontrada",
      server_error: "Falha ao carregar fontes. O servidor estÃ¡ ativo?",
      alert_no_text: "Digite um texto e selecione uma fonte primeiro.",
      alert_no_pdf: "Motor PDF nÃ£o carregado. Recarregue a pÃ¡gina.",
      alert_no_jspdf: "Biblioteca jsPDF nÃ£o carregada. Verifique sua conexÃ£o e recarregue.",
      alert_pdf_fail: "Falha na geraÃ§Ã£o do PDF: ",
      pdf_alert_no_text: "Por favor, insira um texto.",
      pdf_alert_no_font: "Nenhuma fonte selecionada.",
      pdf_alert_no_color: "Nenhuma cor selecionada.",
      pdf_alert_no_render: "NÃ£o foi possÃ­vel gerar o padrÃ£o.",
      label_custom: "Personalizado",
      label_stitch_length: "Comprimento do ponto",
      sheet_fabric: "Tecido e Ponto",
      sheet_info: "Info do PadrÃ£o",
      label_dmc: "DMC",
      label_thread: "Linha",
      label_language: "Idioma",
      pdf_thread_legend: "Legenda de Linhas",
      pdf_pattern_info: "InformaÃ§Ãµes do PadrÃ£o",
      pdf_col_symbol: "SÃ­mbolo",
      pdf_col_swatch: "Amostra",
      pdf_col_dmc_code: "CÃ³digo DMC",
      pdf_col_color_name: "Cor",
      pdf_col_stitches: "Pontos",
      pdf_col_thread: "Linha",
      pdf_col_skeins: "Meadas",
      pdf_note_strands: "Usar 2 fios de linha DMC para ponto cruz",
      pdf_note_center: "ComeÃ§ar pelo centro do tecido para melhores resultados",
      pdf_note_print: "\u26a0 Imprimir em 100% (sem ajustar Ã  pÃ¡gina) para tamanho 1:1",
      pdf_finished_size: "Tamanho Final",
      pdf_cut_fabric: "Cortar Tecido",
      pdf_cut_margin_imperial: '(+3" de margem de cada lado)',
      pdf_cut_margin_metric: "(+7,6 cm de margem de cada lado)",
      pdf_orient_portrait: "Retrato",
      pdf_orient_landscape: "Paisagem",
      pdf_btn_download: "Baixar PDF",
      pdf_btn_print: "Imprimir",
      pdf_print_preview: "PrÃ©-visualizaÃ§Ã£o",
      pdf_scale_verify: "Verificar: meÃ§a esta barra com uma rÃ©gua. Deve ter exatamente 10 mm.",
      pdf_info_finished_size: "Tamanho final",
      pdf_info_thread_required: "Linha necessÃ¡ria",
      pdf_info_fabric_aida: "Tecido: Aida",
      pdf_info_each_stitch: "Cada ponto",
      pdf_info_pattern_size: "Tamanho do padrÃ£o",
      pdf_info_total_crosses: "Total de cruzes",
      pdf_footer_tagline: "Gerador de PadrÃµes Ponto Cruz",
      pdf_unit_stitches: "pontos",
      pdf_unit_pages: "pÃ¡ginas",
      pdf_unit_crosses: "cruzes",
      pdf_unit_skein: "meada",
      pdf_unit_skeins: "meadas"
    },
    nl: {
      placeholder_text: "Typ je tekst hierâ€¦",
      section_font: "Lettertype",
      search_fonts: "Lettertypen zoekenâ€¦",
      tab_all: "Alle",
      section_height: "Steekhoogte",
      unit_px: "st",
      section_color: "Draadkleur",
      section_fabric: "Stof",
      label_aida: "Aida",
      empty_state: "Typ iets om je patroon te zien",
      loading_text: "Rasterenâ€¦",
      unit_cm: "cm",
      unit_stitches: "steken",
      unit_crosses: "kruisjes",
      toggle_controls: "Bediening tonen",
      no_fonts: "Geen lettertypen beschikbaar",
      no_matching: "Geen overeenkomende lettertypen",
      server_error: "Lettertypen laden mislukt. Draait de server?",
      alert_no_text: "Typ tekst en selecteer een lettertype.",
      alert_no_pdf: "PDF-engine niet geladen. Herlaad de pagina.",
      alert_no_jspdf: "jsPDF-bibliotheek niet geladen. Controleer je verbinding en herlaad.",
      alert_pdf_fail: "PDF genereren mislukt: ",
      pdf_alert_no_text: "Voer een tekst in.",
      pdf_alert_no_font: "Geen lettertype geselecteerd.",
      pdf_alert_no_color: "Geen kleur geselecteerd.",
      pdf_alert_no_render: "Patroon kon niet worden gegenereerd.",
      label_custom: "Aangepast",
      label_stitch_length: "Steeklengte",
      sheet_fabric: "Stof en Steek",
      sheet_info: "Patrooninfo",
      label_dmc: "DMC",
      label_thread: "Draad",
      label_language: "Taal",
      pdf_thread_legend: "Draadlegende",
      pdf_pattern_info: "Patrooninformatie",
      pdf_col_symbol: "Symbool",
      pdf_col_swatch: "Staal",
      pdf_col_dmc_code: "DMC-code",
      pdf_col_color_name: "Kleur",
      pdf_col_stitches: "Steken",
      pdf_col_thread: "Draad",
      pdf_col_skeins: "Strengen",
      pdf_note_strands: "Gebruik 2 draden DMC-garen voor kruissteek",
      pdf_note_center: "Begin in het midden van de stof voor het beste resultaat",
      pdf_note_print: "\u26a0 Print op 100% (niet passend maken) voor 1:1 steekgrootte",
      pdf_finished_size: "Afgewerkte Maat",
      pdf_cut_fabric: "Stof Knippen",
      pdf_cut_margin_imperial: '(+3" marge aan elke kant)',
      pdf_cut_margin_metric: "(+7,6 cm marge aan elke kant)",
      pdf_orient_portrait: "Staand",
      pdf_orient_landscape: "Liggend",
      pdf_btn_download: "PDF Downloaden",
      pdf_btn_print: "Afdrukken",
      pdf_print_preview: "Afdrukvoorbeeld",
      pdf_scale_verify: "Controleer: meet deze balk met een liniaal. Moet precies 10 mm zijn.",
      pdf_info_finished_size: "Afgewerkte maat",
      pdf_info_thread_required: "Draad nodig",
      pdf_info_fabric_aida: "Stof: Aida",
      pdf_info_each_stitch: "Elke steek",
      pdf_info_pattern_size: "Patroongrootte",
      pdf_info_total_crosses: "Totaal kruisjes",
      pdf_footer_tagline: "Kruissteekpatroongenerator",
      pdf_unit_stitches: "steken",
      pdf_unit_pages: "pagina's",
      pdf_unit_crosses: "kruisjes",
      pdf_unit_skein: "streng",
      pdf_unit_skeins: "strengen"
    },
    ja: {
      placeholder_text: "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›â€¦",
      section_font: "ãƒ•ã‚©ãƒ³ãƒˆ",
      search_fonts: "ãƒ•ã‚©ãƒ³ãƒˆã‚’æ¤œç´¢â€¦",
      tab_all: "ã™ã¹ã¦",
      section_height: "ã‚¹ãƒ†ãƒƒãƒé«˜ã•",
      unit_px: "st",
      section_color: "ç³¸ã®è‰²",
      section_fabric: "å¸ƒåœ°",
      label_aida: "ã‚¢ã‚¤ãƒ¼ãƒ€",
      empty_state: "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™",
      loading_text: "ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºä¸­â€¦",
      unit_cm: "cm",
      unit_stitches: "ã‚¹ãƒ†ãƒƒãƒ",
      unit_crosses: "ã‚¯ãƒ­ã‚¹",
      toggle_controls: "ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¡¨ç¤º",
      no_fonts: "ãƒ•ã‚©ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“",
      no_matching: "ä¸€è‡´ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“",
      server_error: "ãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ã¯èµ·å‹•ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
      alert_no_text: "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãƒ•ã‚©ãƒ³ãƒˆã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚",
      alert_no_pdf: "PDFã‚¨ãƒ³ã‚¸ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚",
      alert_no_jspdf: "jsPDFãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æŽ¥ç¶šã‚’ç¢ºèªã—ã¦å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚",
      alert_pdf_fail: "PDFç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ",
      pdf_alert_no_text: "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
      pdf_alert_no_font: "ãƒ•ã‚©ãƒ³ãƒˆãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚",
      pdf_alert_no_color: "è‰²ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚",
      pdf_alert_no_render: "ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚",
      label_custom: "ã‚«ã‚¹ã‚¿ãƒ ",
      label_stitch_length: "ã‚¹ãƒ†ãƒƒãƒã®é•·ã•",
      sheet_fabric: "å¸ƒã¨ã‚¹ãƒ†ãƒƒãƒ",
      sheet_info: "ãƒ‘ã‚¿ãƒ¼ãƒ³æƒ…å ±",
      label_dmc: "DMC",
      label_thread: "ç³¸",
      label_language: "è¨€èªž",
      pdf_thread_legend: "ç³¸ã®å‡¡ä¾‹",
      pdf_pattern_info: "ãƒ‘ã‚¿ãƒ¼ãƒ³æƒ…å ±",
      pdf_col_symbol: "è¨˜å·",
      pdf_col_swatch: "è¦‹æœ¬",
      pdf_col_dmc_code: "DMCã‚³ãƒ¼ãƒ‰",
      pdf_col_color_name: "è‰²å",
      pdf_col_stitches: "ã‚¹ãƒ†ãƒƒãƒæ•°",
      pdf_col_thread: "ç³¸",
      pdf_col_skeins: "ã‹ã›",
      pdf_note_strands: "ã‚¯ãƒ­ã‚¹ã‚¹ãƒ†ãƒƒãƒã«ã¯DMCç³¸2æœ¬å–ã‚Šã§",
      pdf_note_center: "æœ€è‰¯ã®çµæžœã‚’å¾—ã‚‹ãŸã‚ã«å¸ƒã®ä¸­å¤®ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„",
      pdf_note_print: "\u26a0 1:1ã‚µã‚¤ã‚ºã§100%å°åˆ·ã—ã¦ãã ã•ã„ï¼ˆãƒšãƒ¼ã‚¸ã«åˆã‚ã›ãªã„ã§ï¼‰",
      pdf_finished_size: "å®Œæˆã‚µã‚¤ã‚º",
      pdf_cut_fabric: "å¸ƒã®ã‚«ãƒƒãƒˆ",
      pdf_cut_margin_imperial: '(å„è¾º+3"ã®ä½™ç™½)',
      pdf_cut_margin_metric: "(å„è¾º+7.6 cmã®ä½™ç™½)",
      pdf_orient_portrait: "ç¸¦",
      pdf_orient_landscape: "æ¨ª",
      pdf_btn_download: "PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
      pdf_btn_print: "å°åˆ·",
      pdf_print_preview: "å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
      pdf_scale_verify: "ç¢ºèªï¼šã“ã®ç·šã‚’å®šè¦ã§æ¸¬ã£ã¦ãã ã•ã„ã€‚æ­£ç¢ºã«10 mmã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
      pdf_info_finished_size: "å®Œæˆã‚µã‚¤ã‚º",
      pdf_info_thread_required: "å¿…è¦ãªç³¸",
      pdf_info_fabric_aida: "å¸ƒ: Aida",
      pdf_info_each_stitch: "å„ã‚¹ãƒ†ãƒƒãƒ",
      pdf_info_pattern_size: "ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚µã‚¤ã‚º",
      pdf_info_total_crosses: "ã‚¯ãƒ­ã‚¹åˆè¨ˆ",
      pdf_footer_tagline: "ã‚¯ãƒ­ã‚¹ã‚¹ãƒ†ãƒƒãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼",
      pdf_unit_stitches: "ã‚¹ãƒ†ãƒƒãƒ",
      pdf_unit_pages: "ãƒšãƒ¼ã‚¸",
      pdf_unit_crosses: "ã‚¯ãƒ­ã‚¹",
      pdf_unit_skein: "ã‹ã›",
      pdf_unit_skeins: "ã‹ã›"
    },
    ko: {
      placeholder_text: "í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”â€¦",
      section_font: "ê¸€ê¼´",
      search_fonts: "ê¸€ê¼´ ê²€ìƒ‰â€¦",
      tab_all: "ì „ì²´",
      section_height: "ìŠ¤í‹°ì¹˜ ë†’ì´",
      unit_px: "st",
      section_color: "ì‹¤ ìƒ‰ìƒ",
      section_fabric: "ì›ë‹¨",
      label_aida: "ì•„ì´ë‹¤",
      empty_state: "í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ë©´ íŒ¨í„´ì´ í‘œì‹œë©ë‹ˆë‹¤",
      loading_text: "ëž˜ìŠ¤í„°ë¼ì´ì¦ˆ ì¤‘â€¦",
      unit_cm: "cm",
      unit_stitches: "ìŠ¤í‹°ì¹˜",
      unit_crosses: "í¬ë¡œìŠ¤",
      toggle_controls: "ì»¨íŠ¸ë¡¤ í‘œì‹œ",
      no_fonts: "ì‚¬ìš© ê°€ëŠ¥í•œ ê¸€ê¼´ì´ ì—†ìŠµë‹ˆë‹¤",
      no_matching: "ì¼ì¹˜í•˜ëŠ” ê¸€ê¼´ì´ ì—†ìŠµë‹ˆë‹¤",
      server_error: "ê¸€ê¼´ ë¡œë“œ ì‹¤íŒ¨. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.",
      alert_no_text: "í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•˜ê³  ê¸€ê¼´ì„ ì„ íƒí•˜ì„¸ìš”.",
      alert_no_pdf: "PDF ì—”ì§„ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.",
      alert_no_jspdf: "jsPDFê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì—°ê²°ì„ í™•ì¸í•˜ê³  ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.",
      alert_pdf_fail: "PDF ìƒì„± ì‹¤íŒ¨: ",
      pdf_alert_no_text: "í…ìŠ¤íŠ¸ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.",
      pdf_alert_no_font: "ê¸€ê¼´ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
      pdf_alert_no_color: "ìƒ‰ìƒì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
      pdf_alert_no_render: "íŒ¨í„´ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
      label_custom: "ì‚¬ìš©ìž ì •ì˜",
      label_stitch_length: "ìŠ¤í‹°ì¹˜ ê¸¸ì´",
      sheet_fabric: "ì›ë‹¨ê³¼ ìŠ¤í‹°ì¹˜",
      sheet_info: "íŒ¨í„´ ì •ë³´",
      label_dmc: "DMC",
      label_thread: "ì‹¤",
      label_language: "ì–¸ì–´",
      pdf_thread_legend: "ì‹¤ ë²”ë¡€",
      pdf_pattern_info: "íŒ¨í„´ ì •ë³´",
      pdf_col_symbol: "ê¸°í˜¸",
      pdf_col_swatch: "ê²¬ë³¸",
      pdf_col_dmc_code: "DMC ì½”ë“œ",
      pdf_col_color_name: "ìƒ‰ìƒëª…",
      pdf_col_stitches: "ìŠ¤í‹°ì¹˜",
      pdf_col_thread: "ì‹¤",
      pdf_col_skeins: "íƒ€ëž˜",
      pdf_note_strands: "ì‹­ìžìˆ˜ì— DMC ì‹¤ 2ê°€ë‹¥ ì‚¬ìš©",
      pdf_note_center: "ìµœìƒì˜ ê²°ê³¼ë¥¼ ìœ„í•´ ì²œì˜ ì¤‘ì•™ë¶€í„° ì‹œìž‘í•˜ì„¸ìš”",
      pdf_note_print: "\u26a0 1:1 í¬ê¸°ë¡œ 100% ì¸ì‡„í•˜ì„¸ìš” (íŽ˜ì´ì§€ì— ë§žì¶”ê¸° ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”)",
      pdf_finished_size: "ì™„ì„± í¬ê¸°",
      pdf_cut_fabric: "ì²œ ìžë¥´ê¸°",
      pdf_cut_margin_imperial: '(ê° ë©´ +3" ì—¬ìœ ë¶„)',
      pdf_cut_margin_metric: "(ê° ë©´ +7.6 cm ì—¬ìœ ë¶„)",
      pdf_orient_portrait: "ì„¸ë¡œ",
      pdf_orient_landscape: "ê°€ë¡œ",
      pdf_btn_download: "PDF ë‹¤ìš´ë¡œë“œ",
      pdf_btn_print: "ì¸ì‡„",
      pdf_print_preview: "ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸°",
      pdf_scale_verify: "í™•ì¸: ìžë¡œ ì´ ë§‰ëŒ€ë¥¼ ì¸¡ì •í•˜ì„¸ìš”. ì •í™•ížˆ 10 mmì—¬ì•¼ í•©ë‹ˆë‹¤.",
      pdf_info_finished_size: "ì™„ì„± í¬ê¸°",
      pdf_info_thread_required: "í•„ìš”í•œ ì‹¤",
      pdf_info_fabric_aida: "ì²œ: Aida",
      pdf_info_each_stitch: "ê° ìŠ¤í‹°ì¹˜",
      pdf_info_pattern_size: "íŒ¨í„´ í¬ê¸°",
      pdf_info_total_crosses: "ì´ ì‹­ìžìˆ˜",
      pdf_footer_tagline: "ì‹­ìžìˆ˜ íŒ¨í„´ ìƒì„±ê¸°",
      pdf_unit_stitches: "ìŠ¤í‹°ì¹˜",
      pdf_unit_pages: "íŽ˜ì´ì§€",
      pdf_unit_crosses: "ì‹­ìžìˆ˜",
      pdf_unit_skein: "íƒ€ëž˜",
      pdf_unit_skeins: "íƒ€ëž˜"
    },
    zh: {
      placeholder_text: "åœ¨æ­¤è¾“å…¥æ–‡å­—â€¦",
      section_font: "å­—ä½“",
      search_fonts: "æœç´¢å­—ä½“â€¦",
      tab_all: "å…¨éƒ¨",
      section_height: "é’ˆé«˜",
      unit_px: "st",
      section_color: "çº¿è‰²",
      section_fabric: "å¸ƒæ–™",
      label_aida: "Aida",
      empty_state: "è¾“å…¥æ–‡å­—ä»¥æŸ¥çœ‹å›¾æ¡ˆ",
      loading_text: "æ­£åœ¨æ …æ ¼åŒ–â€¦",
      unit_cm: "åŽ˜ç±³",
      unit_stitches: "é’ˆ",
      unit_crosses: "åå­—",
      toggle_controls: "æ˜¾ç¤ºæŽ§ä»¶",
      no_fonts: "æ²¡æœ‰å¯ç”¨å­—ä½“",
      no_matching: "æ²¡æœ‰åŒ¹é…çš„å­—ä½“",
      server_error: "å­—ä½“åŠ è½½å¤±è´¥ã€‚æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ",
      alert_no_text: "è¯·è¾“å…¥æ–‡å­—å¹¶é€‰æ‹©å­—ä½“ã€‚",
      alert_no_pdf: "PDFå¼•æ“ŽæœªåŠ è½½ã€‚è¯·åˆ·æ–°é¡µé¢ã€‚",
      alert_no_jspdf: "jsPDFåº“æœªåŠ è½½ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥å¹¶åˆ·æ–°ã€‚",
      alert_pdf_fail: "PDFç”Ÿæˆå¤±è´¥: ",
      pdf_alert_no_text: "è¯·è¾“å…¥æ–‡æœ¬ã€‚",
      pdf_alert_no_font: "æœªé€‰æ‹©å­—ä½“ã€‚",
      pdf_alert_no_color: "æœªé€‰æ‹©é¢œè‰²ã€‚",
      pdf_alert_no_render: "æ— æ³•ç”Ÿæˆå›¾æ¡ˆã€‚",
      label_custom: "è‡ªå®šä¹‰",
      label_stitch_length: "é’ˆè·é•¿åº¦",
      sheet_fabric: "å¸ƒæ–™ä¸Žé’ˆæ³•",
      sheet_info: "å›¾æ¡ˆä¿¡æ¯",
      label_dmc: "DMC",
      label_thread: "çº¿",
      label_language: "è¯­è¨€",
      pdf_thread_legend: "çº¿æå›¾ä¾‹",
      pdf_pattern_info: "å›¾æ¡ˆä¿¡æ¯",
      pdf_col_symbol: "ç¬¦å·",
      pdf_col_swatch: "è‰²æ ·",
      pdf_col_dmc_code: "DMCç¼–å·",
      pdf_col_color_name: "é¢œè‰²",
      pdf_col_stitches: "é’ˆæ•°",
      pdf_col_thread: "çº¿",
      pdf_col_skeins: "ç»ž",
      pdf_note_strands: "åå­—ç»£ä½¿ç”¨2è‚¡DMCç»£çº¿",
      pdf_note_center: "ä»Žå¸ƒæ–™ä¸­å¿ƒå¼€å§‹ä»¥èŽ·å¾—æœ€ä½³æ•ˆæžœ",
      pdf_note_print: "\u26a0 ä»¥100%æ¯”ä¾‹æ‰“å°ï¼ˆä¸è¦é€‚åº”é¡µé¢ï¼‰ä»¥èŽ·å¾—1:1é’ˆè·",
      pdf_finished_size: "æˆå“å°ºå¯¸",
      pdf_cut_fabric: "è£å¸ƒå°ºå¯¸",
      pdf_cut_margin_imperial: '(æ¯è¾¹+3"ä½™é‡)',
      pdf_cut_margin_metric: "(æ¯è¾¹+7.6åŽ˜ç±³ä½™é‡)",
      pdf_orient_portrait: "çºµå‘",
      pdf_orient_landscape: "æ¨ªå‘",
      pdf_btn_download: "ä¸‹è½½PDF",
      pdf_btn_print: "æ‰“å°",
      pdf_print_preview: "æ‰“å°é¢„è§ˆ",
      pdf_scale_verify: "éªŒè¯ï¼šç”¨å°ºå­æµ‹é‡æ­¤æ¡ã€‚å¿…é¡»æ°å¥½ä¸º10æ¯«ç±³ã€‚",
      pdf_info_finished_size: "æˆå“å°ºå¯¸",
      pdf_info_thread_required: "æ‰€éœ€çº¿é‡",
      pdf_info_fabric_aida: "å¸ƒæ–™: Aida",
      pdf_info_each_stitch: "æ¯é’ˆ",
      pdf_info_pattern_size: "å›¾æ¡ˆå°ºå¯¸",
      pdf_info_total_crosses: "åå­—ç»£æ€»æ•°",
      pdf_footer_tagline: "åå­—ç»£å›¾æ¡ˆç”Ÿæˆå™¨",
      pdf_unit_stitches: "é’ˆ",
      pdf_unit_pages: "é¡µ",
      pdf_unit_crosses: "åå­—",
      pdf_unit_skein: "ç»ž",
      pdf_unit_skeins: "ç»ž"
    },
    ru: {
      placeholder_text: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚â€¦",
      section_font: "Ð¨Ñ€Ð¸Ñ„Ñ‚",
      search_fonts: "ÐŸÐ¾Ð¸ÑÐº ÑˆÑ€Ð¸Ñ„Ñ‚Ð¾Ð²â€¦",
      tab_all: "Ð’ÑÐµ",
      section_height: "Ð’Ñ‹ÑÐ¾Ñ‚Ð° ÑÑ‚ÐµÐ¶ÐºÐ°",
      unit_px: "st",
      section_color: "Ð¦Ð²ÐµÑ‚ Ð½Ð¸Ñ‚Ð¸",
      section_fabric: "Ð¢ÐºÐ°Ð½ÑŒ",
      label_aida: "ÐÐ¸Ð´Ð°",
      empty_state: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ ÑƒÐ·Ð¾Ñ€",
      loading_text: "Ð Ð°ÑÑ‚ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸Ñâ€¦",
      unit_cm: "ÑÐ¼",
      unit_stitches: "ÑÑ‚ÐµÐ¶ÐºÐ¾Ð²",
      unit_crosses: "ÐºÑ€ÐµÑÑ‚Ð¾Ð²",
      toggle_controls: "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ",
      no_fonts: "ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÑˆÑ€Ð¸Ñ„Ñ‚Ð¾Ð²",
      no_matching: "Ð¨Ñ€Ð¸Ñ„Ñ‚Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹",
      server_error: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑˆÑ€Ð¸Ñ„Ñ‚Ñ‹. Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½?",
      alert_no_text: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚ Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑˆÑ€Ð¸Ñ„Ñ‚.",
      alert_no_pdf: "PDF-Ð´Ð²Ð¸Ð¶Ð¾Ðº Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½. ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ.",
      alert_no_jspdf: "Ð‘Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° jsPDF Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ.",
      alert_pdf_fail: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ PDF: ",
      pdf_alert_no_text: "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚.",
      pdf_alert_no_font: "Ð¨Ñ€Ð¸Ñ„Ñ‚ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½.",
      pdf_alert_no_color: "Ð¦Ð²ÐµÑ‚ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½.",
      pdf_alert_no_render: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ…ÐµÐ¼Ñƒ.",
      label_custom: "Ð¡Ð²Ð¾Ð¹",
      label_stitch_length: "Ð”Ð»Ð¸Ð½Ð° ÑÑ‚ÐµÐ¶ÐºÐ°",
      sheet_fabric: "Ð¢ÐºÐ°Ð½ÑŒ Ð¸ Ð¡Ñ‚ÐµÐ¶Ð¾Ðº",
      sheet_info: "Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ",
      label_dmc: "DMC",
      label_thread: "ÐÐ¸Ñ‚ÑŒ",
      label_language: "Ð¯Ð·Ñ‹Ðº",
      pdf_thread_legend: "Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð½Ð¸Ñ‚Ð¾Ðº",
      pdf_pattern_info: "Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÑÑ…ÐµÐ¼Ðµ",
      pdf_col_symbol: "Ð¡Ð¸Ð¼Ð²Ð¾Ð»",
      pdf_col_swatch: "ÐžÐ±Ñ€Ð°Ð·ÐµÑ†",
      pdf_col_dmc_code: "ÐšÐ¾Ð´ DMC",
      pdf_col_color_name: "Ð¦Ð²ÐµÑ‚",
      pdf_col_stitches: "Ð¡Ñ‚ÐµÐ¶ÐºÐ¸",
      pdf_col_thread: "ÐÐ¸Ñ‚ÑŒ",
      pdf_col_skeins: "ÐœÐ¾Ñ‚ÐºÐ¸",
      pdf_note_strands: "Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ 2 Ð½Ð¸Ñ‚Ð¸ Ð¼ÑƒÐ»Ð¸Ð½Ðµ DMC Ð´Ð»Ñ ÐºÑ€ÐµÑÑ‚Ð¸ÐºÐ¾Ð²",
      pdf_note_center: "ÐÐ°Ñ‡Ð¸Ð½Ð°Ð¹Ñ‚Ðµ Ñ Ñ†ÐµÐ½Ñ‚Ñ€Ð° Ñ‚ÐºÐ°Ð½Ð¸ Ð´Ð»Ñ Ð»ÑƒÑ‡ÑˆÐµÐ³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°",
      pdf_note_print: "\u26a0 ÐŸÐµÑ‡Ð°Ñ‚Ð°Ð¹Ñ‚Ðµ Ð² Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ðµ 100% (Ð±ÐµÐ· Ð¿Ð¾Ð´Ð³Ð¾Ð½ÐºÐ¸) Ð´Ð»Ñ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° 1:1",
      pdf_finished_size: "Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€",
      pdf_cut_fabric: "Ð Ð°Ð·Ð¼ÐµÑ€ Ñ‚ÐºÐ°Ð½Ð¸",
      pdf_cut_margin_imperial: '(+3" Ð·Ð°Ð¿Ð°Ñ Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹)',
      pdf_cut_margin_metric: "(+7,6 ÑÐ¼ Ð·Ð°Ð¿Ð°Ñ Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹)",
      pdf_orient_portrait: "ÐšÐ½Ð¸Ð¶Ð½Ð°Ñ",
      pdf_orient_landscape: "ÐÐ»ÑŒÐ±Ð¾Ð¼Ð½Ð°Ñ",
      pdf_btn_download: "Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ PDF",
      pdf_btn_print: "ÐŸÐµÑ‡Ð°Ñ‚ÑŒ",
      pdf_print_preview: "ÐŸÑ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€",
      pdf_scale_verify: "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°: Ð¸Ð·Ð¼ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ñƒ Ð¿Ð¾Ð»Ð¾ÑÐºÑƒ Ð»Ð¸Ð½ÐµÐ¹ÐºÐ¾Ð¹. Ð”Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð¾Ð²Ð½Ð¾ 10 Ð¼Ð¼.",
      pdf_info_finished_size: "Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€",
      pdf_info_thread_required: "ÐÐ¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ",
      pdf_info_fabric_aida: "Ð¢ÐºÐ°Ð½ÑŒ: Aida",
      pdf_info_each_stitch: "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑÑ‚ÐµÐ¶Ð¾Ðº",
      pdf_info_pattern_size: "Ð Ð°Ð·Ð¼ÐµÑ€ ÑÑ…ÐµÐ¼Ñ‹",
      pdf_info_total_crosses: "Ð’ÑÐµÐ³Ð¾ ÐºÑ€ÐµÑÑ‚Ð¸ÐºÐ¾Ð²",
      pdf_footer_tagline: "Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ ÑÑ…ÐµÐ¼ Ð´Ð»Ñ Ð²Ñ‹ÑˆÐ¸Ð²ÐºÐ¸ ÐºÑ€ÐµÑÑ‚Ð¾Ð¼",
      pdf_unit_stitches: "ÑÑ‚ÐµÐ¶ÐºÐ¾Ð²",
      pdf_unit_pages: "ÑÑ‚Ñ€.",
      pdf_unit_crosses: "ÐºÑ€ÐµÑÑ‚Ð¸ÐºÐ¾Ð²",
      pdf_unit_skein: "Ð¼Ð¾Ñ‚Ð¾Ðº",
      pdf_unit_skeins: "Ð¼Ð¾Ñ‚ÐºÐ¾Ð²"
    },
    pl: {
      placeholder_text: "Wpisz swÃ³j tekstâ€¦",
      section_font: "Czcionka",
      search_fonts: "Szukaj czcionekâ€¦",
      tab_all: "Wszystkie",
      section_height: "WysokoÅ›Ä‡ Åšciegu",
      unit_px: "st",
      section_color: "Kolor Nici",
      section_fabric: "Tkanina",
      label_aida: "Aida",
      empty_state: "Wpisz coÅ›, aby zobaczyÄ‡ wzÃ³r",
      loading_text: "Rasteryzacjaâ€¦",
      unit_cm: "cm",
      unit_stitches: "Å›ciegÃ³w",
      unit_crosses: "krzyÅ¼ykÃ³w",
      toggle_controls: "PokaÅ¼ panel",
      no_fonts: "Brak dostÄ™pnych czcionek",
      no_matching: "Nie znaleziono czcionek",
      server_error: "Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ czcionek. Czy serwer dziaÅ‚a?",
      alert_no_text: "Wpisz tekst i wybierz czcionkÄ™.",
      alert_no_pdf: "Silnik PDF nie zaÅ‚adowany. OdÅ›wieÅ¼ stronÄ™.",
      alert_no_jspdf: "Biblioteka jsPDF nie zaÅ‚adowana. SprawdÅº poÅ‚Ä…czenie i odÅ›wieÅ¼.",
      alert_pdf_fail: "BÅ‚Ä…d generowania PDF: ",
      pdf_alert_no_text: "ProszÄ™ wpisaÄ‡ tekst.",
      pdf_alert_no_font: "Nie wybrano czcionki.",
      pdf_alert_no_color: "Nie wybrano koloru.",
      pdf_alert_no_render: "Nie udaÅ‚o siÄ™ wygenerowaÄ‡ wzoru.",
      label_custom: "WÅ‚asny",
      label_stitch_length: "DÅ‚ugoÅ›Ä‡ Å›ciegu",
      sheet_fabric: "Tkanina i Åšcieg",
      sheet_info: "Info Wzoru",
      label_dmc: "DMC",
      label_thread: "Nici",
      label_language: "JÄ™zyk",
      pdf_thread_legend: "Legenda nici",
      pdf_pattern_info: "Informacje o wzorze",
      pdf_col_symbol: "Symbol",
      pdf_col_swatch: "PrÃ³bka",
      pdf_col_dmc_code: "Kod DMC",
      pdf_col_color_name: "Kolor",
      pdf_col_stitches: "Åšciegi",
      pdf_col_thread: "Nici",
      pdf_col_skeins: "Motki",
      pdf_note_strands: "UÅ¼yj 2 nitek mulin DMC do krzyÅ¼ykÃ³w",
      pdf_note_center: "Zacznij od Å›rodka tkaniny dla najlepszych rezultatÃ³w",
      pdf_note_print: "\u26a0 Drukuj w skali 100% (bez dopasowania) dla rozmiaru 1:1",
      pdf_finished_size: "Gotowy rozmiar",
      pdf_cut_fabric: "Rozmiar tkaniny",
      pdf_cut_margin_imperial: '(+3" marginesu z kaÅ¼dej strony)',
      pdf_cut_margin_metric: "(+7,6 cm marginesu z kaÅ¼dej strony)",
      pdf_orient_portrait: "Pionowo",
      pdf_orient_landscape: "Poziomo",
      pdf_btn_download: "Pobierz PDF",
      pdf_btn_print: "Drukuj",
      pdf_print_preview: "PodglÄ…d wydruku",
      pdf_scale_verify: "SprawdÅº: zmierz tÄ™ belkÄ™ linijkÄ…. Musi mieÄ‡ dokÅ‚adnie 10 mm.",
      pdf_info_finished_size: "Gotowy rozmiar",
      pdf_info_thread_required: "Potrzebna niÄ‡",
      pdf_info_fabric_aida: "Tkanina: Aida",
      pdf_info_each_stitch: "KaÅ¼dy Å›cieg",
      pdf_info_pattern_size: "Rozmiar wzoru",
      pdf_info_total_crosses: "ÅÄ…cznie krzyÅ¼ykÃ³w",
      pdf_footer_tagline: "Generator WzorÃ³w KrzyÅ¼ykowych",
      pdf_unit_stitches: "Å›ciegÃ³w",
      pdf_unit_pages: "stron",
      pdf_unit_crosses: "krzyÅ¼ykÃ³w",
      pdf_unit_skein: "motek",
      pdf_unit_skeins: "motkÃ³w"
    },
    sv: {
      placeholder_text: "Skriv din text hÃ¤râ€¦",
      section_font: "Typsnitt",
      search_fonts: "SÃ¶k typsnittâ€¦",
      tab_all: "Alla",
      section_height: "Stygnh\u00f6jd",
      unit_px: "st",
      section_color: "TrÃ¥dfÃ¤rg",
      section_fabric: "Tyg",
      label_aida: "Aida",
      empty_state: "Skriv nÃ¥got fÃ¶r att se ditt mÃ¶nster",
      loading_text: "Rastrerarâ€¦",
      unit_cm: "cm",
      unit_stitches: "stygn",
      unit_crosses: "kors",
      toggle_controls: "Visa kontroller",
      no_fonts: "Inga typsnitt tillgÃ¤ngliga",
      no_matching: "Inga matchande typsnitt",
      server_error: "Kunde inte ladda typsnitt. KÃ¶rs servern?",
      alert_no_text: "Skriv text och vÃ¤lj ett typsnitt fÃ¶rst.",
      alert_no_pdf: "PDF-motor inte laddad. Ladda om sidan.",
      alert_no_jspdf: "jsPDF inte laddat. Kontrollera din anslutning och ladda om.",
      alert_pdf_fail: "PDF-generering misslyckades: ",
      pdf_alert_no_text: "Ange en text.",
      pdf_alert_no_font: "Inget typsnitt valt.",
      pdf_alert_no_color: "Ingen fÃ¤rg vald.",
      pdf_alert_no_render: "Kunde inte generera mÃ¶nstret.",
      label_custom: "Anpassad",
      label_stitch_length: "StygnlÃ¤ngd",
      sheet_fabric: "Tyg och Stygn",
      sheet_info: "MÃ¶nsterinfo",
      label_dmc: "DMC",
      label_thread: "TrÃ¥d",
      label_language: "SprÃ¥k",
      pdf_thread_legend: "TrÃ¥dguide",
      pdf_pattern_info: "MÃ¶nsterinformation",
      pdf_col_symbol: "Symbol",
      pdf_col_swatch: "Prov",
      pdf_col_dmc_code: "DMC-kod",
      pdf_col_color_name: "FÃ¤rg",
      pdf_col_stitches: "Stygn",
      pdf_col_thread: "TrÃ¥d",
      pdf_col_skeins: "Dockor",
      pdf_note_strands: "AnvÃ¤nd 2 trÃ¥dar DMC-garn fÃ¶r korsstygn",
      pdf_note_center: "BÃ¶rja frÃ¥n mitten av tyget fÃ¶r bÃ¤sta resultat",
      pdf_note_print: "\u26a0 Skriv ut i 100% (inte anpassa till sida) fÃ¶r 1:1 stygnstorlek",
      pdf_finished_size: "FÃ¤rdig storlek",
      pdf_cut_fabric: "Klipp Tyg",
      pdf_cut_margin_imperial: '(+3" marginal pÃ¥ varje sida)',
      pdf_cut_margin_metric: "(+7,6 cm marginal pÃ¥ varje sida)",
      pdf_orient_portrait: "StÃ¥ende",
      pdf_orient_landscape: "Liggande",
      pdf_btn_download: "Ladda ner PDF",
      pdf_btn_print: "Skriv ut",
      pdf_print_preview: "FÃ¶rhandsgranskning",
      pdf_scale_verify: "Verifiera: mÃ¤t denna stapel med en linjal. MÃ¥ste vara exakt 10 mm.",
      pdf_info_finished_size: "FÃ¤rdig storlek",
      pdf_info_thread_required: "TrÃ¥d som behÃ¶vs",
      pdf_info_fabric_aida: "Tyg: Aida",
      pdf_info_each_stitch: "Varje stygn",
      pdf_info_pattern_size: "MÃ¶nsterstorlek",
      pdf_info_total_crosses: "Totalt korsstygn",
      pdf_footer_tagline: "KorsstygnsmÃ¶nstergenerator",
      pdf_unit_stitches: "stygn",
      pdf_unit_pages: "sidor",
      pdf_unit_crosses: "kors",
      pdf_unit_skein: "docka",
      pdf_unit_skeins: "dockor"
    },
    da: {
      placeholder_text: "Skriv din tekst herâ€¦",
      section_font: "Skrifttype",
      search_fonts: "SÃ¸g skrifttyperâ€¦",
      tab_all: "Alle",
      section_height: "StinghÃ¸jde",
      unit_px: "st",
      section_color: "TrÃ¥dfarve",
      section_fabric: "Stof",
      label_aida: "Aida",
      empty_state: "Skriv noget for at se dit mÃ¸nster",
      loading_text: "Rastrererâ€¦",
      unit_cm: "cm",
      unit_stitches: "sting",
      unit_crosses: "kors",
      toggle_controls: "Vis kontroller",
      no_fonts: "Ingen skrifttyper tilgÃ¦ngelige",
      no_matching: "Ingen matchende skrifttyper",
      server_error: "Kunne ikke indlÃ¦se skrifttyper. KÃ¸rer serveren?",
      alert_no_text: "Skriv tekst og vÃ¦lg en skrifttype fÃ¸rst.",
      alert_no_pdf: "PDF-motor ikke indlÃ¦st. GenindlÃ¦s siden.",
      alert_no_jspdf: "jsPDF ikke indlÃ¦st. KontrollÃ©r din forbindelse og genindlÃ¦s.",
      alert_pdf_fail: "PDF-generering mislykkedes: ",
      pdf_alert_no_text: "Indtast venligst en tekst.",
      pdf_alert_no_font: "Ingen skrifttype valgt.",
      pdf_alert_no_color: "Ingen farve valgt.",
      pdf_alert_no_render: "Kunne ikke generere mÃ¸nstret.",
      label_custom: "Brugerdefineret",
      label_stitch_length: "StinglÃ¦ngde",
      sheet_fabric: "Stof og Sting",
      sheet_info: "MÃ¸nsterinfo",
      label_dmc: "DMC",
      label_thread: "TrÃ¥d",
      label_language: "Sprog",
      pdf_thread_legend: "TrÃ¥doversigt",
      pdf_pattern_info: "MÃ¸nsterinformation",
      pdf_col_symbol: "Symbol",
      pdf_col_swatch: "PrÃ¸ve",
      pdf_col_dmc_code: "DMC-kode",
      pdf_col_color_name: "Farve",
      pdf_col_stitches: "Sting",
      pdf_col_thread: "TrÃ¥d",
      pdf_col_skeins: "NÃ¸gler",
      pdf_note_strands: "Brug 2 trÃ¥de DMC-garn til korssting",
      pdf_note_center: "Start fra midten af stoffet for bedste resultat",
      pdf_note_print: "\u26a0 Udskriv i 100% (ikke tilpas til side) for 1:1 stingstÃ¸rrelse",
      pdf_finished_size: "FÃ¦rdig stÃ¸rrelse",
      pdf_cut_fabric: "Klip Stof",
      pdf_cut_margin_imperial: '(+3" margen pÃ¥ hver side)',
      pdf_cut_margin_metric: "(+7,6 cm margen pÃ¥ hver side)",
      pdf_orient_portrait: "StÃ¥ende",
      pdf_orient_landscape: "Liggende",
      pdf_btn_download: "Download PDF",
      pdf_btn_print: "Udskriv",
      pdf_print_preview: "ForhÃ¥ndsvisning",
      pdf_scale_verify: "VerificÃ©r: mÃ¥l denne bjÃ¦lke med en lineal. Skal vÃ¦re prÃ¦cis 10 mm.",
      pdf_info_finished_size: "FÃ¦rdig stÃ¸rrelse",
      pdf_info_thread_required: "TrÃ¥d nÃ¸dvendig",
      pdf_info_fabric_aida: "Stof: Aida",
      pdf_info_each_stitch: "Hvert sting",
      pdf_info_pattern_size: "MÃ¸nsterstÃ¸rrelse",
      pdf_info_total_crosses: "Korssting i alt",
      pdf_footer_tagline: "KorsstingsmÃ¸nstergenerator",
      pdf_unit_stitches: "sting",
      pdf_unit_pages: "sider",
      pdf_unit_crosses: "kors",
      pdf_unit_skein: "nÃ¸gle",
      pdf_unit_skeins: "nÃ¸gler"
    },
    fi: {
      placeholder_text: "Kirjoita tekstisi tÃ¤hÃ¤nâ€¦",
      section_font: "Fontti",
      search_fonts: "Etsi fonttejaâ€¦",
      tab_all: "Kaikki",
      section_height: "Pistonkorkeus",
      unit_px: "st",
      section_color: "Langan VÃ¤ri",
      section_fabric: "Kangas",
      label_aida: "Aida",
      empty_state: "Kirjoita jotain nÃ¤hdÃ¤ksesi kuviosi",
      loading_text: "Rasteroidaanâ€¦",
      unit_cm: "cm",
      unit_stitches: "pistoa",
      unit_crosses: "ristiÃ¤",
      toggle_controls: "NÃ¤ytÃ¤ ohjaimet",
      no_fonts: "Ei fontteja saatavilla",
      no_matching: "Ei vastaavia fontteja",
      server_error: "Fonttien lataus epÃ¤onnistui. Onko palvelin kÃ¤ynnissÃ¤?",
      alert_no_text: "Kirjoita teksti ja valitse fontti ensin.",
      alert_no_pdf: "PDF-moottori ei latautunut. Lataa sivu uudelleen.",
      alert_no_jspdf: "jsPDF ei latautunut. Tarkista yhteys ja lataa uudelleen.",
      alert_pdf_fail: "PDF:n luonti epÃ¤onnistui: ",
      pdf_alert_no_text: "Kirjoita teksti.",
      pdf_alert_no_font: "Fonttia ei valittu.",
      pdf_alert_no_color: "VÃ¤riÃ¤ ei valittu.",
      pdf_alert_no_render: "Kuviota ei voitu luoda.",
      label_custom: "Mukautettu",
      label_stitch_length: "Pistonpituus",
      sheet_fabric: "Kangas ja Pisto",
      sheet_info: "Kuviotiedot",
      label_dmc: "DMC",
      label_thread: "Lanka",
      label_language: "Kieli",
      pdf_thread_legend: "Lankaopas",
      pdf_pattern_info: "Kuviotiedot",
      pdf_col_symbol: "Symboli",
      pdf_col_swatch: "NÃ¤yte",
      pdf_col_dmc_code: "DMC-koodi",
      pdf_col_color_name: "VÃ¤ri",
      pdf_col_stitches: "Pistot",
      pdf_col_thread: "Lanka",
      pdf_col_skeins: "Vyyhdit",
      pdf_note_strands: "KÃ¤ytÃ¤ 2 sÃ¤iettÃ¤ DMC-lankaa ristipistoon",
      pdf_note_center: "Aloita kankaan keskeltÃ¤ parhaan tuloksen saavuttamiseksi",
      pdf_note_print: "\u26a0 Tulosta 100% koossa (ei sovita sivulle) 1:1 pistokokoon saamiseksi",
      pdf_finished_size: "Valmis koko",
      pdf_cut_fabric: "Leikkaa Kangas",
      pdf_cut_margin_imperial: '(+3" marginaali joka puolella)',
      pdf_cut_margin_metric: "(+7,6 cm marginaali joka puolella)",
      pdf_orient_portrait: "Pysty",
      pdf_orient_landscape: "Vaaka",
      pdf_btn_download: "Lataa PDF",
      pdf_btn_print: "Tulosta",
      pdf_print_preview: "Esikatselu",
      pdf_scale_verify: "Tarkista: mittaa tÃ¤mÃ¤ palkki viivaimella. Sen on oltava tarkalleen 10 mm.",
      pdf_info_finished_size: "Valmis koko",
      pdf_info_thread_required: "Lankaa tarvitaan",
      pdf_info_fabric_aida: "Kangas: Aida",
      pdf_info_each_stitch: "Jokainen pisto",
      pdf_info_pattern_size: "Kuvion koko",
      pdf_info_total_crosses: "Ristipistoja yhteensÃ¤",
      pdf_footer_tagline: "Ristipistokaavageneraattori",
      pdf_unit_stitches: "pistoa",
      pdf_unit_pages: "sivua",
      pdf_unit_crosses: "ristiÃ¤",
      pdf_unit_skein: "vyyhti",
      pdf_unit_skeins: "vyyhtiÃ¤"
    },
    uk: {
      placeholder_text: "Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚â€¦",
      section_font: "Ð¨Ñ€Ð¸Ñ„Ñ‚",
      search_fonts: "ÐŸÐ¾ÑˆÑƒÐº ÑˆÑ€Ð¸Ñ„Ñ‚Ñ–Ð²â€¦",
      tab_all: "Ð£ÑÑ–",
      section_height: "Ð’Ð¸ÑÐ¾Ñ‚Ð° ÑÑ‚Ñ–Ð±ÐºÐ°",
      unit_px: "st",
      section_color: "ÐšÐ¾Ð»Ñ–Ñ€ Ð½Ð¸Ñ‚ÐºÐ¸",
      section_fabric: "Ð¢ÐºÐ°Ð½Ð¸Ð½Ð°",
      label_aida: "ÐÑ—Ð´Ð°",
      empty_state: "Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð²Ñ–Ð·ÐµÑ€ÑƒÐ½Ð¾Ðº",
      loading_text: "Ð Ð°ÑÑ‚ÐµÑ€Ð¸Ð·Ð°Ñ†Ñ–Ñâ€¦",
      unit_cm: "ÑÐ¼",
      unit_stitches: "ÑÑ‚Ñ–Ð±ÐºÑ–Ð²",
      unit_crosses: "Ñ…Ñ€ÐµÑÑ‚Ð¸ÐºÑ–Ð²",
      toggle_controls: "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð¿Ð°Ð½ÐµÐ»ÑŒ",
      no_fonts: "ÐÐµÐ¼Ð°Ñ” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… ÑˆÑ€Ð¸Ñ„Ñ‚Ñ–Ð²",
      no_matching: "Ð¨Ñ€Ð¸Ñ„Ñ‚Ð¸ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",
      server_error: "ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ ÑˆÑ€Ð¸Ñ„Ñ‚Ð¸. Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾?",
      alert_no_text: "Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚ Ñ– Ð²Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑˆÑ€Ð¸Ñ„Ñ‚.",
      alert_no_pdf: "PDF-Ñ€ÑƒÑˆÑ–Ð¹ Ð½Ðµ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð¾. ÐŸÐµÑ€ÐµÐ·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ñ‚Ðµ ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ.",
      alert_no_jspdf: "Ð‘Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÑƒ jsPDF Ð½Ðµ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð¾. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ñ‚Ðµ Ð·'Ñ”Ð´Ð½Ð°Ð½Ð½Ñ Ñ– Ð¿ÐµÑ€ÐµÐ·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ñ‚Ðµ.",
      alert_pdf_fail: "ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ— PDF: ",
      pdf_alert_no_text: "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð²Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚.",
      pdf_alert_no_font: "Ð¨Ñ€Ð¸Ñ„Ñ‚ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾.",
      pdf_alert_no_color: "ÐšÐ¾Ð»Ñ–Ñ€ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾.",
      pdf_alert_no_render: "ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ ÑÑ…ÐµÐ¼Ñƒ.",
      label_custom: "Ð’Ð»Ð°ÑÐ½Ð¸Ð¹",
      label_stitch_length: "Ð”Ð¾Ð²Ð¶Ð¸Ð½Ð° ÑÑ‚Ñ–Ð±ÐºÐ°",
      sheet_fabric: "Ð¢ÐºÐ°Ð½Ð¸Ð½Ð° Ñ– Ð¡Ñ‚Ñ–Ð±Ð¾Ðº",
      sheet_info: "Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ",
      label_dmc: "DMC",
      label_thread: "ÐÐ¸Ñ‚ÐºÐ°",
      label_language: "ÐœÐ¾Ð²Ð°",
      pdf_thread_legend: "Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ Ð½Ð¸Ñ‚Ð¾Ðº",
      pdf_pattern_info: "Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ñ€Ð¾ ÑÑ…ÐµÐ¼Ñƒ",
      pdf_col_symbol: "Ð¡Ð¸Ð¼Ð²Ð¾Ð»",
      pdf_col_swatch: "Ð—Ñ€Ð°Ð·Ð¾Ðº",
      pdf_col_dmc_code: "ÐšÐ¾Ð´ DMC",
      pdf_col_color_name: "ÐšÐ¾Ð»Ñ–Ñ€",
      pdf_col_stitches: "Ð¡Ñ‚Ñ–Ð±ÐºÐ¸",
      pdf_col_thread: "ÐÐ¸Ñ‚ÐºÐ°",
      pdf_col_skeins: "ÐœÐ¾Ñ‚ÐºÐ¸",
      pdf_note_strands: "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ 2 Ð½Ð¸Ñ‚ÐºÐ¸ Ð¼ÑƒÐ»Ñ–Ð½Ðµ DMC Ð´Ð»Ñ Ñ…Ñ€ÐµÑÑ‚Ð¸ÐºÑ–Ð²",
      pdf_note_center: "ÐŸÐ¾Ñ‡Ð¸Ð½Ð°Ð¹Ñ‚Ðµ Ð· Ñ†ÐµÐ½Ñ‚Ñ€Ñƒ Ñ‚ÐºÐ°Ð½Ð¸Ð½Ð¸ Ð´Ð»Ñ ÐºÑ€Ð°Ñ‰Ð¾Ð³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñƒ",
      pdf_note_print: "\u26a0 Ð”Ñ€ÑƒÐºÑƒÐ¹Ñ‚Ðµ Ð² Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ñ– 100% (Ð±ÐµÐ· Ð¿Ñ–Ð´Ð³Ð¾Ð½ÐºÐ¸) Ð´Ð»Ñ Ñ€Ð¾Ð·Ð¼Ñ–Ñ€Ñƒ 1:1",
      pdf_finished_size: "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ñ€Ð¾Ð·Ð¼Ñ–Ñ€",
      pdf_cut_fabric: "Ð Ð¾Ð·Ð¼Ñ–Ñ€ Ñ‚ÐºÐ°Ð½Ð¸Ð½Ð¸",
      pdf_cut_margin_imperial: '(+3" Ð·Ð°Ð¿Ð°Ñ Ð· ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ Ð±Ð¾ÐºÑƒ)',
      pdf_cut_margin_metric: "(+7,6 ÑÐ¼ Ð·Ð°Ð¿Ð°Ñ Ð· ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ Ð±Ð¾ÐºÑƒ)",
      pdf_orient_portrait: "ÐšÐ½Ð¸Ð¶ÐºÐ¾Ð²Ð°",
      pdf_orient_landscape: "ÐÐ»ÑŒÐ±Ð¾Ð¼Ð½Ð°",
      pdf_btn_download: "Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ PDF",
      pdf_btn_print: "Ð”Ñ€ÑƒÐº",
      pdf_print_preview: "ÐŸÐ¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ–Ð¹ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´",
      pdf_scale_verify: "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ°: Ð²Ð¸Ð¼Ñ–Ñ€ÑÐ¹Ñ‚Ðµ Ñ†ÑŽ ÑÐ¼ÑƒÐ¶ÐºÑƒ Ð»Ñ–Ð½Ñ–Ð¹ÐºÐ¾ÑŽ. ÐœÐ°Ñ” Ð±ÑƒÑ‚Ð¸ Ñ€Ñ–Ð²Ð½Ð¾ 10 Ð¼Ð¼.",
      pdf_info_finished_size: "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ñ€Ð¾Ð·Ð¼Ñ–Ñ€",
      pdf_info_thread_required: "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð½Ð¸Ñ‚ÐºÐ°",
      pdf_info_fabric_aida: "Ð¢ÐºÐ°Ð½Ð¸Ð½Ð°: Aida",
      pdf_info_each_stitch: "ÐšÐ¾Ð¶ÐµÐ½ ÑÑ‚Ñ–Ð±Ð¾Ðº",
      pdf_info_pattern_size: "Ð Ð¾Ð·Ð¼Ñ–Ñ€ ÑÑ…ÐµÐ¼Ð¸",
      pdf_info_total_crosses: "Ð’ÑÑŒÐ¾Ð³Ð¾ Ñ…Ñ€ÐµÑÑ‚Ð¸ÐºÑ–Ð²",
      pdf_footer_tagline: "Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ ÑÑ…ÐµÐ¼ Ð´Ð»Ñ Ð²Ð¸ÑˆÐ¸Ð²ÐºÐ¸ Ñ…Ñ€ÐµÑÑ‚Ð¸ÐºÐ¾Ð¼",
      pdf_unit_stitches: "ÑÑ‚Ñ–Ð±ÐºÑ–Ð²",
      pdf_unit_pages: "ÑÑ‚Ð¾Ñ€.",
      pdf_unit_crosses: "Ñ…Ñ€ÐµÑÑ‚Ð¸ÐºÑ–Ð²",
      pdf_unit_skein: "Ð¼Ð¾Ñ‚Ð¾Ðº",
      pdf_unit_skeins: "Ð¼Ð¾Ñ‚ÐºÑ–Ð²"
    },
    hu: {
      placeholder_text: "Ãrd be a szÃ¶vegedâ€¦",
      section_font: "BetÅ±tÃ­pus",
      search_fonts: "BetÅ±tÃ­pusok keresÃ©seâ€¦",
      tab_all: "Ã–sszes",
      section_height: "Ã–ltÃ©smagassÃ¡g",
      unit_px: "st",
      section_color: "FonalszÃ­n",
      section_fabric: "SzÃ¶vet",
      label_aida: "Aida",
      empty_state: "Ãrj valamit a minta megtekintÃ©sÃ©hez",
      loading_text: "RaszterizÃ¡lÃ¡sâ€¦",
      unit_cm: "cm",
      unit_stitches: "Ã¶ltÃ©s",
      unit_crosses: "kereszt",
      toggle_controls: "VezÃ©rlÅ‘k mutatÃ¡sa",
      no_fonts: "Nincs elÃ©rhetÅ‘ betÅ±tÃ­pus",
      no_matching: "Nincs egyezÅ‘ betÅ±tÃ­pus",
      server_error: "BetÅ±tÃ­pusok betÃ¶ltÃ©se sikertelen. Fut a szerver?",
      alert_no_text: "Ãrj szÃ¶veget Ã©s vÃ¡lassz betÅ±tÃ­pust.",
      alert_no_pdf: "PDF-motor nincs betÃ¶ltve. TÃ¶ltsd Ãºjra az oldalt.",
      alert_no_jspdf: "jsPDF nincs betÃ¶ltve. EllenÅ‘rizd a kapcsolatot Ã©s tÃ¶ltsd Ãºjra.",
      alert_pdf_fail: "PDF lÃ©trehozÃ¡s sikertelen: ",
      pdf_alert_no_text: "KÃ©rjÃ¼k, Ã­rjon be szÃ¶veget.",
      pdf_alert_no_font: "Nincs betÅ±tÃ­pus kivÃ¡lasztva.",
      pdf_alert_no_color: "Nincs szÃ­n kivÃ¡lasztva.",
      pdf_alert_no_render: "A minta nem hozhatÃ³ lÃ©tre.",
      label_custom: "EgyÃ©ni",
      label_stitch_length: "Ã–ltÃ©shossz",
      sheet_fabric: "SzÃ¶vet Ã©s Ã–ltÃ©s",
      sheet_info: "Minta Info",
      label_dmc: "DMC",
      label_thread: "Fonal",
      label_language: "Nyelv",
      pdf_thread_legend: "FonalÃºtmutatÃ³",
      pdf_pattern_info: "Minta InformÃ¡ciÃ³",
      pdf_col_symbol: "SzimbÃ³lum",
      pdf_col_swatch: "Minta",
      pdf_col_dmc_code: "DMC kÃ³d",
      pdf_col_color_name: "SzÃ­n",
      pdf_col_stitches: "Ã–ltÃ©sek",
      pdf_col_thread: "Fonal",
      pdf_col_skeins: "PÃ¡szmÃ¡k",
      pdf_note_strands: "HasznÃ¡ljon 2 szÃ¡l DMC fonalat a keresztszemes Ã¶ltÃ©sekhez",
      pdf_note_center: "A legjobb eredmÃ©nyÃ©rt a szÃ¶vet kÃ¶zepÃ©rÅ‘l induljon",
      pdf_note_print: "\u26a0 100%-os mÃ©retben nyomtasson (ne illeszsze oldalhoz) az 1:1 Ã¶ltÃ©smÃ©retÃ©rt",
      pdf_finished_size: "KÃ©sz mÃ©ret",
      pdf_cut_fabric: "SzÃ¶vet VÃ¡gÃ¡s",
      pdf_cut_margin_imperial: '(+3" margÃ³ minden oldalon)',
      pdf_cut_margin_metric: "(+7,6 cm margÃ³ minden oldalon)",
      pdf_orient_portrait: "ÃllÃ³",
      pdf_orient_landscape: "FekvÅ‘",
      pdf_btn_download: "PDF LetÃ¶ltÃ©s",
      pdf_btn_print: "NyomtatÃ¡s",
      pdf_print_preview: "NyomtatÃ¡si elÅ‘nÃ©zet",
      pdf_scale_verify: "EllenÅ‘rizze: mÃ©rje meg ezt a csÃ­kot vonalzÃ³val. Pontosan 10 mm-nek kell lennie.",
      pdf_info_finished_size: "KÃ©sz mÃ©ret",
      pdf_info_thread_required: "SzÃ¼ksÃ©ges fonal",
      pdf_info_fabric_aida: "SzÃ¶vet: Aida",
      pdf_info_each_stitch: "Minden Ã¶ltÃ©s",
      pdf_info_pattern_size: "Minta mÃ©rete",
      pdf_info_total_crosses: "Ã–sszes keresztÃ¶ltÃ©s",
      pdf_footer_tagline: "Keresztszemes MintakÃ©szÃ­tÅ‘",
      pdf_unit_stitches: "Ã¶ltÃ©s",
      pdf_unit_pages: "oldal",
      pdf_unit_crosses: "kereszt",
      pdf_unit_skein: "pÃ¡szma",
      pdf_unit_skeins: "pÃ¡szmÃ¡k"
    }
  };

</script>

<!-- â•â•â• UI Application Logic â•â•â• -->
<script>
(function () {
  'use strict';

// ui-modules/i18n.js â€” I18N functions (t, applyLang, setLanguage)

  // I18N data loaded from i18n-data.js

  var currentLang = 'en';

  function t(key) {
    var lang = I18N[currentLang] || I18N.en;
    return lang[key] || I18N.en[key] || key;
  }

  function applyLang() {
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
      el.textContent = t(el.dataset.i18n);
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el) {
      el.placeholder = t(el.dataset.i18nPlaceholder);
    });
    document.querySelectorAll('[data-i18n-aria]').forEach(function(el) {
      el.setAttribute('aria-label', t(el.dataset.i18nAria));
    });
    document.title = 'Word2Stitch â€” ' + t('empty_state').split(' ').slice(0, 4).join(' ');
  }

  function setLanguage(lang) {
    if (!I18N[lang]) lang = 'en';
    currentLang = lang;
    document.documentElement.lang = lang;
    try { localStorage.setItem('w2s_lang', lang); } catch(e) {}
    var sel = document.getElementById('langSelect');
    if (sel) sel.value = lang;
    applyLang();
    if (typeof renderFontListUI === 'function') renderFontListUI();
  }


// ui-modules/state.js â€” State variables, DOM refs, and helpers

  // -- State --
  var currentText = 'Welcome';
  var currentFontFile = 'GeorgiaPro-Bold.ttf';
  var currentFontName = 'GeorgiaPro-Bold';
  var currentHeight = 16;
  var currentColorCode = '310'; // DMC code (robust with 449 colors)
  var currentAida = 14;
  var currentCategoryFilter = 'all';
  var displayUnit = 'metric'; // 'metric' | 'imperial'
  var currentAlign = 'center'; // 'left' | 'center' | 'right'

  // -- Unit detection & formatting --

  function detectDefaultUnit() {
    var lang = navigator.language || '';
    var parts = lang.split('-');
    var country = (parts[1] || '').toUpperCase();
    // US, Liberia (LR), Myanmar (MM) use imperial
    if (country === 'US' || country === 'LR' || country === 'MM') return 'imperial';
    // Fallback: if just 'en' without country, assume metric (UK, AU, etc.)
    return 'metric';
  }

  function formatSize(wStitches, hStitches, aida) {
    var inW = (wStitches / aida).toFixed(1);
    var inH = (hStitches / aida).toFixed(1);
    var cmW = (wStitches / aida * 2.54).toFixed(1);
    var cmH = (hStitches / aida * 2.54).toFixed(1);
    if (displayUnit === 'imperial') {
      return { value: inW + ' \u00d7 ' + inH, unit: 'in', width: inW + ' in', height: inH + ' in' };
    }
    return { value: cmW + ' \u00d7 ' + cmH, unit: 'cm', width: cmW + ' cm', height: cmH + ' cm' };
  }

  function formatThread(stitches, aida) {
    var metersPerStitch = 0.013 * (14 / aida);
    var totalMeters = stitches * metersPerStitch;
    if (displayUnit === 'imperial') {
      var yards = (totalMeters * 1.09361).toFixed(1);
      return yards + '\u00a0yd';
    }
    return totalMeters.toFixed(1) + '\u00a0m';
  }

  function setDisplayUnit(unit) {
    displayUnit = (unit === 'imperial') ? 'imperial' : 'metric';
    try { localStorage.setItem('w2s_unit', displayUnit); } catch(e) {}
    // Sync toggle buttons
    var toggle = document.getElementById('unitToggle');
    if (toggle) {
      toggle.querySelectorAll('.unit-toggle-btn').forEach(function(b) {
        b.classList.toggle('active', b.dataset.unit === displayUnit);
      });
    }
    // Refresh custom stitch labels if visible
    if (isCustomAida) {
      updateCustomStitch(currentStitchMm, 'unit');
    }
    updatePreview();
  }

  var categoryLabels = {
    'serif': 'Serif', 'sans-serif': 'Sans', 'script': 'Script',
    'decorative': 'Decorative', 'monospace': 'Mono', 'other': 'Other'
  };

  // Font list from API: [{file, name, size, category}, ...]
  var fontListData = [];

  // Client-side cache: Map<string, fontJSON>
  // Key format: "filename.ttf_height"
  var fontCache = new Map();

  // In-flight request deduplication: Map<cacheKey, Promise>
  var inFlightRequests = new Map();

  // AbortControllers for preview requests: Map<cacheKey, AbortController>
  var previewAbortControllers = new Map();

  // Currently loaded font data (from cache or API)
  var currentFontData = null;

  // -- DOM refs --
  var textInput = document.getElementById('textInput');
  var fontList = document.getElementById('fontList');
  var fontSearch = document.getElementById('fontSearch');
  var heightSlider = document.getElementById('heightSlider');
  var heightValue = document.getElementById('heightValue');
  var colorRow = document.getElementById('colorRow');
  var aidaRow = document.getElementById('aidaRow');
  var btnDownload = document.getElementById('btnDownload');
  var previewEmpty = document.getElementById('previewEmpty');
  var previewWrap = document.getElementById('previewWrap');
  var previewLoading = document.getElementById('previewLoading');
  var mainCanvas = document.getElementById('mainCanvas');
  var previewArea = document.getElementById('previewArea');

  // -- Helpers --

  function getCacheKey(fontFile, height) {
    return fontFile + '_' + height;
  }

  function getCurrentColor() {
    if (typeof DMC_COLORS === 'undefined' || !DMC_COLORS.length) return { hex: '#000000', code: '310', name: 'Black' };
    for (var i = 0; i < DMC_COLORS.length; i++) {
      if (DMC_COLORS[i].code === currentColorCode) return DMC_COLORS[i];
    }
    return DMC_COLORS[0]; // fallback
  }

  function showLoading() {
    previewLoading.classList.remove('hidden');
  }

  function hideLoading() {
    previewLoading.classList.add('hidden');
  }


// ui-modules/auth.js â€” Optional auth + payment gate (Clerk + Stripe)
// App is open to everyone. Clerk is optional (for subscription management).
// PDF download is the monetization point.

  var clerkUserBtn = document.getElementById('clerk-user-button');
  var signInBtn = document.getElementById('btn-signin');
  var isAuthenticated = false;
  var userPlan = 'free'; // 'free' | 'pro'

  // -- Session helpers --

  function getSessionToken() {
    if (window.Clerk && window.Clerk.session) {
      return window.Clerk.session.getToken();
    }
    return Promise.resolve(null);
  }

  function isProUser() {
    return userPlan === 'pro';
  }

  function applyPlanUI() {
    var meta = window.Clerk && window.Clerk.user
      ? (window.Clerk.user.publicMetadata || {})
      : {};
    userPlan = meta.plan === 'pro' ? 'pro' : 'free';
    document.body.classList.toggle('plan-pro', userPlan === 'pro');
  }

  // -- Payment modal --

  var payModalEl = document.getElementById('pay-modal');
  var payBackdrop = document.getElementById('pay-backdrop');
  var payBtnOnetime = document.getElementById('pay-onetime');
  var payBtnSubscribe = document.getElementById('pay-subscribe');
  var payBtnClose = document.getElementById('pay-close');

  function showPaymentModal() {
    if (payModalEl) payModalEl.classList.remove('pay-hidden');
  }

  function hidePaymentModal() {
    if (payModalEl) payModalEl.classList.add('pay-hidden');
  }

  function savePendingDownload() {
    try {
      localStorage.setItem('w2s_pending_pdf', JSON.stringify({
        text: currentText,
        font: currentFontFile,
        height: currentHeight,
        color: currentColorCode,
        aida: currentAida,
        align: currentAlign
      }));
    } catch (e) { /* ignore */ }
  }

  function clearPendingDownload() {
    try { localStorage.removeItem('w2s_pending_pdf'); } catch (e) { /* ignore */ }
  }

  function handlePayment(mode) {
    // For subscriptions, require sign-in first
    if (mode === 'subscription' && !isAuthenticated) {
      // Open Clerk sign-in and wait for completion
      if (window.Clerk) {
        window.Clerk.openSignIn();
        // Listen for sign-in, then retry
        var _subWait = setInterval(function () {
          if (window.Clerk.user) {
            clearInterval(_subWait);
            isAuthenticated = true;
            document.body.classList.add('authenticated');
            if (clerkUserBtn) window.Clerk.mountUserButton(clerkUserBtn);
            if (signInBtn) signInBtn.style.display = 'none';
            applyPlanUI();
            // Now proceed with subscription checkout
            handlePayment(mode);
          }
        }, 500);
        setTimeout(function () { clearInterval(_subWait); }, 120000);
        return;
      }
    }

    // Save pattern state before redirecting to Stripe
    savePendingDownload();

    var origin = window.location.origin;
    var body = {
      mode: mode,
      success_url: origin + '/?payment=success',
      cancel_url: origin + '/?payment=cancelled'
    };

    getSessionToken().then(function (token) {
      var headers = { 'Content-Type': 'application/json' };
      if (token) headers['Authorization'] = 'Bearer ' + token;

      return fetch('/api/checkout', {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(body)
      });
    })
    .then(function (res) {
      if (!res.ok) throw new Error('Checkout failed');
      return res.json();
    })
    .then(function (data) {
      if (data.url) window.location.href = data.url;
    })
    .catch(function (err) {
      console.error('Checkout error:', err);
      hidePaymentModal();
    });
  }

  /**
   * Called by pdf-integration.js instead of directly generating PDF.
   * If user is pro subscriber â†’ generate PDF immediately.
   * If not â†’ show payment modal.
   */
  function requestPdfDownload(generateFn) {
    if (isProUser()) {
      generateFn();
      return;
    }
    // Store the generate function for after payment
    window._pendingPdfGenerate = generateFn;
    showPaymentModal();
  }

  // -- Bind payment modal buttons --

  if (payBtnOnetime) {
    payBtnOnetime.addEventListener('click', function () { handlePayment('payment'); });
  }
  if (payBtnSubscribe) {
    payBtnSubscribe.addEventListener('click', function () { handlePayment('subscription'); });
  }
  if (payBtnClose) {
    payBtnClose.addEventListener('click', hidePaymentModal);
  }
  if (payBackdrop) {
    payBackdrop.addEventListener('click', hidePaymentModal);
  }

  // -- Optional Clerk initialization (non-blocking) --

  function initAuth(onReady) {
    // App loads immediately â€” no auth gate
    onReady();

    // Initialize Clerk in background (optional sign-in)
    var checkInterval = setInterval(function () {
      if (!window.Clerk) return;
      clearInterval(checkInterval);

      window.Clerk.load().then(function () {
        if (window.Clerk.user) {
          isAuthenticated = true;
          document.body.classList.add('authenticated');
          if (clerkUserBtn) window.Clerk.mountUserButton(clerkUserBtn);
          if (signInBtn) signInBtn.style.display = 'none';
          applyPlanUI();
        }

        // Listen for sign-in/sign-out changes
        window.Clerk.addListener(function () {
          if (window.Clerk.user && !isAuthenticated) {
            isAuthenticated = true;
            document.body.classList.add('authenticated');
            if (clerkUserBtn) window.Clerk.mountUserButton(clerkUserBtn);
            if (signInBtn) signInBtn.style.display = 'none';
            applyPlanUI();
          } else if (!window.Clerk.user && isAuthenticated) {
            isAuthenticated = false;
            document.body.classList.remove('authenticated');
            if (signInBtn) signInBtn.style.display = '';
            userPlan = 'free';
            document.body.classList.remove('plan-pro');
          }
        });
      });
    }, 100);
    setTimeout(function () { clearInterval(checkInterval); }, 15000);

    // Check for payment return
    var params = new URLSearchParams(window.location.search);
    if (params.get('payment') === 'success') {
      window.history.replaceState({}, '', window.location.pathname);

      // If user is logged in, refresh metadata
      if (window.Clerk && window.Clerk.user) {
        window.Clerk.user.reload().then(applyPlanUI);
      }

      // Trigger pending PDF download
      setTimeout(function () {
        var pending = null;
        try { pending = JSON.parse(localStorage.getItem('w2s_pending_pdf')); } catch (e) { /* ignore */ }
        if (pending && typeof generatePDF === 'function' && currentFontData) {
          clearPendingDownload();
          var color = getCurrentColor();
          try {
            generatePDF(currentText, currentFontData, color, currentAida);
          } catch (err) {
            console.error('Auto PDF download failed:', err);
          }
        }
      }, 2000);
    }
  }


// ui-modules/renderer.js â€” Canvas rendering (renderPreview)

  // -- Render --

  function renderPreview(canvas, text, fontData, colorHex, options) {
    var ctx = canvas.getContext('2d');
    if (!text || !fontData) {
      canvas.width = 1; canvas.height = 1;
      ctx.clearRect(0, 0, 1, 1);
      return { width: 0, height: 0, stitches: 0 };
    }

    var result = getTextBitmap(text, fontData, { textAlign: options.textAlign || 'left' });
    var bitmap = result.bitmap;
    var width = result.width;
    var height = result.height;
    if (!bitmap.length || !width) {
      canvas.width = 1; canvas.height = 1;
      ctx.clearRect(0, 0, 1, 1);
      return { width: 0, height: 0, stitches: 0 };
    }

    var opts = options || {};
    var maxCanvasWidth = opts.maxWidth || 850;
    var cellSize = opts.cellSize || 12;
    if (width * cellSize > maxCanvasWidth) {
      cellSize = Math.max(2, Math.floor(maxCanvasWidth / width));
    }

    var canvasW = width * cellSize + 1;
    var canvasH = height * cellSize + 1;
    canvas.width = canvasW;
    canvas.height = canvasH;

    // Background
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvasW, canvasH);

    var stitchCount = 0;

    // Filled cells
    ctx.fillStyle = colorHex;
    for (var y = 0; y < height; y++) {
      for (var x = 0; x < width; x++) {
        if (bitmap[y][x]) {
          ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
          stitchCount++;
        }
      }
    }

    // Grid lines
    ctx.strokeStyle = '#e0d8d0';
    ctx.lineWidth = 0.5;
    for (var gx = 0; gx <= width; gx++) {
      var px = gx * cellSize + 0.5;
      ctx.beginPath(); ctx.moveTo(px, 0); ctx.lineTo(px, canvasH); ctx.stroke();
    }
    for (var gy = 0; gy <= height; gy++) {
      var py = gy * cellSize + 0.5;
      ctx.beginPath(); ctx.moveTo(0, py); ctx.lineTo(canvasW, py); ctx.stroke();
    }

    // Bold every 10
    if (cellSize >= 4) {
      ctx.strokeStyle = '#a09888';
      ctx.lineWidth = 1.5;
      for (var bx = 0; bx <= width; bx += 10) {
        var bpx = bx * cellSize + 0.5;
        ctx.beginPath(); ctx.moveTo(bpx, 0); ctx.lineTo(bpx, canvasH); ctx.stroke();
      }
      for (var by = 0; by <= height; by += 10) {
        var bpy = by * cellSize + 0.5;
        ctx.beginPath(); ctx.moveTo(0, bpy); ctx.lineTo(canvasW, bpy); ctx.stroke();
      }
    }

    return { width: width, height: height, stitches: stitchCount };
  }


// ui-modules/api.js â€” API calls (fetchFontList, rasterizeFont)

  // -- API calls --

  function fetchFontList() {
    return fetch('/api/fonts')
      .then(function (res) {
        if (!res.ok) throw new Error('Failed to load font list');
        return res.json();
      })
      .then(function (data) {
        fontListData = data;
        renderFontListUI();
        // Auto-rasterize default font on load
        if (currentFontFile && currentText) {
          loadAndRender();
        }
      })
      .catch(function (err) {
        fontList.innerHTML = '';
        var msg = document.createElement('div');
        msg.style.cssText = 'padding:20px;color:var(--text-muted);font-size:12px;text-align:center';
        msg.textContent = t('server_error');
        fontList.appendChild(msg);
        console.error('fetchFontList:', err);
      });
  }

  function rasterizeFont(fontFile, height) {
    var key = getCacheKey(fontFile, height);

    // L1: Memory cache
    if (fontCache.has(key)) {
      return Promise.resolve(fontCache.get(key));
    }

    // Dedup: return existing in-flight promise
    if (inFlightRequests.has(key)) {
      return inFlightRequests.get(key);
    }

    showLoading();

    var promise = getSessionToken().then(function (token) {
      var headers = { 'Content-Type': 'application/json' };
      if (token) headers['Authorization'] = 'Bearer ' + token;

      return fetch('/api/rasterize', {
        method: 'POST',
        headers: headers,
        body: JSON.stringify({
          font: fontFile,
          height: height,
          bold: 0,
          strategy: 'average'
        })
      });
    })
    .then(function (res) {
      if (!res.ok) throw new Error('Rasterization failed');
      return res.json();
    })
    .then(function (data) {
      fontCache.set(key, data);
      hideLoading();
      return data;
    })
    .catch(function (err) {
      hideLoading();
      console.error('rasterizeFont:', err);
      return null;
    })
    .finally(function () {
      inFlightRequests.delete(key);
    });

    inFlightRequests.set(key, promise);
    return promise;
  }


// ui-modules/preview.js â€” Preview orchestration
// updatePreview(), loadAndRender(), text input handler

  // -- Update Preview (main function) --

  function updatePreview() {
    var color = getCurrentColor();

    if (!currentText.trim() || !currentFontData) {
      previewEmpty.style.display = 'flex';
      previewWrap.style.display = 'none';
      return;
    }

    previewEmpty.style.display = 'none';
    previewWrap.style.display = 'flex';

    // Calculate available space
    var areaRect = previewArea.getBoundingClientRect();
    var maxW = areaRect.width - 40;

    var result = renderPreview(mainCanvas, currentText, currentFontData, color.hex, {
      cellSize: 16,
      maxWidth: maxW,
      textAlign: currentAlign
    });

    if (result.width === 0) {
      previewEmpty.style.display = 'flex';
      previewWrap.style.display = 'none';
      return;
    }

    // Calculate physical size using unit-aware helpers
    var size = formatSize(result.width, result.height, currentAida);

    // Update stats
    var statsBar = document.getElementById('statsBar');
    if (statsBar && !statsBar.getAttribute('aria-live')) {
      statsBar.setAttribute('aria-live', 'polite');
      statsBar.setAttribute('aria-atomic', 'true');
    }
    document.getElementById('statSizeCm').textContent = size.value;
    var sizeUnitEl = document.getElementById('statSizeUnit');
    if (sizeUnitEl) sizeUnitEl.textContent = size.unit;
    document.getElementById('statStitchesW').textContent = result.width;
    document.getElementById('statStitchesH').textContent = result.height;
    document.getElementById('statTotal').textContent = result.stitches;
    document.getElementById('statDmc').textContent = color.code;

    // Thread estimate
    document.getElementById('statThread').textContent = formatThread(result.stitches, currentAida);

    // Ruler: match canvas rendered dimensions
    document.getElementById('rulerWidth').textContent = size.width;
    var rulerHeightLabel = document.getElementById('rulerHeight');
    if (rulerHeightLabel) rulerHeightLabel.textContent = size.height;
    requestAnimationFrame(function () {
      var canvasRect = mainCanvas.getBoundingClientRect();
      var rulerLine = document.querySelector('.ruler-line');
      if (rulerLine && canvasRect.width > 0) {
        rulerLine.style.width = canvasRect.width + 'px';
      }
      // Vertical ruler: match canvas rendered height
      var rulerV = document.getElementById('rulerVertical');
      if (rulerV && canvasRect.height > 0) {
        rulerV.style.height = canvasRect.height + 'px';
      }
    });
  }

  // -- Trigger rasterization and update --

  function loadAndRender() {
    if (!currentFontFile) {
      currentFontData = null;
      updatePreview();
      return;
    }

    rasterizeFont(currentFontFile, currentHeight).then(function (data) {
      if (data) {
        currentFontData = data;
      }
      updatePreview();
    });
  }

  // -- Text Input --

  var desktopInputDebounce = null;
  textInput.addEventListener('input', function () {
    currentText = this.value;
    clearTimeout(desktopInputDebounce);
    desktopInputDebounce = setTimeout(function () {
      updatePreview();
      renderVirtualFontList();
    }, 300);
  });


// ui-modules/font-manager.js â€” Font list rendering, search, category tabs
// renderFontListUI(), font search handler, category tab click handler

  // -- Font List UI --

  function renderFontListUI() {
    var filter = (fontSearch.value || '').toLowerCase().trim();

    // Compute category counts from filtered fonts
    var categoryCounts = {};
    fontListData.forEach(function (font) {
      var name = font.name || font.file;
      if (filter && name.toLowerCase().indexOf(filter) === -1) return;
      var cat = font.category || 'other';
      categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
    });

    var categories = Object.keys(categoryCounts).sort();
    var totalFiltered = 0;
    categories.forEach(function (c) { totalFiltered += categoryCounts[c]; });

    // Populate category tabs
    var tabsEl = document.getElementById('fontCategoryTabs');
    tabsEl.innerHTML = '';
    var allBtn = document.createElement('button');
    allBtn.className = 'font-tab' + (currentCategoryFilter === 'all' ? ' active' : '');
    allBtn.dataset.category = 'all';
    allBtn.textContent = t('tab_all') + ' (' + totalFiltered + ')';
    tabsEl.appendChild(allBtn);

    categories.forEach(function (cat) {
      var btn = document.createElement('button');
      btn.className = 'font-tab' + (currentCategoryFilter === cat ? ' active' : '');
      btn.dataset.category = cat;
      btn.textContent = (categoryLabels[cat] || cat) + ' (' + categoryCounts[cat] + ')';
      tabsEl.appendChild(btn);
    });

    // Reset if current category has no fonts
    if (currentCategoryFilter !== 'all' && !categoryCounts[currentCategoryFilter]) {
      currentCategoryFilter = 'all';
      tabsEl.querySelector('[data-category="all"]').classList.add('active');
    }

    // Render font list
    fontList.innerHTML = '';

    if (!fontListData.length) {
      var msg = document.createElement('div');
      msg.style.cssText = 'padding:20px;color:var(--text-muted);font-size:12px;text-align:center';
      msg.textContent = t('no_fonts');
      fontList.appendChild(msg);
      return;
    }

    var displayed = 0;
    var fragment = document.createDocumentFragment();

    fontListData.forEach(function (font) {
      var name = font.name || font.file;
      if (filter && name.toLowerCase().indexOf(filter) === -1) return;
      if (currentCategoryFilter !== 'all' && (font.category || 'other') !== currentCategoryFilter) return;

      displayed++;

      var item = document.createElement('div');
      item.className = 'font-item' + (font.file === currentFontFile ? ' selected' : '');
      item.dataset.fontFile = font.file;

      var info = document.createElement('div');
      info.className = 'font-item-info';

      var nameEl = document.createElement('div');
      nameEl.className = 'font-item-name';
      nameEl.textContent = name;

      var meta = document.createElement('div');
      meta.className = 'font-item-meta';
      var sizeKb = font.size ? (font.size / 1024).toFixed(0) + ' KB' : '';
      meta.textContent = (categoryLabels[font.category] || font.category || '') + (sizeKb ? ' \u00b7 ' + sizeKb : '');

      var previewCanvas = document.createElement('canvas');
      previewCanvas.className = 'font-item-preview';
      previewCanvas.dataset.fontFile = font.file;

      info.appendChild(nameEl);
      info.appendChild(meta);
      info.appendChild(previewCanvas);
      item.appendChild(info);
      fragment.appendChild(item);

      item.addEventListener('click', function () {
        currentFontFile = font.file;
        currentFontName = name;
        fontList.querySelectorAll('.font-item').forEach(function (el) {
          el.classList.toggle('selected', el.dataset.fontFile === font.file);
        });
        syncMobileFontName();
        loadAndRender();
      });
    });

    fontList.appendChild(fragment);

    if (!displayed) {
      fontList.innerHTML = '';
      var msg = document.createElement('div');
      msg.style.cssText = 'padding:20px;color:var(--text-muted);font-size:12px;text-align:center';
      msg.textContent = t('no_matching');
      fontList.appendChild(msg);
    }

    // Queue font previews for visible desktop items
    if (typeof queueFontPreview === 'function') {
      var desktopCanvases = fontList.querySelectorAll('.font-item-preview');
      for (var pi = 0; pi < desktopCanvases.length; pi++) {
        queueFontPreview(desktopCanvases[pi].dataset.fontFile, desktopCanvases[pi]);
      }
    }
  }

  // Font search filtering
  fontSearch.addEventListener('input', function () {
    renderFontListUI();
  });

  // Category tab filtering (delegated)
  document.getElementById('fontCategoryTabs').addEventListener('click', function (e) {
    var tab = e.target.closest('.font-tab');
    if (!tab) return;
    currentCategoryFilter = tab.dataset.category;
    this.querySelectorAll('.font-tab').forEach(function (t) { t.classList.remove('active'); });
    tab.classList.add('active');
    renderFontListUI();
  });


// ui-modules/color-manager.js â€” DMC color swatch rendering and click handlers
// renderColors(), openColorPopover(), closeColorPopover()

  // -- Color Swatches (sidebar: popular 20 + "All" button) --

  function renderColors() {
    if (typeof DMC_COLORS === 'undefined' || !DMC_COLORS.length) return;
    colorRow.innerHTML = '';
    var fragment = document.createDocumentFragment();

    var popularCodes = (typeof POPULAR_DMC_CODES !== 'undefined') ? POPULAR_DMC_CODES : [];
    var popular = popularCodes.map(function (code) {
      for (var i = 0; i < DMC_COLORS.length; i++) {
        if (DMC_COLORS[i].code === code) return DMC_COLORS[i];
      }
      return null;
    }).filter(Boolean);

    // If no popular list, show first 20
    if (!popular.length) popular = DMC_COLORS.slice(0, 20);

    popular.forEach(function (color) {
      var dot = document.createElement('div');
      dot.className = 'color-dot' + (color.code === currentColorCode ? ' selected' : '');
      dot.style.backgroundColor = color.hex;
      dot.dataset.code = color.code;

      var tip = document.createElement('div');
      tip.className = 'tip';
      tip.textContent = 'DMC ' + color.code + ' \u2014 ' + color.name;
      dot.appendChild(tip);

      fragment.appendChild(dot);
    });

    // "All colors" button
    var allBtn = document.createElement('button');
    allBtn.className = 'color-all-btn';
    allBtn.textContent = 'All\u2026';
    allBtn.setAttribute('aria-label', 'Show all DMC colors');
    fragment.appendChild(allBtn);

    colorRow.appendChild(fragment);

    // Delegated click handler for the whole color row
    colorRow.onclick = function (e) {
      var dot = e.target.closest('.color-dot');
      if (dot && dot.dataset.code) {
        selectColor(dot.dataset.code);
        return;
      }
      if (e.target.closest('.color-all-btn')) {
        openColorPopover();
      }
    };
  }

  // -- Select color by DMC code --

  function selectColor(code) {
    currentColorCode = code;

    // Update sidebar dots
    colorRow.querySelectorAll('.color-dot').forEach(function (d) {
      d.classList.toggle('selected', d.dataset.code === code);
    });

    // Update popover selection if open
    var popGrid = document.getElementById('colorPopoverGrid');
    if (popGrid) {
      popGrid.querySelectorAll('.color-dot').forEach(function (d) {
        d.classList.toggle('selected', d.dataset.code === code);
      });
    }

    syncMobileColorStrip();
    updatePreview();
  }

  // -- Desktop Color Popover --

  function openColorPopover() {
    var popover = document.getElementById('colorPopover');
    if (!popover) return;
    popover.classList.add('open');
    renderColorPopoverGrid('');

    var searchInput = document.getElementById('colorPopoverSearch');
    if (searchInput) {
      searchInput.value = '';
      searchInput.focus();
    }
  }

  function closeColorPopover() {
    var popover = document.getElementById('colorPopover');
    if (popover) popover.classList.remove('open');
  }

  function renderColorPopoverGrid(query) {
    var grid = document.getElementById('colorPopoverGrid');
    if (!grid) return;
    grid.innerHTML = '';

    var q = (query || '').toLowerCase().trim();
    var filtered = DMC_COLORS.filter(function (c) {
      if (!q) return true;
      return c.code.toLowerCase().indexOf(q) !== -1 || c.name.toLowerCase().indexOf(q) !== -1;
    });

    var fragment = document.createDocumentFragment();
    filtered.forEach(function (color) {
      var dot = document.createElement('div');
      dot.className = 'color-dot' + (color.code === currentColorCode ? ' selected' : '');
      dot.style.backgroundColor = color.hex;
      dot.dataset.code = color.code;

      var tip = document.createElement('div');
      tip.className = 'tip';
      tip.textContent = 'DMC ' + color.code + ' \u2014 ' + color.name;
      dot.appendChild(tip);

      fragment.appendChild(dot);
    });

    grid.appendChild(fragment);
  }

  // Popover event wiring (delegated)
  var colorPopover = document.getElementById('colorPopover');
  if (colorPopover) {
    // Grid click
    var popGrid = document.getElementById('colorPopoverGrid');
    if (popGrid) {
      popGrid.onclick = function (e) {
        var dot = e.target.closest('.color-dot');
        if (dot && dot.dataset.code) {
          selectColor(dot.dataset.code);
          closeColorPopover();
        }
      };
    }

    // Search input
    var popSearch = document.getElementById('colorPopoverSearch');
    if (popSearch) {
      popSearch.addEventListener('input', function () {
        renderColorPopoverGrid(this.value);
      });
    }

    // Close button
    var popClose = document.getElementById('colorPopoverClose');
    if (popClose) {
      popClose.addEventListener('click', closeColorPopover);
    }

    // Close on outside click
    document.addEventListener('click', function (e) {
      if (colorPopover.classList.contains('open') && !colorPopover.contains(e.target) && !e.target.closest('.color-all-btn')) {
        closeColorPopover();
      }
    });
  }


// ui-modules/settings.js â€” Stitch/aida/height/unit handlers and custom stitch variables
// Height slider, aida count buttons, custom stitch slider, unit toggle

  // -- Height Slider --

  var heightDebounceTimer = null;

  heightSlider.addEventListener('input', function () {
    var val = parseInt(this.value);
    heightValue.textContent = val;
    syncMobileHeightValue(val);
    currentHeight = val;

    // Cancel stale preview requests immediately
    cancelAllPreviews();

    // Priority: re-rasterize selected font immediately
    loadAndRender();

    // Debounced: re-render sidebar previews (300ms)
    clearTimeout(heightDebounceTimer);
    heightDebounceTimer = setTimeout(function () {
      renderFontListUI();
    }, 300);
  });

  // -- Aida Count --

  document.getElementById('langSelect').addEventListener('change', function() {
    setLanguage(this.value);
  });

  var customStitchRow = document.getElementById('customStitchRow');
  var customStitchSlider = document.getElementById('customStitchSlider');
  var customStitchValue = document.getElementById('customStitchValue');
  var customStitchEquiv = document.getElementById('customStitchEquiv');
  var currentStitchMm = 3.0; // default 3mm stitch length
  var isCustomAida = false;

  function stitchMmToAida(mm) {
    return 25.4 / mm; // 25.4mm per inch
  }

  // Format stitch length + equivalence respecting displayUnit
  function formatStitchDisplay(mm) {
    var isImperial = (displayUnit === 'imperial');
    var displayVal, unit, equiv;
    if (isImperial) {
      displayVal = (mm / 25.4).toFixed(2);  // mm â†’ inches
      unit = 'in';
      equiv = '\u2248 ' + (25.4 / mm).toFixed(1) + ' stitches/in';
    } else {
      displayVal = mm.toFixed(1);
      unit = 'mm';
      equiv = '\u2248 ' + (10 / mm).toFixed(1) + ' stitches/cm';
    }
    return { value: displayVal, unit: unit, equiv: equiv };
  }

  function updateCustomStitch(mm, source) {
    currentStitchMm = mm;
    var aida = stitchMmToAida(mm);
    currentAida = aida;

    var fmt = formatStitchDisplay(mm);

    // Update desktop UI
    if (customStitchValue) customStitchValue.textContent = fmt.value;
    if (customStitchSlider && source !== 'desktop') customStitchSlider.value = mm;
    if (customStitchEquiv) customStitchEquiv.textContent = fmt.equiv;
    var dUnit = document.getElementById('customStitchUnit');
    if (dUnit) dUnit.textContent = fmt.unit;

    // Update sheet UI
    var sheetVal = document.getElementById('sheetCustomStitchValue');
    var sheetSlider = document.getElementById('sheetCustomStitchSlider');
    var sheetEquiv = document.getElementById('sheetCustomStitchEquiv');
    var sheetUnit = document.getElementById('sheetCustomStitchUnit');
    if (sheetVal) sheetVal.textContent = fmt.value;
    if (sheetSlider && source !== 'sheet') sheetSlider.value = mm;
    if (sheetEquiv) sheetEquiv.textContent = fmt.equiv;
    if (sheetUnit) sheetUnit.textContent = fmt.unit;

    syncMobileAidaChips();
    updatePreview();
  }

  aidaRow.addEventListener('click', function (e) {
    var chip = e.target.closest('.aida-chip');
    if (!chip) return;
    var countVal = chip.dataset.count;

    // Deselect all chips
    aidaRow.querySelectorAll('.aida-chip').forEach(function (c) {
      c.classList.remove('selected');
    });
    chip.classList.add('selected');

    if (countVal === 'custom') {
      if (isCustomAida) {
        // Already custom â€” toggle slider visibility
        if (customStitchRow) customStitchRow.classList.toggle('visible');
      } else {
        isCustomAida = true;
        if (customStitchRow) customStitchRow.classList.add('visible');
        updateCustomStitch(currentStitchMm, 'init');
      }
    } else {
      isCustomAida = false;
      if (customStitchRow) customStitchRow.classList.remove('visible');
      currentAida = parseInt(countVal);
      syncMobileAidaChips();
      updatePreview();
    }
  });

  // Desktop stitch slider
  if (customStitchSlider) {
    customStitchSlider.addEventListener('input', function () {
      if (isCustomAida) updateCustomStitch(parseFloat(this.value), 'desktop');
    });
  }

  // -- Global unit toggle (cm / in) --
  document.getElementById('unitToggle').addEventListener('click', function (e) {
    var btn = e.target.closest('.unit-toggle-btn');
    if (!btn || btn.classList.contains('active')) return;
    setDisplayUnit(btn.dataset.unit);
  });


// ui-modules/pdf-integration.js â€” Download PDF button handler
// Calls requestPdfDownload (from auth.js) which checks plan status
// before allowing PDF generation.

  // -- Download PDF --

  btnDownload.addEventListener('click', function () {
    var color = getCurrentColor();
    if (!currentFontData || !currentText.trim()) {
      alert(t('alert_no_text'));
      return;
    }
    if (typeof generatePDF !== 'function') {
      alert(t('alert_no_pdf'));
      return;
    }
    if (!window.jspdf) {
      alert(t('alert_no_jspdf'));
      return;
    }

    // Delegate to auth.js â€” shows payment modal if not pro
    requestPdfDownload(function () {
      try {
        generatePDF(currentText, currentFontData, color, currentAida);
      } catch (err) {
        alert(t('alert_pdf_fail') + err.message);
        console.error('PDF error:', err);
      }
    });
  });


// ui-modules/sheet-system.js â€” Mobile sheet open/close & swipe-to-dismiss

  // ============================================================
  // == Mobile Canvas First: Bottom Sheets & Virtual Scroll     ==
  // ============================================================

  var isMobile = function () { return window.innerWidth <= 640; };

  // -- Sheet State --
  var activeSheet = null;
  var sheetBackdrop = document.getElementById('sheetBackdrop');
  var mobileToolbar = document.getElementById('mobileToolbar');
  var sheets = {
    font: document.getElementById('sheetFont'),
    color: document.getElementById('sheetColor'),
    settings: document.getElementById('sheetSettings'),
    info: document.getElementById('sheetInfo')
  };

  // -- Sheet Open / Close --
  function openSheet(name) {
    if (!isMobile()) return;
    if (activeSheet === name) {
      closeSheet();
      return;
    }
    // Close any open sheet first (no animation, instant)
    if (activeSheet) {
      sheets[activeSheet].classList.remove('open');
    }
    activeSheet = name;
    var sheet = sheets[name];
    if (!sheet) return;

    // Populate sheet content before opening
    if (name === 'font') populateFontSheet();
    if (name === 'color') populateColorSheet();
    if (name === 'settings') syncSettingsSheet();
    if (name === 'info') syncInfoSheet();

    sheetBackdrop.classList.add('visible');
    sheet.classList.add('open');
    document.body.classList.add('sheet-open');
    sheet.setAttribute('aria-hidden', 'false');
  }

  function closeSheet() {
    if (!activeSheet) return;
    var sheet = sheets[activeSheet];
    if (sheet) {
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden', 'true');
    }
    sheetBackdrop.classList.remove('visible');
    document.body.classList.remove('sheet-open');
    activeSheet = null;
  }

  // Backdrop click closes sheet
  sheetBackdrop.addEventListener('click', closeSheet);

  // Escape key closes sheet
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && activeSheet) closeSheet();
  });

  // ============================================================
  // == Swipe-to-Dismiss on Sheet Handles                       ==
  // ============================================================

  function initSheetDrag(handleId, sheetId) {
    var handle = document.getElementById(handleId);
    var sheet = document.getElementById(sheetId);
    if (!handle || !sheet) return;

    var startY = 0, currentY = 0, startTime = 0, isDragging = false;

    handle.addEventListener('touchstart', function (e) {
      if (!sheet.classList.contains('open')) return;
      isDragging = true;
      startY = e.touches[0].clientY;
      currentY = startY;
      startTime = Date.now();
      sheet.style.transition = 'none';
    }, { passive: true });

    handle.addEventListener('touchmove', function (e) {
      if (!isDragging) return;
      currentY = e.touches[0].clientY;
      var dy = Math.max(0, currentY - startY);
      sheet.style.transform = 'translateY(' + dy + 'px)';
    }, { passive: true });

    handle.addEventListener('touchend', function () {
      if (!isDragging) return;
      isDragging = false;
      sheet.style.transition = '';
      var dy = currentY - startY;
      var dt = Date.now() - startTime;
      var velocity = dy / Math.max(dt, 1);

      if (dy > 120 || velocity > 0.5) {
        closeSheet();
      } else {
        sheet.style.transform = '';
      }
    });
  }

  initSheetDrag('sheetFontHandle', 'sheetFont');
  initSheetDrag('sheetColorHandle', 'sheetColor');
  initSheetDrag('sheetSettingsHandle', 'sheetSettings');
  initSheetDrag('sheetInfoHandle', 'sheetInfo');


// ui-modules/virtual-scroll.js â€” Font sheet virtual scroll & preview queue

  // ============================================================
  // == Font Sheet: Virtual Scroll                              ==
  // ============================================================

  var FONT_ITEM_HEIGHT = 80;
  var OVERSCAN = 5;
  var fontSheetFilter = '';
  var fontSheetCategory = 'all';
  var filteredFontsCache = [];

  function getFilteredFonts() {
    var filter = fontSheetFilter.toLowerCase().trim();
    return fontListData.filter(function (font) {
      var name = (font.name || font.file).toLowerCase();
      if (filter && name.indexOf(filter) === -1) return false;
      if (fontSheetCategory !== 'all' && (font.category || 'other') !== fontSheetCategory) return false;
      return true;
    });
  }

  function populateFontSheet() {
    // Build tabs
    var tabsEl = document.getElementById('sheetFontTabs');
    var filter = fontSheetFilter.toLowerCase().trim();
    var categoryCounts = {};
    fontListData.forEach(function (font) {
      var name = (font.name || font.file).toLowerCase();
      if (filter && name.indexOf(filter) === -1) return;
      var cat = font.category || 'other';
      categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
    });
    var categories = Object.keys(categoryCounts).sort();
    var total = 0;
    categories.forEach(function (c) { total += categoryCounts[c]; });

    tabsEl.innerHTML = '';
    var allTab = document.createElement('button');
    allTab.className = 'font-tab' + (fontSheetCategory === 'all' ? ' active' : '');
    allTab.dataset.category = 'all';
    allTab.textContent = t('tab_all') + ' (' + total + ')';
    tabsEl.appendChild(allTab);

    categories.forEach(function (cat) {
      var btn = document.createElement('button');
      btn.className = 'font-tab' + (fontSheetCategory === cat ? ' active' : '');
      btn.dataset.category = cat;
      btn.textContent = (categoryLabels[cat] || cat) + ' (' + categoryCounts[cat] + ')';
      tabsEl.appendChild(btn);
    });

    // Reset category if invalid
    if (fontSheetCategory !== 'all' && !categoryCounts[fontSheetCategory]) {
      fontSheetCategory = 'all';
    }

    // Update filtered cache
    filteredFontsCache = getFilteredFonts();

    // Set viewport total height
    var viewport = document.getElementById('sheetFontListViewport');
    viewport.style.height = (filteredFontsCache.length * FONT_ITEM_HEIGHT) + 'px';

    // Trigger initial render
    renderVirtualFontList();
  }

  var rafPending = false;

  function renderVirtualFontList() {
    var wrap = document.getElementById('sheetFontListWrap');
    var viewport = document.getElementById('sheetFontListViewport');
    if (!wrap || !viewport) return;

    var scrollTop = wrap.scrollTop;
    var viewportHeight = wrap.clientHeight;
    var totalItems = filteredFontsCache.length;

    if (!totalItems) {
      viewport.innerHTML = '';
      var msg = document.createElement('div');
      msg.style.cssText = 'padding:40px 20px;color:var(--text-muted);font-size:14px;text-align:center';
      msg.textContent = t('no_matching');
      viewport.appendChild(msg);
      viewport.style.height = 'auto';
      return;
    }

    var startIndex = Math.max(0, Math.floor(scrollTop / FONT_ITEM_HEIGHT) - OVERSCAN);
    var endIndex = Math.min(totalItems, Math.ceil((scrollTop + viewportHeight) / FONT_ITEM_HEIGHT) + OVERSCAN);

    var fragment = document.createDocumentFragment();

    // Top spacer
    if (startIndex > 0) {
      var topSpacer = document.createElement('div');
      topSpacer.style.height = (startIndex * FONT_ITEM_HEIGHT) + 'px';
      fragment.appendChild(topSpacer);
    }

    for (var i = startIndex; i < endIndex; i++) {
      var font = filteredFontsCache[i];
      var name = font.name || font.file;

      var item = document.createElement('div');
      item.className = 'sheet-font-item' + (font.file === currentFontFile ? ' selected' : '');
      item.dataset.fontFile = font.file;
      item.dataset.fontIndex = i;
      item.setAttribute('role', 'option');
      item.setAttribute('aria-selected', font.file === currentFontFile ? 'true' : 'false');

      var info = document.createElement('div');
      info.className = 'sheet-font-item-info';

      var nameEl = document.createElement('div');
      nameEl.className = 'sheet-font-item-name';
      nameEl.textContent = name;

      var meta = document.createElement('div');
      meta.className = 'sheet-font-item-meta';
      meta.textContent = categoryLabels[font.category] || font.category || '';

      var previewCanvas = document.createElement('canvas');
      previewCanvas.className = 'sheet-font-item-preview';
      previewCanvas.dataset.fontFile = font.file;

      info.appendChild(nameEl);
      info.appendChild(meta);
      info.appendChild(previewCanvas);
      item.appendChild(info);

      // Checkmark
      var check = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      check.setAttribute('class', 'sheet-font-item-check');
      check.setAttribute('viewBox', '0 0 24 24');
      check.setAttribute('fill', 'none');
      check.setAttribute('stroke', 'currentColor');
      check.setAttribute('stroke-width', '3');
      check.setAttribute('stroke-linecap', 'round');
      check.setAttribute('stroke-linejoin', 'round');
      var path = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
      path.setAttribute('points', '20 6 9 17 4 12');
      check.appendChild(path);
      item.appendChild(check);

      fragment.appendChild(item);
    }

    // Bottom spacer
    var bottomHeight = (totalItems - endIndex) * FONT_ITEM_HEIGHT;
    if (bottomHeight > 0) {
      var bottomSpacer = document.createElement('div');
      bottomSpacer.style.height = bottomHeight + 'px';
      fragment.appendChild(bottomSpacer);
    }

    previewQueue = [];
    viewport.innerHTML = '';
    viewport.appendChild(fragment);
    viewport.style.height = ''; // let spacers define height

    // Queue font previews for visible items
    var canvases = viewport.querySelectorAll('.sheet-font-item-preview');
    for (var ci = 0; ci < canvases.length; ci++) {
      queueFontPreview(canvases[ci].dataset.fontFile, canvases[ci]);
    }
  }

  // -- Font Preview Queue --
  var previewQueue = [];
  var activePreviewRequests = 0;
  var MAX_PREVIEW_CONCURRENT = 3;

  function cancelAllPreviews() {
    previewAbortControllers.forEach(function (ctrl) { ctrl.abort(); });
    previewAbortControllers.clear();
    previewQueue = [];
    activePreviewRequests = 0;
  }

  function queueFontPreview(fontFile, canvasEl) {
    var cacheKey = getCacheKey(fontFile, currentHeight);
    if (fontCache.has(cacheKey)) {
      renderFontPreviewCanvas(canvasEl, fontCache.get(cacheKey));
      return;
    }
    canvasEl.classList.add('loading');
    previewQueue.push({ fontFile: fontFile, canvas: canvasEl, height: currentHeight });
    processPreviewQueue();
  }

  function processPreviewQueue() {
    while (activePreviewRequests < MAX_PREVIEW_CONCURRENT && previewQueue.length > 0) {
      var job = previewQueue.shift();
      if (!document.contains(job.canvas)) continue;
      var cacheKey = getCacheKey(job.fontFile, job.height);
      if (fontCache.has(cacheKey)) {
        renderFontPreviewCanvas(job.canvas, fontCache.get(cacheKey));
        job.canvas.classList.remove('loading');
        continue;
      }
      activePreviewRequests++;
      rasterizeFontForPreview(job);
    }
  }

  function rasterizeFontForPreview(job) {
    var cacheKey = getCacheKey(job.fontFile, job.height);
    var controller = new AbortController();
    previewAbortControllers.set(cacheKey, controller);

    fetch('/api/rasterize', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ font: job.fontFile, height: job.height, bold: 0, strategy: 'average' }),
      signal: controller.signal
    })
    .then(function(r) { return r.json(); })
    .then(function(data) {
      fontCache.set(cacheKey, data);
      if (document.contains(job.canvas)) {
        renderFontPreviewCanvas(job.canvas, data);
        job.canvas.classList.remove('loading');
      }
    })
    .catch(function(err) {
      if (err.name === 'AbortError') return; // Silently ignore aborted requests
      if (document.contains(job.canvas)) job.canvas.classList.remove('loading');
    })
    .finally(function() {
      previewAbortControllers.delete(cacheKey);
      activePreviewRequests--;
      processPreviewQueue();
    });
  }

  function renderFontPreviewCanvas(canvas, fontData) {
    // Use only first line for compact previews in font picker
    var text = (currentText || 'Abc').split('\n')[0] || 'Abc';
    var color = getCurrentColor().hex;
    renderPreview(canvas, text, fontData, color, { cellSize: 2, maxWidth: 260 });
  }

  // Scroll handler (RAF-throttled)
  var sheetFontListWrap = document.getElementById('sheetFontListWrap');
  if (sheetFontListWrap) {
    sheetFontListWrap.addEventListener('scroll', function () {
      if (rafPending) return;
      rafPending = true;
      requestAnimationFrame(function () {
        rafPending = false;
        renderVirtualFontList();
      });
    }, { passive: true });
  }

  // Font sheet: item click (delegated)
  var sheetFontListViewport = document.getElementById('sheetFontListViewport');
  if (sheetFontListViewport) {
    sheetFontListViewport.addEventListener('click', function (e) {
      var item = e.target.closest('.sheet-font-item');
      if (!item) return;
      var fontFile = item.dataset.fontFile;
      var font = fontListData.find(function (f) { return f.file === fontFile; });
      if (!font) return;

      currentFontFile = font.file;
      currentFontName = font.name || font.file;

      // Update desktop sidebar selection too
      fontList.querySelectorAll('.font-item').forEach(function (el) {
        el.classList.toggle('selected', el.dataset.fontFile === font.file);
      });

      syncMobileFontName();
      loadAndRender();

      // Re-render virtual list to update selection
      renderVirtualFontList();

      // Close sheet after brief delay
      setTimeout(closeSheet, 200);
    });
  }

  // Font sheet: search
  var sheetFontSearchInput = document.getElementById('sheetFontSearch');
  var fontSearchDebounce = null;
  if (sheetFontSearchInput) {
    sheetFontSearchInput.addEventListener('input', function () {
      clearTimeout(fontSearchDebounce);
      fontSearchDebounce = setTimeout(function () {
        fontSheetFilter = sheetFontSearchInput.value;
        filteredFontsCache = getFilteredFonts();
        var viewport = document.getElementById('sheetFontListViewport');
        if (viewport) viewport.style.height = (filteredFontsCache.length * FONT_ITEM_HEIGHT) + 'px';
        var wrap = document.getElementById('sheetFontListWrap');
        if (wrap) wrap.scrollTop = 0;
        populateFontSheet();
      }, 150);
    });
  }

  // Font sheet: category tabs (delegated)
  var sheetFontTabs = document.getElementById('sheetFontTabs');
  if (sheetFontTabs) {
    sheetFontTabs.addEventListener('click', function (e) {
      var tab = e.target.closest('.font-tab');
      if (!tab) return;
      fontSheetCategory = tab.dataset.category;
      // Also sync desktop sidebar
      currentCategoryFilter = fontSheetCategory;
      populateFontSheet();
      renderFontListUI();
    });
  }


// ui-modules/sheet-content.js â€” Color, Settings & Info sheet content

  // ============================================================
  // == Color Sheet                                             ==
  // ============================================================

  function populateColorSheet() {
    if (typeof DMC_COLORS === 'undefined' || !DMC_COLORS.length) return;

    var color = getCurrentColor();
    var swatch = document.getElementById('sheetColorSwatch');
    var nameEl = document.getElementById('sheetColorName');
    var codeEl = document.getElementById('sheetColorCode');
    if (swatch) swatch.style.backgroundColor = color.hex;
    if (nameEl) nameEl.textContent = color.name;
    if (codeEl) codeEl.textContent = 'DMC ' + color.code;

    var searchInput = document.getElementById('sheetColorSearch');
    if (searchInput && !searchInput._bound) {
      searchInput._bound = true;
      searchInput.addEventListener('input', function () {
        renderSheetColorGrid(this.value);
      });
    }

    renderSheetColorGrid(searchInput ? searchInput.value : '');
  }

  function renderSheetColorGrid(query) {
    var grid = document.getElementById('sheetColorGrid');
    if (!grid) return;
    grid.innerHTML = '';

    var q = (query || '').toLowerCase().trim();
    var filtered = DMC_COLORS.filter(function (c) {
      if (!q) return true;
      return c.code.toLowerCase().indexOf(q) !== -1 || c.name.toLowerCase().indexOf(q) !== -1;
    });

    var fragment = document.createDocumentFragment();
    filtered.forEach(function (c) {
      var dot = document.createElement('div');
      dot.className = 'color-dot' + (c.code === currentColorCode ? ' selected' : '');
      dot.style.backgroundColor = c.hex;
      dot.dataset.code = c.code;
      fragment.appendChild(dot);
    });
    grid.appendChild(fragment);

    // Delegated click handler (set once)
    if (!grid._bound) {
      grid._bound = true;
      grid.addEventListener('click', function (e) {
        var dot = e.target.closest('.color-dot');
        if (!dot || !dot.dataset.code) return;
        selectColor(dot.dataset.code);
        populateColorSheet();
      });
    }
  }

  // ============================================================
  // == Settings Sheet                                          ==
  // ============================================================

  function syncSettingsSheet() {
    var sheetSlider = document.getElementById('sheetHeightSlider');
    var sheetValue = document.getElementById('sheetHeightValue');
    if (sheetSlider) sheetSlider.value = currentHeight;
    if (sheetValue) sheetValue.textContent = currentHeight;

    // Sync aida selection
    var sheetAidaRow = document.getElementById('sheetAidaRow');
    if (sheetAidaRow) {
      sheetAidaRow.querySelectorAll('.aida-chip').forEach(function (chip) {
        var count = chip.dataset.count;
        if (count === 'custom') {
          chip.classList.toggle('selected', isCustomAida);
        } else {
          chip.classList.toggle('selected', !isCustomAida && parseInt(count) === currentAida);
        }
      });
    }

    var sheetCustomRow = document.getElementById('sheetCustomStitchRow');
    if (sheetCustomRow) {
      sheetCustomRow.classList.toggle('visible', isCustomAida);
      if (isCustomAida) {
        var fmt = formatStitchDisplay(currentStitchMm);
        var sv = document.getElementById('sheetCustomStitchValue');
        var ss = document.getElementById('sheetCustomStitchSlider');
        var se = document.getElementById('sheetCustomStitchEquiv');
        var su = document.getElementById('sheetCustomStitchUnit');
        if (sv) sv.textContent = fmt.value;
        if (ss) ss.value = currentStitchMm;
        if (se) se.textContent = fmt.equiv;
        if (su) su.textContent = fmt.unit;
      }
    }
  }

  // Settings sheet: height slider
  var sheetHeightSlider = document.getElementById('sheetHeightSlider');
  var sheetHeightDebounce = null;
  if (sheetHeightSlider) {
    sheetHeightSlider.addEventListener('input', function () {
      var val = parseInt(this.value);
      var sheetValue = document.getElementById('sheetHeightValue');
      if (sheetValue) sheetValue.textContent = val;

      // Sync desktop slider + mobile slider
      heightSlider.value = val;
      heightValue.textContent = val;
      syncMobileHeightValue(val);

      currentHeight = val;

      // Cancel stale preview requests immediately
      cancelAllPreviews();

      // Priority: re-rasterize selected font immediately
      loadAndRender();

      // Debounced: re-render sidebar previews (300ms)
      clearTimeout(sheetHeightDebounce);
      sheetHeightDebounce = setTimeout(function () {
        renderFontListUI();
      }, 300);
    });
  }

  // Settings sheet: aida chips
  var sheetAidaRow = document.getElementById('sheetAidaRow');
  if (sheetAidaRow) {
    sheetAidaRow.addEventListener('click', function (e) {
      var chip = e.target.closest('.aida-chip');
      if (!chip) return;
      var countVal = chip.dataset.count;

      // Deselect all in sheet
      sheetAidaRow.querySelectorAll('.aida-chip').forEach(function (c) { c.classList.remove('selected'); });
      chip.classList.add('selected');

      // Sync desktop
      aidaRow.querySelectorAll('.aida-chip').forEach(function (c) { c.classList.remove('selected'); });
      var desktopChip = aidaRow.querySelector('[data-count="' + countVal + '"]');
      if (desktopChip) desktopChip.classList.add('selected');

      var sheetCustomRow = document.getElementById('sheetCustomStitchRow');

      if (countVal === 'custom') {
        isCustomAida = true;
        if (customStitchRow) customStitchRow.classList.add('visible');
        if (sheetCustomRow) sheetCustomRow.classList.add('visible');
        updateCustomStitch(currentStitchMm, 'init');
      } else {
        isCustomAida = false;
        if (customStitchRow) customStitchRow.classList.remove('visible');
        if (sheetCustomRow) sheetCustomRow.classList.remove('visible');
        currentAida = parseInt(countVal);
        syncMobileAidaChips();
        updatePreview();
      }
    });
  }

  // Settings sheet: stitch length slider
  var sheetStitchSlider = document.getElementById('sheetCustomStitchSlider');
  if (sheetStitchSlider) {
    sheetStitchSlider.addEventListener('input', function () {
      if (isCustomAida) updateCustomStitch(parseFloat(this.value), 'sheet');
    });
  }

  // ============================================================
  // == Info Sheet                                              ==
  // ============================================================

  function syncInfoSheet() {
    var color = getCurrentColor();
    var sizeCm = document.getElementById('statSizeCm');
    var stitchW = document.getElementById('statStitchesW');
    var stitchH = document.getElementById('statStitchesH');
    var total = document.getElementById('statTotal');
    var dmc = document.getElementById('statDmc');
    var thread = document.getElementById('statThread');

    var infoSize = document.getElementById('infoSize');
    var infoStitches = document.getElementById('infoStitches');
    var infoCrosses = document.getElementById('infoCrosses');
    var infoDmc = document.getElementById('infoDmc');
    var infoThread = document.getElementById('infoThread');
    var infoRulerW = document.getElementById('infoRulerWidth');

    if (infoSize && sizeCm) infoSize.textContent = sizeCm.textContent || '-- x --';
    if (infoStitches && stitchW && stitchH) infoStitches.textContent = (stitchW.textContent || '--') + 'x' + (stitchH.textContent || '--');
    if (infoCrosses && total) infoCrosses.textContent = total.textContent || '--';
    if (infoDmc && dmc) infoDmc.textContent = dmc.textContent || '--';
    if (infoThread && thread) infoThread.textContent = thread.textContent || '--';
    // Sync unit label
    var infoSizeUnit = document.getElementById('infoSizeUnit');
    var statSizeUnit = document.getElementById('statSizeUnit');
    if (infoSizeUnit && statSizeUnit) infoSizeUnit.textContent = statSizeUnit.textContent;
    if (infoRulerW) {
      var rulerW = document.getElementById('rulerWidth');
      infoRulerW.textContent = rulerW ? rulerW.textContent : '--';
    }

    // Sync language selector
    var sheetLang = document.getElementById('sheetLangSelect');
    if (sheetLang) sheetLang.value = currentLang;
  }

  // Info sheet: language selector
  var sheetLangSelect = document.getElementById('sheetLangSelect');
  if (sheetLangSelect) {
    sheetLangSelect.addEventListener('change', function () {
      setLanguage(this.value);
      // Sync desktop selector
      var desktopSelect = document.getElementById('langSelect');
      if (desktopSelect) desktopSelect.value = this.value;
    });
  }


// ui-modules/mobile-toolbar.js â€” Mobile toolbar sync, slider & button handlers

  // ============================================================
  // == Mobile Toolbar (Slider + 3 Buttons â†’ Sheets)           ==
  // ============================================================

  // -- Sync helpers --

  function syncMobileColorStrip() {
    // Update color button swatch and name
    var color = getCurrentColor();
    var swatch = document.getElementById('mobileColorSwatch');
    var nameEl = document.getElementById('mobileColorName');
    if (swatch) swatch.style.backgroundColor = color.hex;
    if (nameEl) nameEl.textContent = color.name;
  }

  function syncMobileHeightValue(val) {
    var el = document.getElementById('mobileHeightValue');
    var slider = document.getElementById('mobileHeightSlider');
    if (el) el.textContent = val;
    if (slider) slider.value = val;
  }

  function syncMobileAidaChips() {
    var el = document.getElementById('mobileAidaValue');
    if (el) el.textContent = (isCustomAida ? Math.round(currentAida) : currentAida) + ' ct';
  }

  function syncMobileFontName() {
    var el = document.getElementById('mobileFontName');
    if (el) el.textContent = currentFontName || 'Font';
  }

  // Kept for compatibility â€” no longer renders dots
  function populateMobileColorStrip() {
    syncMobileColorStrip();
  }

  // -- Mobile height slider --

  var mobileSlider = document.getElementById('mobileHeightSlider');
  var mobileSliderDebounce = null;
  if (mobileSlider) {
    mobileSlider.addEventListener('input', function () {
      var val = parseInt(this.value);
      var display = document.getElementById('mobileHeightValue');
      if (display) display.textContent = val;

      // Sync desktop + sheet sliders
      heightSlider.value = val;
      heightValue.textContent = val;
      var sheetSlider = document.getElementById('sheetHeightSlider');
      var sheetValue = document.getElementById('sheetHeightValue');
      if (sheetSlider) sheetSlider.value = val;
      if (sheetValue) sheetValue.textContent = val;

      currentHeight = val;

      // Cancel stale preview requests immediately
      cancelAllPreviews();

      // Priority: re-rasterize selected font immediately
      loadAndRender();

      // Debounced: re-render sidebar previews (300ms)
      clearTimeout(mobileSliderDebounce);
      mobileSliderDebounce = setTimeout(function () {
        renderFontListUI();
      }, 300);
    });
  }

  // -- Aida button â†’ opens settings sheet --

  var mobileAidaBtn = document.getElementById('mobileAidaBtn');
  if (mobileAidaBtn) {
    mobileAidaBtn.addEventListener('click', function () {
      openSheet('settings');
    });
  }

  // -- Font button â†’ opens font sheet --

  var mobileFontBtn = document.getElementById('mobileFontBtn');
  if (mobileFontBtn) {
    mobileFontBtn.addEventListener('click', function () {
      openSheet('font');
    });
  }

  // -- Color button â†’ opens color sheet --

  var mobileColorBtn = document.getElementById('mobileColorBtn');
  if (mobileColorBtn) {
    mobileColorBtn.addEventListener('click', function () {
      openSheet('color');
    });
  }

  // -- Initialize mobile toolbar on load --

  function initMobileToolbar() {
    syncMobileColorStrip();
    syncMobileHeightValue(currentHeight);
    syncMobileAidaChips();
    syncMobileFontName();
  }

  // ============================================================
  // == Resize: close sheet if transitioning to desktop         ==
  // ============================================================

  var mobileResizeTimer;
  window.addEventListener('resize', function () {
    clearTimeout(mobileResizeTimer);
    mobileResizeTimer = setTimeout(function () {
      if (!isMobile() && activeSheet) {
        closeSheet();
      }
    }, 150);
  });


// ui-modules/bottom-input.js â€” Mobile bottom input bar: sync, keyboard mode & canvas tap-to-focus

  // -- Mobile Input Bar --

  var mobileTextInput = document.getElementById('mobileTextInput');

  // Sync mobile input â†’ state + desktop input + preview (debounced)
  var mobileInputDebounce = null;
  if (mobileTextInput) {
    mobileTextInput.addEventListener('input', function () {
      currentText = this.value;
      textInput.value = currentText;
      clearTimeout(mobileInputDebounce);
      mobileInputDebounce = setTimeout(function () {
        updatePreview();
        renderVirtualFontList();
      }, 300);
    });
  }

  // Sync desktop input â†’ mobile input
  if (textInput && mobileTextInput) {
    textInput.addEventListener('input', function () {
      mobileTextInput.value = this.value;
    });
  }

  // -- Keyboard Mode: hide toolbar when typing on mobile --

  if (mobileTextInput) {
    mobileTextInput.addEventListener('focus', function () {
      document.body.classList.add('keyboard-open');
      setTimeout(updatePreview, 100);
    });

    mobileTextInput.addEventListener('blur', function () {
      document.body.classList.remove('keyboard-open');
      setTimeout(updatePreview, 100);
    });
  }

  // -- Canvas / Preview Tap â†’ Focus Input (mobile + desktop) --

  var previewAreaEl = document.getElementById('previewArea');
  if (previewAreaEl) {
    previewAreaEl.addEventListener('click', function (e) {
      if (e.target.closest('button, a, input, select, textarea')) return;

      if (isMobile() && mobileTextInput) {
        mobileTextInput.focus();
      } else if (textInput) {
        textInput.focus();
        textInput.select();
      }
    });
  }

  // -- Alignment Buttons (desktop + mobile) --

  function setAlignment(align) {
    currentAlign = align;
    // Sync all alignment button groups
    document.querySelectorAll('.align-btn').forEach(function (btn) {
      btn.classList.toggle('active', btn.dataset.align === align);
    });
    updatePreview();
  }

  // Desktop sidebar alignment
  var alignRow = document.getElementById('alignRow');
  if (alignRow) {
    alignRow.addEventListener('click', function (e) {
      var btn = e.target.closest('.align-btn');
      if (!btn) return;
      setAlignment(btn.dataset.align);
    });
  }

  // Mobile toolbar alignment
  var mobileAlignRow = document.getElementById('mobileAlignRow');
  if (mobileAlignRow) {
    mobileAlignRow.addEventListener('click', function (e) {
      var btn = e.target.closest('.align-btn');
      if (!btn) return;
      setAlignment(btn.dataset.align);
    });
  }

  // -- Sync on init --

  function syncMobileTextInput() {
    if (mobileTextInput) {
      mobileTextInput.value = currentText || '';
    }
  }


// ui-modules/init.js â€” Resize handling, init function, window exposures, DOMContentLoaded

  // -- Resize handling --

  var resizeTimer;
  window.addEventListener('resize', function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(updatePreview, 150);
  });

  // -- Initialize --

  function init() {
    // Detect language
    var savedLang = null;
    try { savedLang = localStorage.getItem('w2s_lang'); } catch(e) {}
    var browserLang = (navigator.language || '').split('-')[0];
    setLanguage(savedLang || (I18N[browserLang] ? browserLang : 'en'));

    // Detect unit preference
    var savedUnit = null;
    try { savedUnit = localStorage.getItem('w2s_unit'); } catch(e) {}
    setDisplayUnit(savedUnit || detectDefaultUnit());

    renderColors();
    initMobileToolbar();
    syncMobileTextInput();
    fetchFontList();
    updatePreview();
  }

  // Expose for pdf-engine
  window.getTextBitmap = getTextBitmap;
  window.getEffectiveBitmap = getEffectiveBitmap;
  window.renderPreview = renderPreview;
  window.getDisplayUnit = function() { return displayUnit; };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function () { initAuth(init); });
  } else {
    initAuth(init);
  }

  // Wait for DMC_COLORS if loaded late
  var _colorsInterval = setInterval(function () {
    if (typeof DMC_COLORS !== 'undefined') {
      clearInterval(_colorsInterval);
      renderColors();
      populateMobileColorStrip();
    }
  }, 200);
  setTimeout(function () { clearInterval(_colorsInterval); }, 10000);


})();
</script>

<!-- â•â•â• Vercel Analytics & Speed Insights â•â•â• -->
<script defer src="/_vercel/insights/script.js"></script>
<script defer src="/_vercel/speed-insights/script.js"></script>

</body>
</html>
